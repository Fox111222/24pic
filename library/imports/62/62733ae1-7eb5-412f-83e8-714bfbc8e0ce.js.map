{"version":3,"sources":["assets\\scripts\\cc_scripts\\StartScene.js"],"names":["KBEngine","require","WxBizDataCrypt","cc","Class","Component","properties","textinput_name","type","EditBox","label_hint","Label","start","sys","platform","WECHAT_GAME","getQuery","parseRoomID","nums","forEach","item","index","parseInt","qData","obj","wx","getLaunchOptionsSync","s","query","Roomid","string2Result","split","window","roomIID","UserName","invateAcountname","EditBoxclick","log","userName","string","update","dt","sum","loginres","node","opacity","length","btn_accept","active","getChildByName","getComponent","accept_wx","localStorage","getItem","joinPrivateRoominputcallback","onLoad","initKbengine","installEvents","loader","loadRes","Prefab","err","prefab","JoinGame","instantiate","addChild","bind","btn_start","AudioMgr","init","randomstring","code","director","preloadScene","enableWxShare","wxLoginNative","placeholder","hello","showShareMenu","withShareTicket","onShareAppMessage","title","imageUrl","SHARE_PICTURE","self","login","success","res","setItem","sself","getUserInfo","withCredentials","encryptedData","iv","fail","visibleSize","view","getVisibleSize","wx_size","getSystemInfoSync","size_scale_width","screenHeight","height","x","width","y","btnAuthorize","createUserInfoButton","text","style","left","top","lineHeight","backgroundColor","color","textAlign","fontSize","borderRadius","onTap","uinfo","sf","console","errMsg","showToast","hide","L","randomchar","n","Math","floor","random","String","fromCharCode","args","KBEngineArgs","ip","SERVER_IP","port","SERVER_PORT","isWss","IS_USE_WSS","isByIP","LOGIN_BY_IP","serverURL","SERVER_URL","create","Event","register","unInstallEvents","deregister","onConnectionState","logStr","app","INFO_MSG","onConnectionState2","onLoginFailed","failedcode","serverErr","serverdatas","onReloginBaseappFailed","onReloginBaseappSuccessfully","onLoginBaseappFailed","decodeEncryptedData","sessionKey","pc","data","descrytData","onSetSpaceData","enterScene","player","loadScene","joinRoom","createPrivateRoom","joinPrivateRoom","onLoginBaseapp","Loginapp_importClientMessages","Baseapp_importClientMessages","Baseapp_importClientEntityDef","createDictString","dic","dictString","len","pro","prop","startGame","event","datas","fire","roomId"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\nvar KBEngine = require(\"kbengine\");\r\nvar WxBizDataCrypt = require(\"WxBizDataCrypt\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        textinput_name:{\r\n            default: null,\r\n            type: cc.EditBox,\r\n        },\r\n\r\n        label_hint: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n    },\r\n    start()\r\n    {\r\n        if(cc.sys.platform == cc.sys.WECHAT_GAME) {\r\n            this.getQuery()\r\n        }\r\n    },\r\n    parseRoomID:function(nums){\r\n        //var str = \"\";\r\n        nums.forEach((item,index) =>{\r\n\t        nums[index] = parseInt(nums[index])\r\n        })\r\n        return nums; //转成数字数组\r\n    },\r\n    getQuery:function()\r\n        {\r\n            var qData = {};\r\n            var obj = wx.getLaunchOptionsSync();\r\n            //this.label_hint.string = obj.query[\"UserName\"];\r\n            //this.label_hint.node.opacity=255\r\n            for (var s in obj.query) //obj.query={}\r\n            {\r\n                //this.label_hint.string = \"\" + obj.query[\"Roomid\"];\r\n                //this.label_hint.node.opacity=255\r\n                if(s == \"Roomid\"){\r\n                    qData.Roomid = obj.query[s];\r\n                    \r\n                    //this.label_hint.string = \"邀请ID\" + qData.Roomid;\r\n                    //this.label_hint.node.opacity=255\r\n\r\n                    var string2Result = qData.Roomid.split('') //字符串变成字符串数组\r\n                    window.roomIID=this.parseRoomID(string2Result)\r\n\r\n                    //string2Result.map(window.roomID)\r\n                    //window.roomID=qData.Roomid\r\n                    \r\n                }\r\n                if(s == \"UserName\"){\r\n                    qData.UserName = obj.query[s];\r\n                    window.invateAcountname=obj.query[s]\r\n                    //this.label_hint.string = obj.query[s] + \"邀请\";\r\n                    //this.label_hint.node.opacity=255\r\n\r\n                }\r\n                //    qData.gender = obj.query[s];\r\n                //if(s == \"city\")\r\n                //     qData.city = obj.query[s];\r\n            }\r\n            //this.label_hint.string = qData.UserName + \"邀请ID\" + qData.Roomid;\r\n            //this.label_hint.node.opacity=255\r\n            //window.invateAcountname=qData.UserName\r\n            return qData;\r\n        },\r\n    \r\n    // LIFE-CYCLE CALLBACKS:\r\n    EditBoxclick:function(){\r\n        cc.log(\"EditBoxclick\")\r\n       // window.AudioMgr.playSFX(\"ui_click\")\r\n        this.userName=this.textinput_name.string\r\n    },\r\n    update:function(dt){\r\n        this.sum=this.sum+dt;\r\n        if(window.loginres==0){\r\n            this.label_hint.string = \"输入房间ID无效,请重新输入房号\";\r\n            this.label_hint.node.opacity=255\r\n            //var action = cc.fadeTo(13.0, 0);\r\n            //this.label_hint.node.runAction(action);\r\n            //window.loginres=100\r\n        }\r\n        else if(window.loginres==1){\r\n            this.label_hint.string = \"房间已满！请重新输入房号\";\r\n            this.label_hint.node.opacity=255\r\n            //var action = cc.fadeTo(13.0, 0);\r\n            //this.label_hint.node.runAction(action);\r\n            //window.loginres=100\r\n        }\r\n        //cc.log(\"roomid=\", window.roomID)\r\n        if(window.roomIID.length >0){\r\n            \r\n            //if(cc.sys.localStorage.getItem(\"userName\").length == 0) return\r\n            /*\r\n            if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n                this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n            }\r\n            if(this.userName.length == 0)\r\n            {\r\n                this.label_hint.string = \"用户名不能为空\";\r\n                return;\r\n            }\r\n            \r\n            this.joinPrivateRoominputcallback(window.roomIID)\r\n            window.roomID=undefined\r\n            */\r\n           this.btn_accept.active=true;\r\n           this.btn_accept.getChildByName(\"Background\").getChildByName(\"Label\").getComponent(cc.Label).string=\"确认接受\"+ window.invateAcountname +\"的邀请！\"\r\n           //this.btn_start.active=false;\r\n            \r\n        }\r\n    },\r\n    accept_wx(){\r\n        this.btn_accept.active=false;\r\n        this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n        this.joinPrivateRoominputcallback(window.roomIID)\r\n    },\r\n    onLoad: function () {\r\n        this.sum=0;      \r\n        this.initKbengine();\r\n        this.installEvents();\r\n        cc.loader.loadRes(\"prefab/JoinGame\", cc.Prefab, function (err, prefab) {\r\n            if (err) {\r\n                cc.log(\"cc.loader.loadRes fail\")\r\n                return;\r\n            }\r\n            //cc.log(\"cc.loader.loadRes success\")\r\n            this.JoinGame = cc.instantiate(prefab);\r\n            this.JoinGame.active=false\r\n            this.node.getChildByName(\"start_bg\").addChild(this.JoinGame)\r\n//                this.FlyPoolDict[this.FlyPoolid]=newNode\r\n//                this.FlyPoolid++;\r\n        }.bind(this));\r\n        /*\r\n        // load the sprite frame of (project/assets/resources/imgs/cocos.png) from resources folder\r\n        cc.loader.loadRes('prefab/bg', cc.SpriteFrame, function (err, spriteFrame) {\r\n            if (err) {\r\n                cc.log(\"cc.loader.loadRes fail\")\r\n                return;\r\n            }\r\n            this.node.getChildByName(\"start_bg\").getComponent(cc.Sprite).spriteFrame=spriteFrame\r\n        }.bind(this));\r\n        */\r\n        this.btn_start=this.node.getChildByName(\"start_bg\").getChildByName(\"btn_start\")\r\n\r\n        this.btn_accept=this.node.getChildByName(\"start_bg\").getChildByName(\"accept\")\r\n        this.btn_accept.active=false;\r\n        //this.loadItemPrefab();\r\n        //window.AudioMgr=this.node.addComponent(\"AudioMgr\")      \r\n        var AudioMgr = require(\"AudioMgr\");\r\n        window.AudioMgr = new AudioMgr();\r\n        window.AudioMgr.init();\r\n\r\n        this.userName = cc.sys.platform != cc.sys.WECHAT_GAME ? this.randomstring(4): '';\r\n        //this.btn_start.node.on('click', this.startGame, this);\r\n        this.code = \"\";\r\n        \r\n        cc.director.preloadScene(\"WorldScene\");\r\n\r\n        if(cc.sys.platform == cc.sys.WECHAT_GAME) {\r\n            this.btn_start.active = false;\r\n            this.textinput_name.node.active = false;\r\n            this.enableWxShare();\r\n            this.wxLoginNative();\r\n            //window.wc=true;\r\n        } else {\r\n            this.textinput_name.placeholder=\"请输入你的昵称...\"\r\n            this.userName=this.textinput_name.string         \r\n        }\r\n        //window.AudioMgr.playBGM(\"bgm\")\r\n        cc.log(\"window.loginres=\",window.loginres)\r\n\r\n\r\n     },\r\n\r\n     hello () {\r\n        cc.log(\"hello world\");\r\n     },\r\n\r\n\r\n     enableWxShare: function () {\r\n        wx.showShareMenu({\r\n            withShareTicket:true,\r\n        });\r\n\r\n        wx.onShareAppMessage(function() {\r\n            return {\r\n                title: \"投石对战\",\r\n                imageUrl:SHARE_PICTURE,\r\n            }\r\n        });\r\n     },\r\n\r\n    wxLoginNative: function(){\r\n       this.btn_start.active = true;\r\n        var self=this;\r\n        wx.login({\r\n            success: (res) => {\r\n                if(res.code) {\r\n                    //sself.code = res.code;\r\n                    cc.sys.localStorage.setItem(\"userName\", res.code);\r\n                    cc.log(\"wxLoginNative success\")\r\n                    var sself=self;\r\n                    \r\n                    //在用户未授权过的情况下调用此接口，将不再出现授权弹窗，会直接进入 fail 回调\r\n                    wx.getUserInfo({\r\n                        withCredentials:1,\r\n                        success: (res) => {\r\n                            sself.btn_start.active = true;\r\n                            //sself.userName = this.code;                            \r\n                            cc.sys.localStorage.setItem(\"encryptedData\", res.encryptedData);\r\n                            cc.sys.localStorage.setItem(\"iv\", res.iv);\r\n                            cc.log(\"wxLoginNative() encryptedData && iv\",res.encryptedData , res.iv)\r\n                        },\r\n                        fail:(res)=>{\r\n                            cc.log(\"wx.getuserinfo fail\")\r\n                                //获取视图窗口可见区域尺寸\r\n                            let visibleSize = cc.view.getVisibleSize(); \r\n                            //获取系统信息\r\n                            let wx_size = wx.getSystemInfoSync();\r\n                            //计算实际大小和可见区域尺寸的比例（这里以宽度为准）\r\n                            let size_scale_width = wx_size.screenHeight / visibleSize.height;\r\n                            let x = (visibleSize.width / 2) * size_scale_width-(125 * size_scale_width);\r\n                            let y = ( visibleSize.height / 2 ) * size_scale_width;\r\n                            let width = 250 * size_scale_width;\r\n                            let height = 60 * size_scale_width;\r\n                            sself.btnAuthorize = wx.createUserInfoButton({\r\n                                type: 'text',\r\n                                text: '点击微信登陆授权',\r\n                                style: {\r\n                                    left: x,\r\n                                    top: y,\r\n                                    width: width,\r\n                                    height: height,\r\n                                    lineHeight: height,\r\n                                    backgroundColor: \"#ffffff\",\r\n                                    color: \"#3296fa\",\r\n                                    textAlign: \"center\",\r\n                                    fontSize: 16,\r\n                                    borderRadius: 0,\r\n                                }\r\n                            })\r\n                    \r\n                            sself.btnAuthorize.onTap((uinfo) => {\r\n                                var sf=sself\r\n                                console.log(\"onTap uinfo: \",uinfo);\r\n                                if (uinfo.errMsg == \"getUserInfo:ok\") {\r\n                                    console.log(\"wxLogin auth success\");\r\n                                    wx.showToast({title:\"授权成功\"});\r\n                                    cc.sys.localStorage.setItem(\"encryptedData\", uinfo.encryptedData);\r\n                                    cc.sys.localStorage.setItem(\"iv\", uinfo.iv);\r\n                                    //sf.label_hint.string = \"uinfo.encryptedData=\"+uinfo.encryptedData+\"/\"+uinfo.iv;\r\n                                    sf.label_hint.string = uinfo.encryptedData ;\r\n                                    sf.btn_start.active = true;\r\n                                }else {\r\n                                    console.log(\"wxLogin auth fail\");\r\n                                    wx.showToast({title:\"授权失败\"});\r\n                                }\r\n                                sf.btnAuthorize.hide(); //获取用户信息成功后隐藏按钮\r\n                            });\r\n\r\n                        },\r\n                    });\r\n\r\n                    /////////////////////////////\r\n                  \r\n\r\n\r\n\r\n                    /////////////////////////////////\r\n/*\r\n    //获取视图窗口可见区域尺寸\r\n    let visibleSize = cc.view.getVisibleSize(); \r\n    //获取系统信息\r\n    let wx_size = wx.getSystemInfoSync();\r\n    //计算实际大小和可见区域尺寸的比例（这里以宽度为准）\r\n    let size_scale_width = wx_size.screenWidth / visibleSize.width;\r\n    //计算创建用户信息按钮需要的属性（img_auth为蓝色参考节点）\r\n    let x = (visibleSize.width / 2) * size_scale_width;\r\n    let y = ( visibleSize.height / 2 ) * size_scale_width;\r\n    let width = 360 * size_scale_width;\r\n    let height = 360 * size_scale_width;\r\n\r\n    sself.authorButton = wx.createUserInfoButton({\r\n      type: \"text\",\r\n      text: \"授权按钮\",\r\n      style: {\r\n        left: x,\r\n        top: y,\r\n        width: width,\r\n        height: height,\r\n        lineHeight: height,\r\n        backgroundColor: \"#ffffff\",\r\n        color: \"#3296fa\",\r\n        textAlign: \"center\",\r\n        fontSize: 16,\r\n        borderRadius: 0,\r\n      },\r\n    });\r\n    sself.authorButton.onTap((res) => {\r\n      if (res.errMsg == \"getUserInfo:ok\") {\r\n        cc.log(\"wxLoginNative() encryptedData && iv\",res.encryptedData , res.iv)\r\n        sself.btn_start.node.active = true;\r\n        cc.sys.localStorage.setItem(\"encryptedData\", res.encryptedData);\r\n        cc.sys.localStorage.setItem(\"iv\", res.iv);\r\n        wx.showToast({\r\n          icon: \"none\",\r\n          title: \"获取用户信息成功\",\r\n          duration: 2000,\r\n        });\r\n        sself.authorButton.hide(); //获取用户信息成功后隐藏按钮\r\n      } else {\r\n        if (res.errMsg === \"getUserInfo:fail auth deny\") {\r\n          wx.showToast({\r\n            icon: \"none\",\r\n            title: \"获取用户信息失败\",\r\n            duration: 2000,\r\n          });\r\n        } else {\r\n          wx.showToast({\r\n            icon: \"none\",\r\n            title: res.errMsg,\r\n            duration: 2000,\r\n          });\r\n        }\r\n      }\r\n    });\r\n                   \r\n     */       \r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n     randomstring: function(L){\r\n        var s= '';\r\n        var randomchar=function(){\r\n         var n= Math.floor(Math.random()*62);\r\n         if(n<10) return n; //0-9\r\n         if(n<36) return String.fromCharCode(n+55); //A-Z\r\n         return String.fromCharCode(n+61); //a-z\r\n        }\r\n        while(s.length< L) s+= randomchar();\r\n        return s;\r\n    },\r\n\r\n\r\n     initKbengine: function() {\r\n        var args = new KBEngine.KBEngineArgs();\t\r\n\t    args.ip = SERVER_IP;\r\n        args.port = SERVER_PORT;\r\n        args.isWss = IS_USE_WSS;              //是否用wss协议， true:wss  false:ws\r\n        args.isByIP = LOGIN_BY_IP;             //用ip还是用域名登录服务器   有修改官方的kbengine.js\r\n        args.serverURL = SERVER_URL;\r\n\t    KBEngine.create(args);\r\n     },\r\n\r\n     installEvents:function() {\r\n        KBEngine.Event.register(\"onConnectionState\", this, \"onConnectionState\");\r\n        KBEngine.Event.register(\"onConnectionState2\", this, \"onConnectionState2\");\r\n        KBEngine.Event.register(\"onLoginFailed\", this, \"onLoginFailed\");\r\n        KBEngine.Event.register(\"onLoginBaseappFailed\", this, \"onLoginBaseappFailed\");\r\n\t\tKBEngine.Event.register(\"enterScene\", this, \"enterScene\");\r\n        KBEngine.Event.register(\"onReloginBaseappFailed\", this, \"onReloginBaseappFailed\");\r\n        KBEngine.Event.register(\"onReloginBaseappSuccessfully\", this, \"onReloginBaseappSuccessfully\");\r\n        KBEngine.Event.register(\"onLoginBaseapp\", this, \"onLoginBaseapp\");\r\n        KBEngine.Event.register(\"onSetSpaceData\", this, \"onSetSpaceData\");\r\n        \r\n     },\r\n\r\n     unInstallEvents() {\r\n        KBEngine.Event.deregister(\"onConnectionState\", this, \"onConnectionState\");\r\n        KBEngine.Event.deregister(\"onConnectionState2\", this, \"onConnectionState2\");\r\n        KBEngine.Event.deregister(\"onLoginFailed\", this, \"onLoginFailed\");\r\n        KBEngine.Event.deregister(\"onLoginBaseappFailed\", this, \"onLoginBaseappFailed\");\r\n\t\tKBEngine.Event.deregister(\"enterScene\", this, \"enterScene\");\r\n        KBEngine.Event.deregister(\"onReloginBaseappFailed\", this, \"onReloginBaseappFailed\");\r\n        KBEngine.Event.deregister(\"onReloginBaseappSuccessfully\", this, \"onReloginBaseappSuccessfully\");\r\n        KBEngine.Event.deregister(\"onLoginBaseapp\", this, \"onLoginBaseapp\");\r\n        KBEngine.Event.deregister(\"onSetSpaceData\", this, \"onSetSpaceData\");\r\n        \r\n     },\r\n\r\n     onConnectionState : function(success) {\r\n        var logStr = \"\";\r\n\t\tif(!success) {\r\n            logStr = \" Connect(\" + KBEngine.app.ip + \":\" + KBEngine.app.port + \") is error! (连接错误)\";\r\n            this.btn_start.active = true;\r\n            this.label_hint.string = \"连接错误onerror_before_onopen\";\r\n        }\r\n\t\telse {\r\n            logStr = \"Connect successfully, please wait...(连接成功，请等候...)\";\r\n        }\r\n     \r\n        KBEngine.INFO_MSG(logStr);\r\n    },\r\n    onConnectionState2 : function(success) {\r\n        var logStr = \"\";\r\n\t\tif(!success) {\r\n            logStr = \" Connect(\" + KBEngine.app.ip + \":\" + KBEngine.app.port + \") is error! (连接错误)\";\r\n            this.btn_start.active = true;\r\n            this.label_hint.string = \"连接错误socket not is null\";\r\n        }\r\n\t\telse {\r\n            logStr = \"Connect successfully, please wait...(连接成功，请等候...)\";\r\n        }\r\n     \r\n        KBEngine.INFO_MSG(logStr);\r\n\t},\r\n\r\n     onLoginFailed : function(failedcode) {\r\n        var logStr = '';\r\n        if(failedcode == 20)\r\n        {\r\n           logStr = \"Login is failed(登陆失败), err=\" + KBEngine.app.serverErr(failedcode) + \", \" + KBEngine.app.serverdatas;\r\n        }\r\n        else\r\n        {\r\n           logStr = \"Login is failed(登陆失败), err=\" + KBEngine.app.serverErr(failedcode);\r\n        }    \r\n        \r\n        this.label_hint.string = \"登陆失败,\" +  KBEngine.app.serverErr(failedcode);\r\n        this.btn_start.active = true;\r\n        KBEngine.INFO_MSG(logStr);\t\r\n     },\r\n\r\n     onReloginBaseappFailed: function(failedcode){\r\n        this.btn_start.active = true;\r\n        KBEngine.INFO_MSG(\"reogin is failed(断线重连失败), err=\" + KBEngine.app.serverErr(failedcode))\r\n     },\r\n\r\n     onReloginBaseappSuccessfully : function() {\r\n        KBEngine.INFO_MSG(\"reogin is successfully!(断线重连成功!)\")\r\n    },\r\n\r\n     onLoginBaseappFailed : function(failedcode) {\r\n        this.btn_start.active = true;\r\n        KBEngine.INFO_MSG(\"LoginBaseapp is failed(登陆网关失败), err=\" + KBEngine.app.serverErr(failedcode));\r\n     },\r\n\r\n     decodeEncryptedData:function() {\r\n        var encryptedData = cc.sys.localStorage.getItem(\"encryptedData\");\r\n        var sessionKey = cc.sys.localStorage.getItem(\"sessionKey\");\r\n        var iv = cc.sys.localStorage.getItem(\"iv\");\r\n        KBEngine.INFO_MSG(\"decodeEncryptedData: encryptedData=\" + encryptedData + \" ,iv=\" + iv + \" ,sessionKey=\" + sessionKey);\r\n        if(sessionKey && encryptedData && iv) {\r\n            //var pc = new WxBizDataCrypt(APPID, sessionKey);\r\n            var pc = new WxBizDataCrypt(\"wxbe1644556ed8afa6\", \"96c0e22af25571db5f175ebbb550e672\");\r\n            var data = pc.descrytData(encryptedData , iv);\r\n            console.log('解密后 data: ', data)\r\n        }\r\n     },\r\n     onSetSpaceData:function(){\r\n         cc.log(\"startscene.onSetSpaceData\")\r\n     },  \r\n     enterScene : function() {\r\n        KBEngine.INFO_MSG(\"Login is successfully!(登陆成功!)\");\r\n        this.label_hint.string = \"登陆成功 !!!\";\r\n        if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n            var player = KBEngine.app.player();\r\n            var encryptedData = cc.sys.localStorage.getItem(\"encryptedData\");\r\n            var iv = cc.sys.localStorage.getItem(\"iv\");\r\n            cc.log(\"encryptedData && iv\",encryptedData , iv)\r\n            this.label_hint.string = \"base.decodeEncryptedData()=\" + encryptedData + \"/\" + iv;\r\n            player.decodeEncryptedData();\r\n        } \r\n        //var player = KBEngine.app.player();//KBEngine.app.entities[KBEngine.app.entity_id];    \r\n        //player.joinRoom()\r\n\r\n        cc.director.loadScene(\"WorldScene\", ()=> {\r\n            KBEngine.INFO_MSG(\"load world scene finished\");\r\n            var player = KBEngine.app.player();//KBEngine.app.entities[KBEngine.app.entity_id];\r\n            //window.type=1\r\n            if(player){\r\n                if (window.type==1){\r\n                    player.joinRoom();\r\n                }\r\n                if (window.type==2){\r\n                    player.createPrivateRoom();\r\n                    \r\n                }\r\n                if (window.type==3 && window.roomIID.length>0){\r\n                    player.joinPrivateRoom(window.roomIID);\r\n                    window.roomIID=[]                    \r\n                }                \r\n            }\r\n            this.unInstallEvents();           \r\n        });\r\n           \r\n     \r\n        \r\n         /*\r\n        KBEngine.INFO_MSG(\"Login is successfully!(登陆成功!)\");\r\n        this.label_hint.string = \"登陆成功 !!!\";\r\n        if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n            var player = KBEngine.app.player();\r\n            var encryptedData = cc.sys.localStorage.getItem(\"encryptedData\");\r\n            var iv = cc.sys.localStorage.getItem(\"iv\");\r\n            cc.log(\"encryptedData && iv\",encryptedData , iv)\r\n            this.label_hint.string = \"base.decodeEncryptedData()=\" + encryptedData + \"/\" + iv;\r\n            //player.decodeEncryptedData();\r\n        }                \r\n        cc.director.loadScene(\"WorldScene\", ()=> {\r\n            KBEngine.INFO_MSG(\"load world scene finished\");\r\n            var player = KBEngine.app.player();//KBEngine.app.entities[KBEngine.app.entity_id];\r\n            if(player){\r\n                player.joinRoom();\r\n            }\r\n                \r\n        });\r\n        this.unInstallEvents();\r\n        */\r\n     },\r\n \r\n     onLoginBaseapp : function() {\r\n        cc.log(\"Connect to loginBaseapp, please wait...(连接到网关， 请稍后...)\");\r\n     },\r\n \r\n     Loginapp_importClientMessages : function() {\r\n        this.label_hint.string = \"登陆中 ... ...\";\r\n        cc.log(\"Loginapp_importClientMessages ...\");\r\n     },\r\n \r\n     Baseapp_importClientMessages : function() {\r\n         cc.log(\"Baseapp_importClientMessages ..\");\r\n     },\r\n         \r\n     Baseapp_importClientEntityDef: function() {\r\n         cc.log(\"Baseapp_importClientEntityDef ..\")\r\n     },\r\n\r\n     createDictString: function(dic) {\r\n        var dictString = \"\";\r\n        var len = 0;\r\n        for(var pro in dic) len++;\r\n\r\n        if(len > 0) {\r\n            var index = 0;\r\n            var dictString = \"{\"\r\n            for(var prop in dic) {\r\n                dictString += \"'\" + prop + \"'\" ;\r\n                dictString += \":\";\r\n                dictString += \"'\" + dic[prop] + \"'\";\r\n                if(index == len-1) {\r\n                    dictString += \"}\";\r\n                }else {\r\n                    dictString += \",\";\r\n                }\r\n                index++;\r\n            }\r\n        }\r\n\r\n        return dictString;\r\n     },\r\n \r\n     startGame: function (event) {\r\n        window.loginres=100;\r\n        // window.AudioMgr.playSFX(\"ui_click\")\r\n         //cc.log(\"cc.sys.platform\",cc.sys.platform,cc.sys.WECHAT_GAME)\r\n         window.type=1\r\n         if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n             this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n         }\r\n         if(this.userName.length == 0)\r\n         {\r\n             this.label_hint.string = \"用户名不能为空\";\r\n             return;\r\n         }\r\n         ///////////////////////////////////////////////////\r\n \r\n \r\n         //////////////////////////////////////////////////\r\n         cc.log(\"this.userName=\", this.userName)  \r\n         var datas = {};\r\n         datas[\"platform\"] = cc.sys.platform;\r\n         datas = this.createDictString(datas);\r\n         KBEngine.INFO_MSG(\"login name=\" + this.userName);\r\n         //var temp1=UnicodeToUtf8(this.userName)\r\n         //this.userName =java.net.URLDecoder.decode(temp,\"UTF-8\"); \r\n         //this.userName =Utf8ToUnicode(temp1)\r\n         //cc.log(\"this.userName=\",this.userName)  \r\n         KBEngine.Event.fire(\"login\", this.userName, \"123456\", datas);  \r\n         this.label_hint.string = \"登陆中 ... ...\";\r\n         this.btn_start.active = false;\r\n         \r\n         /*\r\n\t    this.login = function(username, password, datas)\r\n\t    {  \r\n\t\t    KBEngine.app.reset();\r\n\t\t    KBEngine.app.username = username;\r\n\t\t    KBEngine.app.password = password;\r\n\t\t    KBEngine.app.clientdatas = datas;\r\n\t\t\r\n\t\t    KBEngine.app.login_loginapp(true);\r\n\t    }\r\n\r\n\r\n         */\r\n \r\n      },\r\n      createPrivateRoom: function (event) {\r\n        window.loginres=100; \r\n         window.type=2\r\n         // window.AudioMgr.playSFX(\"ui_click\")\r\n          //cc.log(\"cc.sys.platform\",cc.sys.platform,cc.sys.WECHAT_GAME)\r\n          if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n              this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n          }\r\n          if(this.userName.length == 0)\r\n          {\r\n              this.label_hint.string = \"用户名不能为空\";\r\n              return;\r\n          }\r\n          cc.log(\"this.userName=\",this.userName)  \r\n          var datas = {};\r\n          datas[\"platform\"] = cc.sys.platform;\r\n          datas = this.createDictString(datas);\r\n          KBEngine.INFO_MSG(\"login name=\" + this.userName);\r\n          //var temp1=UnicodeToUtf8(this.userName)\r\n          //this.userName =java.net.URLDecoder.decode(temp,\"UTF-8\"); \r\n          //this.userName =Utf8ToUnicode(temp1)\r\n          //cc.log(\"this.userName=\",this.userName)  \r\n          KBEngine.Event.fire(\"login\", this.userName, \"123456\", datas);  \r\n          this.label_hint.string = \"登陆中 ... ...\";\r\n          this.btn_start.active = false;\r\n       },\r\n       joinPrivateRoominputcallback:function(roomId){ //参数是数组\r\n         window.type=3\r\n         window.loginres=100;\r\n         window.roomIID=roomId\r\n         if(this.JoinGame)\r\n            this.JoinGame.active=false\r\n           //////////////////////////////////////////////////\r\n          cc.log(\"this.userName=\",this.userName,roomId)  \r\n          var datas = {};\r\n          datas[\"platform\"] = cc.sys.platform;\r\n          datas = this.createDictString(datas);\r\n          KBEngine.INFO_MSG(\"login name=\" + this.userName);\r\n          //var temp1=UnicodeToUtf8(this.userName)\r\n          //this.userName =java.net.URLDecoder.decode(temp,\"UTF-8\"); \r\n          //this.userName =Utf8ToUnicode(temp1)\r\n          //cc.log(\"this.userName=\",this.userName)  \r\n          KBEngine.Event.fire(\"login\", this.userName, \"123456\", datas);  \r\n          this.label_hint.string = \"登陆中 ... ...\";\r\n          this.btn_start.active = false;\r\n \r\n       },\r\n       joinPrivateRoom: function (event) {\r\n         \r\n         //window.AudioMgr.playSFX(\"ui_click\")\r\n          //cc.log(\"cc.sys.platform\",cc.sys.platform,cc.sys.WECHAT_GAME)\r\n \r\n          \r\n          if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n              this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n          }\r\n          if(this.userName.length == 0)\r\n          {\r\n              this.label_hint.string = \"用户名不能为空\";\r\n              return;\r\n          }\r\n          this.JoinGame.active=true\r\n          ///////////////////////////////////////////////////\r\n  \r\n  \r\n          \r\n       },\r\n\r\n\r\n\r\n});\r\n"]}