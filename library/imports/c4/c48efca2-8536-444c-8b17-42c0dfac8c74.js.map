{"version":3,"sources":["assets\\scripts\\cc_scripts\\GameOver.js"],"names":["KBEngine","require","cc","Class","Component","properties","labelHitRate","type","Label","labelTotalTime","labelTotalHarm","labelScore","buttonRanking","Button","rankingView","Node","rankingScrollView","Sprite","onLoad","isShowRankingView","node","active","result","INFO_MSG","HP","OtherHP","TOTAL_TIME","SCORE","string","Math","round","window","AudioMgr","stopBGM","director","preloadScene","start","wx","undefined","_isShow","tex","Texture2D","openDataContext","getOpenDataContext","sharedCanvas","canvas","width","height","setUserCloudStorage","KVDataList","key","value","LVlevel","success","res","JSON","stringify","fail","complete","continueGame","playSFX","player","app","inWorld","loadScene","onDisplayRankingView","toString","log","postMessage","message","onCloseRankingView","_updateSubDomainCanvas","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","update"],"mappings":";;;;;;AACA,IAAIA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAtB;;AAEAC,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAELC,EAAAA,UAAU,EAAE;AACRC,IAAAA,YAAY,EAAE;AACV,iBAAS,IADC;AAEVC,MAAAA,IAAI,EAAEL,EAAE,CAACM;AAFC,KADN;AAMRC,IAAAA,cAAc,EAAE;AACZ,iBAAS,IADG;AAEZF,MAAAA,IAAI,EAAEL,EAAE,CAACM;AAFG,KANR;AAWRE,IAAAA,cAAc,EAAE;AACZ,iBAAS,IADG;AAEZH,MAAAA,IAAI,EAAEL,EAAE,CAACM;AAFG,KAXR;AAgBRG,IAAAA,UAAU,EAAE;AACR,iBAAS,IADD;AAERJ,MAAAA,IAAI,EAAEL,EAAE,CAACM;AAFD,KAhBJ;AAqBRI,IAAAA,aAAa,EAAE;AACX,iBAAS,IADE;AAEXL,MAAAA,IAAI,EAAEL,EAAE,CAACW;AAFE,KArBP;AA0BRC,IAAAA,WAAW,EAAEZ,EAAE,CAACa,IA1BR;AA2BRC,IAAAA,iBAAiB,EAAEd,EAAE,CAACe;AA3Bd,GAFP;AA+BLC,EAAAA,MA/BK,oBA+BK;AAEN;AAEA,SAAKC,iBAAL,GAAyB,KAAzB;AACA,SAAKP,aAAL,CAAmBQ,IAAnB,CAAwBC,MAAxB,GAAiC,KAAjC;AACA,SAAKP,WAAL,CAAiBO,MAAjB,GAA0B,KAA1B;AACA,QAAIC,MAAM,GAAG,IAAb;AAEAtB,IAAAA,QAAQ,CAACuB,QAAT,CAAkB,wDAAlB,EAA4EC,EAA5E,EAAgFC,OAAhF,EAAyFC,UAAzF,EAAqGC,KAArG,EATM,CAUN;;AACA,SAAKrB,YAAL,CAAkBsB,MAAlB,GAA2BJ,EAA3B,CAXM,CAWwB;;AAC9B,SAAKd,cAAL,CAAoBkB,MAApB,GAA6BH,OAA7B,CAZM,CAYgC;;AACtC,SAAKhB,cAAL,CAAoBmB,MAApB,GAA6BF,UAAU,GAAG,GAA1C;AACA,SAAKf,UAAL,CAAgBiB,MAAhB,GAAyBC,IAAI,CAACC,KAAL,CAAW,MAAIH,KAAf,IAAsB,GAA/C,CAdM,CAc8C;;AACpDI,IAAAA,MAAM,CAACC,QAAP,CAAgBC,OAAhB;AACA/B,IAAAA,EAAE,CAACgC,QAAH,CAAYC,YAAZ,CAAyB,YAAzB;AACH,GAhDI;AAkDLC,EAAAA,KAlDK,mBAkDG;AAEJ,QAAIL,MAAM,CAACM,EAAP,IAAaC,SAAjB,EAA4B;AACxB,WAAK1B,aAAL,CAAmBQ,IAAnB,CAAwBC,MAAxB,GAAiC,IAAjC,CADwB,CACgB;;AACxC,WAAKkB,OAAL,GAAe,KAAf;AACA,WAAKC,GAAL,GAAW,IAAItC,EAAE,CAACuC,SAAP,EAAX,CAHwB,CAKxB;AACA;;AACA,UAAIC,eAAe,GAAGL,EAAE,CAACM,kBAAH,EAAtB;AAEA,WAAKC,YAAL,GAAoBF,eAAe,CAACG,MAApC;AAEA,WAAKD,YAAL,CAAkBE,KAAlB,GAA0B,GAA1B;AAEA,WAAKF,YAAL,CAAkBG,MAAlB,GAA2B,GAA3B;AAEAV,MAAAA,EAAE,CAACW,mBAAH,CAAuB;AAAG;AACtBC,QAAAA,UAAU,EAAE,CAAC;AAAEC,UAAAA,GAAG,EAAE,OAAP;AAAgBC,UAAAA,KAAK,EAAE,KAAIC;AAA3B,SAAD,CADO;AAEnBC,QAAAA,OAAO,EAAE,iBAAUC,GAAV,EAAe;AACpBtD,UAAAA,QAAQ,CAACuB,QAAT,CAAkB,iCAAiCgC,IAAI,CAACC,SAAL,CAAeF,GAAf,CAAnD;AACH,SAJkB;AAKnBG,QAAAA,IAAI,EAAE,cAAUH,GAAV,EAAe;AACjBtD,UAAAA,QAAQ,CAACuB,QAAT,CAAkB,8BAA8BgC,IAAI,CAACC,SAAL,CAAeF,GAAf,CAAhD;AACH,SAPkB;AAQnBI,QAAAA,QAAQ,EAAE,kBAAUJ,GAAV,EAAe;AACrBtD,UAAAA,QAAQ,CAACuB,QAAT,CAAkB,kCAAkCgC,IAAI,CAACC,SAAL,CAAeF,GAAf,CAApD;AACH;AAVkB,OAAvB;AAYH;AAEJ,GAjFI;AAmFLK,EAAAA,YAAY,EAAE,wBAAW;AACrB5B,IAAAA,MAAM,CAACC,QAAP,CAAgB4B,OAAhB,CAAwB,UAAxB;AACA,QAAIC,MAAM,GAAG7D,QAAQ,CAAC8D,GAAT,CAAaD,MAAb,EAAb;AACA,QAAGA,MAAM,IAAIvB,SAAV,IAAuB,CAACuB,MAAM,CAACE,OAAlC,EACI;AAEJ7D,IAAAA,EAAE,CAACgC,QAAH,CAAY8B,SAAZ,CAAsB,YAAtB,EAAoC,YAAM;AACtCH,MAAAA,MAAM,CAACF,YAAP;AACH,KAFD;AAGH,GA5FI;AA8FLM,EAAAA,oBA9FK,kCA8FkB;AACnB;AACA,QAAIlC,MAAM,CAACM,EAAP,IAAaC,SAAjB,EAA6B;AAE7B,SAAKnB,iBAAL,GAAyB,CAAC,KAAKA,iBAA/B;AACA,SAAKL,WAAL,CAAiBO,MAAjB,GAA0B,KAAKF,iBAA/B;AACAnB,IAAAA,QAAQ,CAACuB,QAAT,CAAkB,wBAAwB,KAAKJ,iBAAL,CAAuB+C,QAAvB,EAA1C;AACAhE,IAAAA,EAAE,CAACiE,GAAH,CAAO,6CAAP,EAAqD,KAAKhD,iBAA1D,EAPmB,CAQnB;;AACA,QAAIuB,eAAe,GAAGL,EAAE,CAACM,kBAAH,EAAtB,CATmB,CAS2B;;AAC9CD,IAAAA,eAAe,CAAC0B,WAAhB,CAA4B;AACxBC,MAAAA,OAAO,EAAE,KAAKlD,iBAAL,GAAyB,MAAzB,GAAkC;AADnB,KAA5B;AAGH,GA3GI;AA6GLmD,EAAAA,kBA7GK,gCA6Ge;AAChBvC,IAAAA,MAAM,CAACC,QAAP,CAAgB4B,OAAhB,CAAwB,UAAxB;AACA,SAAK9C,WAAL,CAAiBO,MAAjB,GAA0B,KAA1B;AACArB,IAAAA,QAAQ,CAACuB,QAAT,CAAkB,sBAAlB,EAHgB,CAIhB;;AACA,QAAImB,eAAe,GAAGL,EAAE,CAACM,kBAAH,EAAtB;AACAD,IAAAA,eAAe,CAAC0B,WAAhB,CAA4B;AACxBC,MAAAA,OAAO,EAAE;AADe,KAA5B;AAGH,GAtHI;AAwHLE,EAAAA,sBAxHK,oCAwHoB;AACrB,QAAIxC,MAAM,CAACM,EAAP,IAAaC,SAAjB,EAA6B;AAC7B,QAAI,CAAC,KAAKE,GAAV,EAAgB;AAEhB,SAAKA,GAAL,CAASgC,eAAT,CAAyB,KAAK5B,YAA9B;AACA,SAAKJ,GAAL,CAASiC,mBAAT;AACA,SAAKzD,iBAAL,CAAuB0D,WAAvB,GAAqC,IAAIxE,EAAE,CAACyE,WAAP,CAAmB,KAAKnC,GAAxB,CAArC;AACH,GA/HI;AAiILoC,EAAAA,MAjIK,oBAiII;AACL,SAAKL,sBAAL;AACH;AAnII,CAAT","sourceRoot":"/","sourcesContent":["\r\nvar KBEngine = require(\"kbengine\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        labelHitRate: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n\r\n        labelTotalTime: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n\r\n        labelTotalHarm: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n\r\n        labelScore: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n\r\n        buttonRanking: {\r\n            default: null,\r\n            type: cc.Button,\r\n        },\r\n\r\n        rankingView: cc.Node,\r\n        rankingScrollView: cc.Sprite,\r\n    },\r\n    onLoad () {\r\n\r\n        //window.AudioMgr.playSFX(\"win\")\r\n\r\n        this.isShowRankingView = false;\r\n        this.buttonRanking.node.active = false;\r\n        this.rankingView.active = false;\r\n        var result = null;\r\n    \r\n        KBEngine.INFO_MSG(\"game is over, result: rate=%f harm=%f time=%f score=%f\", HP, OtherHP, TOTAL_TIME, SCORE);\r\n        //var rate = HIT_RATE * 100;\r\n        this.labelHitRate.string = HP;//抢答次数\r\n        this.labelTotalHarm.string = OtherHP; //对方抢答次数\r\n        this.labelTotalTime.string = TOTAL_TIME + 'S';\r\n        this.labelScore.string = Math.round(100*SCORE)+\"%\"; //胜利比率\r\n        window.AudioMgr.stopBGM()\r\n        cc.director.preloadScene(\"WorldScene\");\r\n    },\r\n\r\n    start() {\r\n        \r\n        if (window.wx != undefined) {\r\n            this.buttonRanking.node.active = true;  //排行榜button\r\n            this._isShow = false;\r\n            this.tex = new cc.Texture2D();\r\n\r\n            //sharedCanvas.width = this.rankingScrollView.node.width;//cc.winSize.width/2;\r\n            //sharedCanvas.height = this.rankingScrollView.node.height;//cc.winSize.height;\r\n            let openDataContext = wx.getOpenDataContext()\r\n\r\n            this.sharedCanvas = openDataContext.canvas\r\n    \r\n            this.sharedCanvas.width = 720;\r\n    \r\n            this.sharedCanvas.height = 720;\r\n\r\n            wx.setUserCloudStorage({  //存储数据\r\n                KVDataList: [{ key: 'score', value: \"\"+ LVlevel }],\r\n                success: function (res) {\r\n                    KBEngine.INFO_MSG('setUserCloudStorage  success' + JSON.stringify(res));\r\n                },\r\n                fail: function (res) {\r\n                    KBEngine.INFO_MSG('setUserCloudStorage  fail' + JSON.stringify(res));\r\n                },\r\n                complete: function (res) {\r\n                    KBEngine.INFO_MSG('setUserCloudStorage  complete' + JSON.stringify(res));\r\n                }\r\n            });\r\n        }\r\n        \r\n    },\r\n\r\n    continueGame: function() {\r\n        window.AudioMgr.playSFX(\"ui_click\")\r\n        var player = KBEngine.app.player();\r\n        if(player == undefined || !player.inWorld)\r\n            return;\r\n\r\n        cc.director.loadScene(\"WorldScene\", () => {\r\n            player.continueGame();\r\n        });\r\n    },\r\n\r\n    onDisplayRankingView() {\r\n        //window.AudioMgr.playSFX(\"ui_click\")\r\n        if (window.wx == undefined)  return;\r\n       \r\n        this.isShowRankingView = !this.isShowRankingView;\r\n        this.rankingView.active = this.isShowRankingView;\r\n        KBEngine.INFO_MSG(\"show ranking view: \" + this.isShowRankingView.toString());\r\n        cc.log(\"show ranking view: this.rankingView.active=\",this.isShowRankingView);\r\n        // 发消息给子域\r\n        let openDataContext = wx.getOpenDataContext();//获得开放数据域的实例，获得的实例调用postMessage，向子域发送数据，子域通过开启wx.onMessage()接受主域传达的消息\r\n        openDataContext.postMessage({\r\n            message: this.isShowRankingView ? 'Show' : 'Hide',\r\n        });\r\n    },\r\n\r\n    onCloseRankingView(){\r\n        window.AudioMgr.playSFX(\"ui_click\")\r\n        this.rankingView.active = false;\r\n        KBEngine.INFO_MSG(\"close ranking view: \");\r\n        // 发消息给子域\r\n        let openDataContext = wx.getOpenDataContext();\r\n        openDataContext.postMessage({\r\n            message: 'Hide',\r\n        });\r\n    },\r\n\r\n    _updateSubDomainCanvas() {\r\n        if (window.wx == undefined)  return;\r\n        if (!this.tex)  return;\r\n        \r\n        this.tex.initWithElement(this.sharedCanvas);\r\n        this.tex.handleLoadedTexture();\r\n        this.rankingScrollView.spriteFrame = new cc.SpriteFrame(this.tex);\r\n    },\r\n\r\n    update() {\r\n        this._updateSubDomainCanvas();\r\n    },\r\n\r\n});\r\n"]}