{"version":3,"sources":["assets\\scripts\\AudioMgr.js"],"names":["cc","Class","Component","properties","bgmVolume","sfxVolume","bgmAudioID","init","t","sys","localStorage","getItem","parseFloat","game","on","EVENT_HIDE","audioEngine","pauseAll","EVENT_SHOW","resumeAll","getUrl","url","stopBGM","log","stop","playBGM","audioUrl","self","loader","loadRes","AudioClip","err","clip","play","playSFX","audioId","setSFXVolume","v","setItem","setBGMVolume","force","resume","pause","setVolume"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        bgmVolume:1.0,\r\n        sfxVolume:1.0,\r\n        \r\n        bgmAudioID:-1,\r\n    },\r\n\r\n    // use this for initialization\r\n    init: function () {\r\n        var t = cc.sys.localStorage.getItem(\"bgmVolume\");\r\n        if(t != null){\r\n            this.bgmVolume = parseFloat(t);    \r\n        }\r\n        \r\n        var t = cc.sys.localStorage.getItem(\"sfxVolume\");\r\n        if(t != null){\r\n            this.sfxVolume = parseFloat(t);    \r\n        }\r\n        \r\n        cc.game.on(cc.game.EVENT_HIDE, function () {\r\n            //console.log(\"cc.audioEngine.pauseAll\");\r\n            cc.audioEngine.pauseAll();\r\n        });\r\n        cc.game.on(cc.game.EVENT_SHOW, function () {\r\n            //console.log(\"cc.audioEngine.resumeAll\");\r\n            cc.audioEngine.resumeAll();\r\n        });\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    \r\n    getUrl:function(url){\r\n        //return cc.url.raw(\"sound/\" + url);\r\n        return \"sound/\" + url\r\n    },\r\n    stopBGM(){\r\n        cc.log(\"stopBGMstopBGMstopBGMstopBGM\")\r\n        if(this.bgmAudioID >= 0){\r\n            cc.audioEngine.stop(this.bgmAudioID);\r\n            this.bgmAudioID=-1;\r\n        }\r\n\r\n    },\r\n    playBGM(url){\r\n        var audioUrl = this.getUrl(url);\r\n        cc.log(audioUrl);\r\n        if(this.bgmAudioID >= 0){\r\n            cc.audioEngine.stop(this.bgmAudioID);\r\n        }\r\n        //this.bgmAudioID = cc.audioEngine.play(audioUrl,true,this.bgmVolume);\r\n        \r\n        var self=this\r\n        cc.loader.loadRes(audioUrl,cc.AudioClip, function (err, clip) {\r\n            self.bgmAudioID=cc.audioEngine.play(clip,true,self.bgmVolume);\r\n            //cc.log(\"888888888888888888888888888self.bgmAudioID=\",self.bgmAudioID)\r\n        });\r\n        \r\n    },\r\n    \r\n    playSFX(url){\r\n        var audioUrl = this.getUrl(url);\r\n        if(this.sfxVolume > 0){\r\n            //var audioId = cc.audioEngine.play(audioUrl,false,this.sfxVolume);\r\n            var self=this\r\n            cc.loader.loadRes(audioUrl,cc.AudioClip, function (err, clip) {\r\n                var audioId=cc.audioEngine.play(clip,false,self.sfxVolume);\r\n                //cc.log(\"888888888888888888888888888self.bgmAudioID=\",self.bgmAudioID)\r\n            });    \r\n        }\r\n    },\r\n    \r\n    setSFXVolume:function(v){\r\n        if(this.sfxVolume != v){\r\n            cc.sys.localStorage.setItem(\"sfxVolume\",v);\r\n            this.sfxVolume = v;\r\n        }\r\n    },\r\n    \r\n    setBGMVolume:function(v,force){\r\n        if(this.bgmAudioID >= 0){\r\n            if(v > 0){\r\n                cc.audioEngine.resume(this.bgmAudioID);\r\n            }\r\n            else{\r\n                cc.audioEngine.pause(this.bgmAudioID);\r\n            }\r\n            //cc.audioEngine.setVolume(this.bgmAudioID,this.bgmVolume);\r\n        }\r\n        if(this.bgmVolume != v || force){\r\n            cc.sys.localStorage.setItem(\"bgmVolume\",v);\r\n            this.bgmVolume = v;\r\n            cc.audioEngine.setVolume(this.bgmAudioID,v);\r\n        }\r\n    },\r\n    \r\n    pauseAll:function(){\r\n        cc.audioEngine.pauseAll();\r\n    },\r\n    \r\n    resumeAll:function(){\r\n        cc.audioEngine.resumeAll();\r\n    }\r\n});\r\n"]}