{"version":3,"sources":["assets\\scripts\\kbe_scripts\\Avatar.js"],"names":["KBEngine","require","Avatar","Entity","extend","__init__","_super","isPlayer","cc","log","window","wx","undefined","sys","platform","WECHAT_GAME","decodeEncryptedData","Event","fire","onSetSpaceData","encryptedData","localStorage","getItem","iv","baseCall","reqChangeReadyState","cellCall","playerReadyStateChange","eid","state","quick_chat","idx","emoji","name","iptChat","strstr","onquick_chat","onjoinPrivateRoom","num","onemoji","oniptChat","joinRoom","INFO_MSG","id","createPrivateRoom","joinPrivateRoom","roomkey","game_begin_push","holds","onEnterWorld","onEnterWorld2","app","entity_id","onNewTurn","second","card1","card2","card3","card4","onsureact","strr","onsyncsureact","newTurn","onupdateGamestates","curID","time","onotherNetcut","avatarID","onDie","onGameOver","isWin","hitRate","totalTime","totalHarm","score","toString","updategamestuts","continueGame","onContinueGame"],"mappings":"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","sourceRoot":"/","sourcesContent":["/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tentity\r\n-----------------------------------------------------------------------------------------*/\r\n\r\nvar KBEngine = require(\"kbengine\");\r\n\r\nKBEngine.Avatar = KBEngine.Entity.extend({\r\n        __init__ : function()\r\n        {\r\n            this._super();\r\n            if(this.isPlayer()) {\r\n                cc.log(\"window.wx != undefined || window.wc=\",window.wx != undefined)\r\n                if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n                    this.decodeEncryptedData();\r\n                }                   \r\n                cc.log(\"KBEngine.Avatar._init_\")\r\n                KBEngine.Event.fire(\"enterScene\");\r\n            }\r\n        },\r\n        onSetSpaceData:function(){\r\n            cc.log(\"initSpaceDatainitSpaceDatainitSpaceDatainitSpaceData\")\r\n            KBEngine.Event.fire(\"onSetSpaceData\");\r\n\r\n        },\r\n        decodeEncryptedData: function()\r\n        {\r\n            var encryptedData = cc.sys.localStorage.getItem(\"encryptedData\");\r\n            var iv = cc.sys.localStorage.getItem(\"iv\");\r\n            cc.log(\"encryptedData && iv\",encryptedData , iv)\r\n            if(encryptedData && iv) {\r\n                cc.log(\"decodeEncryptedData\")\r\n                this.baseCall(\"decodeEncryptedData\", encryptedData, iv);\r\n            }\r\n        },\r\n        reqChangeReadyState:function(){\r\n            this.cellCall(\"reqChangeReadyState\",1);\r\n        },\r\n        playerReadyStateChange:function(eid,state){\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"playerReadyStateChange\", eid,state);\r\n            }\r\n\r\n        },\r\n        quick_chat:function(idx){\r\n            cc.log(\"quick_chat:cellCall\",idx)\r\n            this.cellCall(\"quick_chat\",idx);\r\n        },\r\n        emoji:function(name){\r\n            cc.log(\"emoji:cellCall\",name)\r\n            this.cellCall(\"emoji\",name);\r\n        },\r\n        iptChat:function(strstr){\r\n            cc.log(\"iptChat:cellCall\",strstr)\r\n            this.cellCall(\"iptChat\",strstr);\r\n        },\r\n        onquick_chat:function(eid,idx){\r\n            cc.log(\"quick_chat:receive\",eid,idx)\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"onquick_chat\", eid,idx);\r\n            }\r\n        },\r\n        onjoinPrivateRoom:function(num){\r\n            cc.log(\"onjoinPrivateRoom\", num)\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"onjoinPrivateRoom\", num);\r\n            }\r\n        },\r\n        onemoji:function(eid,name){\r\n            cc.log(\"emoji:receive\",eid,name)\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"onemoji\", eid,name);\r\n            }\r\n        },\r\n        oniptChat:function(eid,strstr){\r\n            cc.log(\"iptChat:receive\",eid,strstr)\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"oniptChat\", eid,strstr);\r\n            }\r\n        },\r\n        joinRoom: function()\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + this.id + \" join room\");\r\n            this.baseCall(\"joinRoom\");\r\n        },\r\n        createPrivateRoom: function()\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + this.id + \" createPrivateRoom\");\r\n            this.baseCall(\"createPrivateRoom\");\r\n        },\r\n        joinPrivateRoom: function(roomkey)\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + this.id + \" joinPrivateRoom\"+ roomkey);\r\n            this.baseCall(\"joinPrivateRoom\",roomkey);\r\n        },\r\n        game_begin_push:function(holds)   {\r\n            cc.log(\"Avatar::game_begin_push\")\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"game_begin_push\",this);\r\n            }\r\n        },\r\n        onEnterWorld : function()\r\n        {\r\n            cc.log(\"avatar.onEnterWorld.......\")\r\n            this._super();\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"onAvatarEnterWorld\", this);\r\n            }\t\t\r\n        },\r\n        onEnterWorld2 : function(eid)\r\n        {\r\n            cc.log(\"avatar.onEnterWorld2.......\",this.id , KBEngine.app.entity_id)\r\n\r\n            //this._super();\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"onEnterWorld2\", eid);\r\n            }\t\t\r\n        },\r\n\r\n\r\n        onNewTurn : function(eid,second,card1,card2,card3,card4)\r\n\t    {\r\n            KBEngine.INFO_MSG(\"avatar \" + eid + \" on new turn\");\r\n\t\t    KBEngine.Event.fire(\"newTurn\", this,eid,second,card1,card2,card3,card4);\r\n        }, \r\n        onsureact:function(strr){\r\n            this.cellCall(\"onsureact\", strr);\r\n        },\r\n        onsyncsureact:function(eid , strr){\r\n            cc.log(\"avatar::onsyncsureact== \", strr);\r\n            //KBEngine.Event.fire(\"onsyncsureact\", strr);\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"oniptChat\", eid,strr);\r\n            }\r\n\r\n        },\r\n        newTurn : function()\r\n\t    {\r\n            this.cellCall(\"newTurn\");\r\n        }, \r\n\r\n        \r\n        onupdateGamestates:function(curID,time){\r\n            KBEngine.INFO_MSG(\"onupdateGamestates \" + curID + \"/\" + time);\r\n            KBEngine.Event.fire(\"onupdateGamestates\", curID,time);\r\n        },\r\n        onotherNetcut: function(avatarID)\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + avatarID + \" Netcut\");\r\n            KBEngine.Event.fire(\"onotherNetcut\", avatarID);\r\n        },\r\n        onDie: function(avatarID)\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + avatarID + \" die\");\r\n            KBEngine.Event.fire(\"onAvatarDie\", avatarID);\r\n        },\r\n\r\n        onGameOver: function(isWin, hitRate, totalTime, totalHarm, score)\r\n        {\r\n            KBEngine.INFO_MSG(\"Game is over: avatar \" + this.id + \"win= \" + isWin.toString());\r\n            KBEngine.Event.fire(\"onGameOver\", this.id, isWin, hitRate, totalTime, totalHarm, score);\r\n        },\r\n        updategamestuts:function(num){\r\n            KBEngine.Event.fire(\"updategamestuts\",num);\r\n        },\r\n\r\n        continueGame: function()\r\n        {\r\n            this.cellCall(\"continueGame\");\r\n            KBEngine.INFO_MSG(\"avatar \" + this.id + \" continue game\");\r\n        },\r\n\r\n        onContinueGame: function(avatarID)\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + avatarID + \"on continue game, local avatarID=\" + this.id);\r\n            //KBEngine.Event.fire(\"onAvatarEnterWorld\", KBEngine.app.entity_uuid, this.id, this);\r\n            KBEngine.Event.fire(\"onAvatarEnterWorld\",this);\r\n        },\r\n\r\n       \r\n    });\r\n    \r\n    \r\n    "]}