{"version":3,"sources":["assets\\scripts\\cc_scripts\\StartScene.js"],"names":["KBEngine","require","WxBizDataCrypt","cc","Class","Component","properties","textinput_name","type","EditBox","label_hint","Label","EditBoxclick","log","userName","string","update","window","loginres","node","opacity","onLoad","initKbengine","installEvents","loader","loadRes","Prefab","err","prefab","JoinGame","instantiate","active","getChildByName","addChild","bind","btn_start","AudioMgr","init","sys","platform","WECHAT_GAME","randomstring","code","director","preloadScene","enableWxShare","wxLoginNative","placeholder","hello","wx","showShareMenu","withShareTicket","onShareAppMessage","title","imageUrl","SHARE_PICTURE","self","login","success","res","localStorage","setItem","sself","getUserInfo","withCredentials","encryptedData","iv","fail","visibleSize","view","getVisibleSize","wx_size","getSystemInfoSync","size_scale_width","screenHeight","height","x","width","y","btnAuthorize","createUserInfoButton","text","style","left","top","lineHeight","backgroundColor","color","textAlign","fontSize","borderRadius","onTap","uinfo","sf","console","errMsg","showToast","hide","L","s","randomchar","n","Math","floor","random","String","fromCharCode","length","args","KBEngineArgs","ip","SERVER_IP","port","SERVER_PORT","isWss","IS_USE_WSS","isByIP","LOGIN_BY_IP","serverURL","SERVER_URL","create","Event","register","unInstallEvents","deregister","onConnectionState","logStr","app","INFO_MSG","onConnectionState2","onLoginFailed","failedcode","serverErr","serverdatas","onReloginBaseappFailed","onReloginBaseappSuccessfully","onLoginBaseappFailed","decodeEncryptedData","getItem","sessionKey","pc","data","descrytData","onSetSpaceData","enterScene","player","loadScene","joinRoom","createPrivateRoom","privateRoomID","joinPrivateRoom","onLoginBaseapp","Loginapp_importClientMessages","Baseapp_importClientMessages","Baseapp_importClientEntityDef","createDictString","dic","dictString","len","pro","index","prop","startGame","event","datas","fire","joinPrivateRoominputcallback","roomId"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\nvar KBEngine = require(\"kbengine\");\r\nvar WxBizDataCrypt = require(\"WxBizDataCrypt\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        textinput_name:{\r\n            default: null,\r\n            type: cc.EditBox,\r\n        },\r\n\r\n        label_hint: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    EditBoxclick:function(){\r\n        cc.log(\"EditBoxclick\")\r\n       // window.AudioMgr.playSFX(\"ui_click\")\r\n        this.userName=this.textinput_name.string\r\n    },\r\n    update:function(){\r\n        if(window.loginres==0){\r\n            this.label_hint.string = \"输入房间ID无效,请重新输入房号\";\r\n            this.label_hint.node.opacity=255\r\n            //var action = cc.fadeTo(13.0, 0);\r\n            //this.label_hint.node.runAction(action);\r\n            //window.loginres=100\r\n        }\r\n        else if(window.loginres==1){\r\n            this.label_hint.string = \"房间已满！请重新输入房号\";\r\n            this.label_hint.node.opacity=255\r\n            //var action = cc.fadeTo(13.0, 0);\r\n            //this.label_hint.node.runAction(action);\r\n            //window.loginres=100\r\n        }\r\n    },\r\n    onLoad: function () {\r\n        \r\n        this.initKbengine();\r\n        this.installEvents();\r\n        cc.loader.loadRes(\"prefab/JoinGame\", cc.Prefab, function (err, prefab) {\r\n            if (err) {\r\n                cc.log(\"cc.loader.loadRes fail\")\r\n                return;\r\n            }\r\n            //cc.log(\"cc.loader.loadRes success\")\r\n            this.JoinGame = cc.instantiate(prefab);\r\n            this.JoinGame.active=false\r\n            this.node.getChildByName(\"start_bg\").addChild(this.JoinGame)\r\n//                this.FlyPoolDict[this.FlyPoolid]=newNode\r\n//                this.FlyPoolid++;\r\n        }.bind(this));\r\n        /*\r\n        // load the sprite frame of (project/assets/resources/imgs/cocos.png) from resources folder\r\n        cc.loader.loadRes('prefab/bg', cc.SpriteFrame, function (err, spriteFrame) {\r\n            if (err) {\r\n                cc.log(\"cc.loader.loadRes fail\")\r\n                return;\r\n            }\r\n            this.node.getChildByName(\"start_bg\").getComponent(cc.Sprite).spriteFrame=spriteFrame\r\n        }.bind(this));\r\n        */\r\n        this.btn_start=this.node.getChildByName(\"start_bg\").getChildByName(\"btn_start\")\r\n        //this.loadItemPrefab();\r\n        //window.AudioMgr=this.node.addComponent(\"AudioMgr\")      \r\n        var AudioMgr = require(\"AudioMgr\");\r\n        window.AudioMgr = new AudioMgr();\r\n        window.AudioMgr.init();\r\n\r\n        this.userName = cc.sys.platform != cc.sys.WECHAT_GAME ? this.randomstring(4): '';\r\n        //this.btn_start.node.on('click', this.startGame, this);\r\n        this.code = \"\";\r\n        \r\n        cc.director.preloadScene(\"WorldScene\");\r\n\r\n        if(cc.sys.platform == cc.sys.WECHAT_GAME) {\r\n            this.btn_start.active = false;\r\n            this.textinput_name.node.active = false;\r\n            this.enableWxShare();\r\n            this.wxLoginNative();\r\n            //window.wc=true;\r\n        } else {\r\n            this.textinput_name.placeholder=\"请输入你的昵称...\"\r\n            this.userName=this.textinput_name.string         \r\n        }\r\n        //window.AudioMgr.playBGM(\"bgm\")\r\n        cc.log(\"window.loginres=\",window.loginres)\r\n     },\r\n\r\n     hello () {\r\n        cc.log(\"hello world\");\r\n     },\r\n\r\n\r\n     enableWxShare: function () {\r\n        wx.showShareMenu({\r\n            withShareTicket:true,\r\n        });\r\n\r\n        wx.onShareAppMessage(function() {\r\n            return {\r\n                title: \"投石对战\",\r\n                imageUrl:SHARE_PICTURE,\r\n            }\r\n        });\r\n     },\r\n\r\n    wxLoginNative: function(){\r\n       this.btn_start.active = true;\r\n        var self=this;\r\n        wx.login({\r\n            success: (res) => {\r\n                if(res.code) {\r\n                    //sself.code = res.code;\r\n                    cc.sys.localStorage.setItem(\"userName\", res.code);\r\n                    cc.log(\"wxLoginNative success\")\r\n                    var sself=self;\r\n                    \r\n                    //在用户未授权过的情况下调用此接口，将不再出现授权弹窗，会直接进入 fail 回调\r\n                    wx.getUserInfo({\r\n                        withCredentials:1,\r\n                        success: (res) => {\r\n                            sself.btn_start.active = true;\r\n                            //sself.userName = this.code;                            \r\n                            cc.sys.localStorage.setItem(\"encryptedData\", res.encryptedData);\r\n                            cc.sys.localStorage.setItem(\"iv\", res.iv);\r\n                            cc.log(\"wxLoginNative() encryptedData && iv\",res.encryptedData , res.iv)\r\n                        },\r\n                        fail:(res)=>{\r\n                            cc.log(\"wx.getuserinfo fail\")\r\n                                //获取视图窗口可见区域尺寸\r\n                            let visibleSize = cc.view.getVisibleSize(); \r\n                            //获取系统信息\r\n                            let wx_size = wx.getSystemInfoSync();\r\n                            //计算实际大小和可见区域尺寸的比例（这里以宽度为准）\r\n                            let size_scale_width = wx_size.screenHeight / visibleSize.height;\r\n                            let x = (visibleSize.width / 2) * size_scale_width-(125 * size_scale_width);\r\n                            let y = ( visibleSize.height / 2 ) * size_scale_width;\r\n                            let width = 250 * size_scale_width;\r\n                            let height = 60 * size_scale_width;\r\n                            sself.btnAuthorize = wx.createUserInfoButton({\r\n                                type: 'text',\r\n                                text: '点击微信登陆授权',\r\n                                style: {\r\n                                    left: x,\r\n                                    top: y,\r\n                                    width: width,\r\n                                    height: height,\r\n                                    lineHeight: height,\r\n                                    backgroundColor: \"#ffffff\",\r\n                                    color: \"#3296fa\",\r\n                                    textAlign: \"center\",\r\n                                    fontSize: 16,\r\n                                    borderRadius: 0,\r\n                                }\r\n                            })\r\n                    \r\n                            sself.btnAuthorize.onTap((uinfo) => {\r\n                                var sf=sself\r\n                                console.log(\"onTap uinfo: \",uinfo);\r\n                                if (uinfo.errMsg == \"getUserInfo:ok\") {\r\n                                    console.log(\"wxLogin auth success\");\r\n                                    wx.showToast({title:\"授权成功\"});\r\n                                    cc.sys.localStorage.setItem(\"encryptedData\", uinfo.encryptedData);\r\n                                    cc.sys.localStorage.setItem(\"iv\", uinfo.iv);\r\n                                    //sf.label_hint.string = \"uinfo.encryptedData=\"+uinfo.encryptedData+\"/\"+uinfo.iv;\r\n                                    sf.label_hint.string = uinfo.encryptedData ;\r\n                                    sf.btn_start.active = true;\r\n                                }else {\r\n                                    console.log(\"wxLogin auth fail\");\r\n                                    wx.showToast({title:\"授权失败\"});\r\n                                }\r\n                                sf.btnAuthorize.hide(); //获取用户信息成功后隐藏按钮\r\n                            });\r\n\r\n                        },\r\n                    });\r\n\r\n                    /////////////////////////////\r\n                  \r\n\r\n\r\n\r\n                    /////////////////////////////////\r\n/*\r\n    //获取视图窗口可见区域尺寸\r\n    let visibleSize = cc.view.getVisibleSize(); \r\n    //获取系统信息\r\n    let wx_size = wx.getSystemInfoSync();\r\n    //计算实际大小和可见区域尺寸的比例（这里以宽度为准）\r\n    let size_scale_width = wx_size.screenWidth / visibleSize.width;\r\n    //计算创建用户信息按钮需要的属性（img_auth为蓝色参考节点）\r\n    let x = (visibleSize.width / 2) * size_scale_width;\r\n    let y = ( visibleSize.height / 2 ) * size_scale_width;\r\n    let width = 360 * size_scale_width;\r\n    let height = 360 * size_scale_width;\r\n\r\n    sself.authorButton = wx.createUserInfoButton({\r\n      type: \"text\",\r\n      text: \"授权按钮\",\r\n      style: {\r\n        left: x,\r\n        top: y,\r\n        width: width,\r\n        height: height,\r\n        lineHeight: height,\r\n        backgroundColor: \"#ffffff\",\r\n        color: \"#3296fa\",\r\n        textAlign: \"center\",\r\n        fontSize: 16,\r\n        borderRadius: 0,\r\n      },\r\n    });\r\n    sself.authorButton.onTap((res) => {\r\n      if (res.errMsg == \"getUserInfo:ok\") {\r\n        cc.log(\"wxLoginNative() encryptedData && iv\",res.encryptedData , res.iv)\r\n        sself.btn_start.node.active = true;\r\n        cc.sys.localStorage.setItem(\"encryptedData\", res.encryptedData);\r\n        cc.sys.localStorage.setItem(\"iv\", res.iv);\r\n        wx.showToast({\r\n          icon: \"none\",\r\n          title: \"获取用户信息成功\",\r\n          duration: 2000,\r\n        });\r\n        sself.authorButton.hide(); //获取用户信息成功后隐藏按钮\r\n      } else {\r\n        if (res.errMsg === \"getUserInfo:fail auth deny\") {\r\n          wx.showToast({\r\n            icon: \"none\",\r\n            title: \"获取用户信息失败\",\r\n            duration: 2000,\r\n          });\r\n        } else {\r\n          wx.showToast({\r\n            icon: \"none\",\r\n            title: res.errMsg,\r\n            duration: 2000,\r\n          });\r\n        }\r\n      }\r\n    });\r\n                   \r\n     */       \r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n     randomstring: function(L){\r\n        var s= '';\r\n        var randomchar=function(){\r\n         var n= Math.floor(Math.random()*62);\r\n         if(n<10) return n; //0-9\r\n         if(n<36) return String.fromCharCode(n+55); //A-Z\r\n         return String.fromCharCode(n+61); //a-z\r\n        }\r\n        while(s.length< L) s+= randomchar();\r\n        return s;\r\n    },\r\n\r\n\r\n     initKbengine: function() {\r\n        var args = new KBEngine.KBEngineArgs();\t\r\n\t    args.ip = SERVER_IP;\r\n        args.port = SERVER_PORT;\r\n        args.isWss = IS_USE_WSS;              //是否用wss协议， true:wss  false:ws\r\n        args.isByIP = LOGIN_BY_IP;             //用ip还是用域名登录服务器   有修改官方的kbengine.js\r\n        args.serverURL = SERVER_URL;\r\n\t    KBEngine.create(args);\r\n     },\r\n\r\n     installEvents:function() {\r\n        KBEngine.Event.register(\"onConnectionState\", this, \"onConnectionState\");\r\n        KBEngine.Event.register(\"onConnectionState2\", this, \"onConnectionState2\");\r\n        KBEngine.Event.register(\"onLoginFailed\", this, \"onLoginFailed\");\r\n        KBEngine.Event.register(\"onLoginBaseappFailed\", this, \"onLoginBaseappFailed\");\r\n\t\tKBEngine.Event.register(\"enterScene\", this, \"enterScene\");\r\n        KBEngine.Event.register(\"onReloginBaseappFailed\", this, \"onReloginBaseappFailed\");\r\n        KBEngine.Event.register(\"onReloginBaseappSuccessfully\", this, \"onReloginBaseappSuccessfully\");\r\n        KBEngine.Event.register(\"onLoginBaseapp\", this, \"onLoginBaseapp\");\r\n        KBEngine.Event.register(\"onSetSpaceData\", this, \"onSetSpaceData\");\r\n        \r\n     },\r\n\r\n     unInstallEvents() {\r\n        KBEngine.Event.deregister(\"onConnectionState\", this, \"onConnectionState\");\r\n        KBEngine.Event.deregister(\"onConnectionState2\", this, \"onConnectionState2\");\r\n        KBEngine.Event.deregister(\"onLoginFailed\", this, \"onLoginFailed\");\r\n        KBEngine.Event.deregister(\"onLoginBaseappFailed\", this, \"onLoginBaseappFailed\");\r\n\t\tKBEngine.Event.deregister(\"enterScene\", this, \"enterScene\");\r\n        KBEngine.Event.deregister(\"onReloginBaseappFailed\", this, \"onReloginBaseappFailed\");\r\n        KBEngine.Event.deregister(\"onReloginBaseappSuccessfully\", this, \"onReloginBaseappSuccessfully\");\r\n        KBEngine.Event.deregister(\"onLoginBaseapp\", this, \"onLoginBaseapp\");\r\n        KBEngine.Event.deregister(\"onSetSpaceData\", this, \"onSetSpaceData\");\r\n        \r\n     },\r\n\r\n     onConnectionState : function(success) {\r\n        var logStr = \"\";\r\n\t\tif(!success) {\r\n            logStr = \" Connect(\" + KBEngine.app.ip + \":\" + KBEngine.app.port + \") is error! (连接错误)\";\r\n            this.btn_start.active = true;\r\n            this.label_hint.string = \"连接错误onerror_before_onopen\";\r\n        }\r\n\t\telse {\r\n            logStr = \"Connect successfully, please wait...(连接成功，请等候...)\";\r\n        }\r\n     \r\n        KBEngine.INFO_MSG(logStr);\r\n    },\r\n    onConnectionState2 : function(success) {\r\n        var logStr = \"\";\r\n\t\tif(!success) {\r\n            logStr = \" Connect(\" + KBEngine.app.ip + \":\" + KBEngine.app.port + \") is error! (连接错误)\";\r\n            this.btn_start.active = true;\r\n            this.label_hint.string = \"连接错误socket not is null\";\r\n        }\r\n\t\telse {\r\n            logStr = \"Connect successfully, please wait...(连接成功，请等候...)\";\r\n        }\r\n     \r\n        KBEngine.INFO_MSG(logStr);\r\n\t},\r\n\r\n     onLoginFailed : function(failedcode) {\r\n        var logStr = '';\r\n        if(failedcode == 20)\r\n        {\r\n           logStr = \"Login is failed(登陆失败), err=\" + KBEngine.app.serverErr(failedcode) + \", \" + KBEngine.app.serverdatas;\r\n        }\r\n        else\r\n        {\r\n           logStr = \"Login is failed(登陆失败), err=\" + KBEngine.app.serverErr(failedcode);\r\n        }    \r\n        \r\n        this.label_hint.string = \"登陆失败,\" +  KBEngine.app.serverErr(failedcode);\r\n        this.btn_start.active = true;\r\n        KBEngine.INFO_MSG(logStr);\t\r\n     },\r\n\r\n     onReloginBaseappFailed: function(failedcode){\r\n        this.btn_start.active = true;\r\n        KBEngine.INFO_MSG(\"reogin is failed(断线重连失败), err=\" + KBEngine.app.serverErr(failedcode))\r\n     },\r\n\r\n     onReloginBaseappSuccessfully : function() {\r\n        KBEngine.INFO_MSG(\"reogin is successfully!(断线重连成功!)\")\r\n    },\r\n\r\n     onLoginBaseappFailed : function(failedcode) {\r\n        this.btn_start.active = true;\r\n        KBEngine.INFO_MSG(\"LoginBaseapp is failed(登陆网关失败), err=\" + KBEngine.app.serverErr(failedcode));\r\n     },\r\n\r\n     decodeEncryptedData:function() {\r\n        var encryptedData = cc.sys.localStorage.getItem(\"encryptedData\");\r\n        var sessionKey = cc.sys.localStorage.getItem(\"sessionKey\");\r\n        var iv = cc.sys.localStorage.getItem(\"iv\");\r\n        KBEngine.INFO_MSG(\"decodeEncryptedData: encryptedData=\" + encryptedData + \" ,iv=\" + iv + \" ,sessionKey=\" + sessionKey);\r\n        if(sessionKey && encryptedData && iv) {\r\n            //var pc = new WxBizDataCrypt(APPID, sessionKey);\r\n            var pc = new WxBizDataCrypt(\"wxbe1644556ed8afa6\", \"96c0e22af25571db5f175ebbb550e672\");\r\n            var data = pc.descrytData(encryptedData , iv);\r\n            console.log('解密后 data: ', data)\r\n        }\r\n     },\r\n     onSetSpaceData:function(){\r\n         cc.log(\"startscene.onSetSpaceData\")\r\n     },  \r\n     enterScene : function() {\r\n        KBEngine.INFO_MSG(\"Login is successfully!(登陆成功!)\");\r\n        this.label_hint.string = \"登陆成功 !!!\";\r\n        if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n            var player = KBEngine.app.player();\r\n            var encryptedData = cc.sys.localStorage.getItem(\"encryptedData\");\r\n            var iv = cc.sys.localStorage.getItem(\"iv\");\r\n            cc.log(\"encryptedData && iv\",encryptedData , iv)\r\n            this.label_hint.string = \"base.decodeEncryptedData()=\" + encryptedData + \"/\" + iv;\r\n            player.decodeEncryptedData();\r\n        } \r\n        //var player = KBEngine.app.player();//KBEngine.app.entities[KBEngine.app.entity_id];    \r\n        //player.joinRoom()\r\n\r\n        cc.director.loadScene(\"WorldScene\", ()=> {\r\n            KBEngine.INFO_MSG(\"load world scene finished\");\r\n            var player = KBEngine.app.player();//KBEngine.app.entities[KBEngine.app.entity_id];\r\n            //window.type=1\r\n            if(player){\r\n                if (window.type==1){\r\n                    player.joinRoom();\r\n                }\r\n                if (window.type==2){\r\n                    player.createPrivateRoom();\r\n                    \r\n                }\r\n                if (window.type==3 && window.privateRoomID.length>0){\r\n                    player.joinPrivateRoom(window.privateRoomID);                    \r\n                }                \r\n            }\r\n            this.unInstallEvents();           \r\n        });\r\n           \r\n     \r\n        \r\n         /*\r\n        KBEngine.INFO_MSG(\"Login is successfully!(登陆成功!)\");\r\n        this.label_hint.string = \"登陆成功 !!!\";\r\n        if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n            var player = KBEngine.app.player();\r\n            var encryptedData = cc.sys.localStorage.getItem(\"encryptedData\");\r\n            var iv = cc.sys.localStorage.getItem(\"iv\");\r\n            cc.log(\"encryptedData && iv\",encryptedData , iv)\r\n            this.label_hint.string = \"base.decodeEncryptedData()=\" + encryptedData + \"/\" + iv;\r\n            //player.decodeEncryptedData();\r\n        }                \r\n        cc.director.loadScene(\"WorldScene\", ()=> {\r\n            KBEngine.INFO_MSG(\"load world scene finished\");\r\n            var player = KBEngine.app.player();//KBEngine.app.entities[KBEngine.app.entity_id];\r\n            if(player){\r\n                player.joinRoom();\r\n            }\r\n                \r\n        });\r\n        this.unInstallEvents();\r\n        */\r\n     },\r\n \r\n     onLoginBaseapp : function() {\r\n        cc.log(\"Connect to loginBaseapp, please wait...(连接到网关， 请稍后...)\");\r\n     },\r\n \r\n     Loginapp_importClientMessages : function() {\r\n        this.label_hint.string = \"登陆中 ... ...\";\r\n        cc.log(\"Loginapp_importClientMessages ...\");\r\n     },\r\n \r\n     Baseapp_importClientMessages : function() {\r\n         cc.log(\"Baseapp_importClientMessages ..\");\r\n     },\r\n         \r\n     Baseapp_importClientEntityDef: function() {\r\n         cc.log(\"Baseapp_importClientEntityDef ..\")\r\n     },\r\n\r\n     createDictString: function(dic) {\r\n        var dictString = \"\";\r\n        var len = 0;\r\n        for(var pro in dic) len++;\r\n\r\n        if(len > 0) {\r\n            var index = 0;\r\n            var dictString = \"{\"\r\n            for(var prop in dic) {\r\n                dictString += \"'\" + prop + \"'\" ;\r\n                dictString += \":\";\r\n                dictString += \"'\" + dic[prop] + \"'\";\r\n                if(index == len-1) {\r\n                    dictString += \"}\";\r\n                }else {\r\n                    dictString += \",\";\r\n                }\r\n                index++;\r\n            }\r\n        }\r\n\r\n        return dictString;\r\n     },\r\n \r\n     startGame: function (event) {\r\n        window.loginres=100;\r\n        // window.AudioMgr.playSFX(\"ui_click\")\r\n         //cc.log(\"cc.sys.platform\",cc.sys.platform,cc.sys.WECHAT_GAME)\r\n         window.type=1\r\n         if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n             this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n         }\r\n         if(this.userName.length == 0)\r\n         {\r\n             this.label_hint.string = \"用户名不能为空\";\r\n             return;\r\n         }\r\n         ///////////////////////////////////////////////////\r\n \r\n \r\n         //////////////////////////////////////////////////\r\n         cc.log(\"this.userName=\", this.userName)  \r\n         var datas = {};\r\n         datas[\"platform\"] = cc.sys.platform;\r\n         datas = this.createDictString(datas);\r\n         KBEngine.INFO_MSG(\"login name=\" + this.userName);\r\n         //var temp1=UnicodeToUtf8(this.userName)\r\n         //this.userName =java.net.URLDecoder.decode(temp,\"UTF-8\"); \r\n         //this.userName =Utf8ToUnicode(temp1)\r\n         //cc.log(\"this.userName=\",this.userName)  \r\n         KBEngine.Event.fire(\"login\", this.userName, \"123456\", datas);  \r\n         this.label_hint.string = \"登陆中 ... ...\";\r\n         this.btn_start.active = false;\r\n         \r\n         /*\r\n\t    this.login = function(username, password, datas)\r\n\t    {  \r\n\t\t    KBEngine.app.reset();\r\n\t\t    KBEngine.app.username = username;\r\n\t\t    KBEngine.app.password = password;\r\n\t\t    KBEngine.app.clientdatas = datas;\r\n\t\t\r\n\t\t    KBEngine.app.login_loginapp(true);\r\n\t    }\r\n\r\n\r\n         */\r\n \r\n      },\r\n      createPrivateRoom: function (event) {\r\n        window.loginres=100; \r\n         window.type=2\r\n         // window.AudioMgr.playSFX(\"ui_click\")\r\n          //cc.log(\"cc.sys.platform\",cc.sys.platform,cc.sys.WECHAT_GAME)\r\n          if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n              this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n          }\r\n          if(this.userName.length == 0)\r\n          {\r\n              this.label_hint.string = \"用户名不能为空\";\r\n              return;\r\n          }\r\n          cc.log(\"this.userName=\",this.userName)  \r\n          var datas = {};\r\n          datas[\"platform\"] = cc.sys.platform;\r\n          datas = this.createDictString(datas);\r\n          KBEngine.INFO_MSG(\"login name=\" + this.userName);\r\n          //var temp1=UnicodeToUtf8(this.userName)\r\n          //this.userName =java.net.URLDecoder.decode(temp,\"UTF-8\"); \r\n          //this.userName =Utf8ToUnicode(temp1)\r\n          //cc.log(\"this.userName=\",this.userName)  \r\n          KBEngine.Event.fire(\"login\", this.userName, \"123456\", datas);  \r\n          this.label_hint.string = \"登陆中 ... ...\";\r\n          this.btn_start.active = false;\r\n       },\r\n       joinPrivateRoominputcallback:function(roomId){ //参数是数组\r\n         window.type=3\r\n         window.loginres=100;\r\n         window.privateRoomID=roomId\r\n         this.JoinGame.active=false\r\n           //////////////////////////////////////////////////\r\n          cc.log(\"this.userName=\",this.userName,roomId)  \r\n          var datas = {};\r\n          datas[\"platform\"] = cc.sys.platform;\r\n          datas = this.createDictString(datas);\r\n          KBEngine.INFO_MSG(\"login name=\" + this.userName);\r\n          //var temp1=UnicodeToUtf8(this.userName)\r\n          //this.userName =java.net.URLDecoder.decode(temp,\"UTF-8\"); \r\n          //this.userName =Utf8ToUnicode(temp1)\r\n          //cc.log(\"this.userName=\",this.userName)  \r\n          KBEngine.Event.fire(\"login\", this.userName, \"123456\", datas);  \r\n          this.label_hint.string = \"登陆中 ... ...\";\r\n          this.btn_start.active = false;\r\n \r\n       },\r\n       joinPrivateRoom: function (event) {\r\n         \r\n         //window.AudioMgr.playSFX(\"ui_click\")\r\n          //cc.log(\"cc.sys.platform\",cc.sys.platform,cc.sys.WECHAT_GAME)\r\n \r\n          \r\n          if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n              this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n          }\r\n          if(this.userName.length == 0)\r\n          {\r\n              this.label_hint.string = \"用户名不能为空\";\r\n              return;\r\n          }\r\n          this.JoinGame.active=true\r\n          ///////////////////////////////////////////////////\r\n  \r\n  \r\n          \r\n       },\r\n\r\n\r\n\r\n});\r\n"]}