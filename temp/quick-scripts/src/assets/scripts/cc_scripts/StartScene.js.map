{"version":3,"sources":["assets\\scripts\\cc_scripts\\StartScene.js"],"names":["KBEngine","require","WxBizDataCrypt","cc","Class","Component","properties","textinput_name","type","EditBox","label_hint","Label","start","sys","platform","WECHAT_GAME","getQuery","parseRoomID","nums","forEach","item","index","parseInt","qData","obj","wx","getLaunchOptionsSync","s","query","Roomid","string2Result","split","window","roomIID","UserName","invateAcountname","EditBoxclick","log","AudioMgr","playSFX","userName","string","update","dt","loginres","node","opacity","length","btn_accept","active","getChildByName","getComponent","stopAllActions","action1","scaleTo","action2","repeat","repeatForever","sequence","runAction","accept_wx","localStorage","getItem","joinPrivateRoominputcallback","onLoad","sum","initKbengine","installEvents","loader","loadRes","Prefab","err","prefab","JoinGame","instantiate","addChild","bind","btn_start","init","bgmVolume","sfxVolume","randomstring","code","director","preloadScene","enableWxShare","wxLoginNative","placeholder","hello","showShareMenu","data","onShareAppMessage","res","title","imageUrl","url","success","fail","self","login","setItem","sself","getUserInfo","withCredentials","encryptedData","iv","visibleSize","view","getVisibleSize","wx_size","getSystemInfoSync","size_scale_width","screenHeight","height","x","width","y","btnAuthorize","createUserInfoButton","text","style","left","top","lineHeight","backgroundColor","color","textAlign","fontSize","borderRadius","onTap","uinfo","sf","console","errMsg","showToast","hide","L","randomchar","n","Math","floor","random","String","fromCharCode","args","KBEngineArgs","ip","SERVER_IP","port","SERVER_PORT","isWss","IS_USE_WSS","isByIP","LOGIN_BY_IP","serverURL","SERVER_URL","create","Event","register","unInstallEvents","deregister","onConnectionState","logStr","app","INFO_MSG","onConnectionState2","onLoginFailed","failedcode","serverErr","serverdatas","onReloginBaseappFailed","onReloginBaseappSuccessfully","onLoginBaseappFailed","decodeEncryptedData","sessionKey","pc","descrytData","onSetSpaceData","enterScene","player","loadScene","joinRoom","createPrivateRoom","joinPrivateRoom","onLoginBaseapp","Loginapp_importClientMessages","Baseapp_importClientMessages","Baseapp_importClientEntityDef","createDictString","dic","dictString","len","pro","prop","startGame","event","datas","fire","roomId"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\nvar KBEngine = require(\"kbengine\");\r\nvar WxBizDataCrypt = require(\"WxBizDataCrypt\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        textinput_name:{\r\n            default: null,\r\n            type: cc.EditBox,\r\n        },\r\n\r\n        label_hint: {\r\n            default: null,\r\n            type: cc.Label,\r\n        },\r\n    },\r\n    start()\r\n    {\r\n        if(cc.sys.platform == cc.sys.WECHAT_GAME) {\r\n            this.getQuery()\r\n        }\r\n    },\r\n    parseRoomID:function(nums){\r\n        //var str = \"\";\r\n        nums.forEach((item,index) =>{\r\n\t        nums[index] = parseInt(nums[index])\r\n        })\r\n        return nums; //转成数字数组\r\n    },\r\n    getQuery:function()\r\n        {\r\n            var qData = {};\r\n            var obj = wx.getLaunchOptionsSync();\r\n            for (var s in obj.query) //obj.query={}\r\n            {\r\n                if(s == \"Roomid\"){\r\n                    qData.Roomid = obj.query[s];\r\n                              \r\n\r\n                    var string2Result = qData.Roomid.split('') //字符串变成字符串数组\r\n                    window.roomIID=this.parseRoomID(string2Result)\r\n\r\n                    \r\n                }\r\n                if(s == \"UserName\"){\r\n                    qData.UserName = obj.query[s];\r\n                    window.invateAcountname=obj.query[s]\r\n\r\n                }\r\n\r\n            }\r\n\r\n            return qData;\r\n        },\r\n    \r\n    // LIFE-CYCLE CALLBACKS:\r\n    EditBoxclick:function(){\r\n        cc.log(\"EditBoxclick\")\r\n        window.AudioMgr.playSFX(\"ui_click\")\r\n        this.userName=this.textinput_name.string\r\n    },\r\n    update:function(dt){\r\n        //this.sum=this.sum+dt;\r\n        if(window.loginres==0){\r\n            this.label_hint.string = \"输入房间ID无效,请重新输入房号\";\r\n            this.label_hint.node.opacity=255\r\n        }\r\n        else if(window.loginres==1){\r\n            this.label_hint.string = \"房间已满！请重新输入房号\";\r\n            this.label_hint.node.opacity=255\r\n        }\r\n        //cc.log(\"roomid=\", window.roomID)\r\n        if(window.roomIID.length >0){           \r\n           this.btn_accept.active=true;\r\n           this.btn_accept.getChildByName(\"Background\").getChildByName(\"Label\").getComponent(cc.Label).string=\"确认接受\"+ window.invateAcountname +\"的邀请！\"\r\n           //this.btn_start.active=false;\r\n           this.btn_accept.stopAllActions()\r\n           var action1 = cc.scaleTo(0.5,1.2);//渐显\r\n           var action2 = cc.scaleTo(0.5,1);//渐隐效果\r\n           var repeat=cc.repeatForever(cc.sequence(action1,action2))\r\n           this.btn_accept.runAction(repeat);\r\n\r\n            \r\n        }\r\n    },\r\n    accept_wx(){\r\n        window.AudioMgr.playSFX(\"ui_click\")\r\n        this.btn_accept.active=false;\r\n        this.btn_accept.stopAllActions()\r\n        this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n        this.joinPrivateRoominputcallback(window.roomIID)\r\n    },\r\n    onLoad: function () {\r\n        this.sum=0;      \r\n        this.initKbengine();\r\n        this.installEvents();\r\n        cc.loader.loadRes(\"prefab/JoinGame\", cc.Prefab, function (err, prefab) {\r\n            if (err) {\r\n                cc.log(\"cc.loader.loadRes fail\")\r\n                return;\r\n            }\r\n            //cc.log(\"cc.loader.loadRes success\")\r\n            this.JoinGame = cc.instantiate(prefab);\r\n            this.JoinGame.active=false\r\n            this.node.getChildByName(\"start_bg\").addChild(this.JoinGame)\r\n//                this.FlyPoolDict[this.FlyPoolid]=newNode\r\n//                this.FlyPoolid++;\r\n        }.bind(this));\r\n        \r\n        this.btn_start=this.node.getChildByName(\"start_bg\").getChildByName(\"btn_start\")\r\n\r\n        this.btn_accept=this.node.getChildByName(\"start_bg\").getChildByName(\"accept\")\r\n        this.btn_accept.active=false;\r\n        this.btn_accept.stopAllActions()\r\n        \r\n        //this.loadItemPrefab();\r\n        //window.AudioMgr=this.node.addComponent(\"AudioMgr\")      \r\n        var AudioMgr = require(\"AudioMgr\");\r\n        window.AudioMgr = new AudioMgr();\r\n        window.AudioMgr.init();\r\n        window.AudioMgr.bgmVolume=0.5\r\n        window.AudioMgr.sfxVolume=0.5\r\n\r\n        this.userName = cc.sys.platform != cc.sys.WECHAT_GAME ? this.randomstring(4): '';\r\n        //this.btn_start.node.on('click', this.startGame, this);\r\n        this.code = \"\";\r\n        \r\n        cc.director.preloadScene(\"WorldScene\");\r\n\r\n        if(cc.sys.platform == cc.sys.WECHAT_GAME) {\r\n            this.btn_start.active = false;\r\n            this.textinput_name.node.active = false;\r\n            this.enableWxShare();\r\n            this.wxLoginNative();\r\n            //window.wc=true;\r\n        } else {\r\n            this.textinput_name.placeholder=\"请输入你的昵称...\"\r\n            this.userName=this.textinput_name.string         \r\n        }\r\n        //window.AudioMgr.playBGM(\"bgm\")\r\n        cc.log(\"window.loginres=\",window.loginres)\r\n\r\n\r\n     },\r\n\r\n     hello () {\r\n        cc.log(\"hello world\");\r\n     },\r\n\r\n\r\n     enableWxShare: function () {\r\n        wx.showShareMenu();\r\n\r\n        cc.loader.loadRes(\"sound/share\",function(err,data){\r\n           // wx.shareAppMessage({   //打开小游戏自动分享\r\n           wx.onShareAppMessage(function(res){\r\n               return{\r\n                title: \"24点 智力小PK\",\r\n                imageUrl: data.url,\r\n                //query: \"Roomid=\" + self.roomKeyc + \"&UserName=\" + KBEngine.app.entities[KBEngine.app.player().id].accountName,// 别人点击链接时会得到的数据\r\n                //query: \"nick=\" + nick + \"&gender=\" + gender + \"&city=\" + city,\r\n                //query:\"Roomid=\"+ self.roomKeyc+\"&UserName=\"+ KBEngine.app.entities[KBEngine.app.player().id].accountName,\r\n                success(res) {               \r\n                   \r\n                    \r\n                    cc.log(\"分享成功\" + res);\r\n                    //this.yaoqing.active=false                      \r\n                },\r\n                fail(res) {\r\n                    cc.log(\"分享失败\" + res);\r\n                    //this.yaoqing.active=true\r\n                }\r\n            }\r\n                \r\n            });\r\n        });\r\n     },\r\n\r\n    wxLoginNative: function(){\r\n       this.btn_start.active = true;\r\n        var self=this;\r\n        wx.login({\r\n            success: (res) => {\r\n                if(res.code) {\r\n                    //sself.code = res.code;\r\n                    cc.sys.localStorage.setItem(\"userName\", res.code);\r\n                    cc.log(\"wxLoginNative success\")\r\n                    var sself=self;\r\n                    \r\n                    //在用户未授权过的情况下调用此接口，将不再出现授权弹窗，会直接进入 fail 回调\r\n                    wx.getUserInfo({\r\n                        withCredentials:1,\r\n                        success: (res) => {\r\n                            sself.btn_start.active = true;\r\n                            //sself.userName = this.code;                            \r\n                            cc.sys.localStorage.setItem(\"encryptedData\", res.encryptedData);\r\n                            cc.sys.localStorage.setItem(\"iv\", res.iv);\r\n                            cc.log(\"wxLoginNative() encryptedData && iv\",res.encryptedData , res.iv)\r\n                        },\r\n                        fail:(res)=>{\r\n                            cc.log(\"wx.getuserinfo fail\")\r\n                                //获取视图窗口可见区域尺寸\r\n                            let visibleSize = cc.view.getVisibleSize(); \r\n                            //获取系统信息\r\n                            let wx_size = wx.getSystemInfoSync();\r\n                            //计算实际大小和可见区域尺寸的比例（这里以宽度为准）\r\n                            let size_scale_width = wx_size.screenHeight / visibleSize.height;\r\n                            let x = (visibleSize.width / 2) * size_scale_width-(125 * size_scale_width);\r\n                            let y = ( visibleSize.height / 2 ) * size_scale_width;\r\n                            let width = 250 * size_scale_width;\r\n                            let height = 60 * size_scale_width;\r\n                            sself.btnAuthorize = wx.createUserInfoButton({\r\n                                type: 'text',\r\n                                text: '点击微信登陆授权',\r\n                                style: {\r\n                                    left: x,\r\n                                    top: y,\r\n                                    width: width,\r\n                                    height: height,\r\n                                    lineHeight: height,\r\n                                    backgroundColor: \"#ffffff\",\r\n                                    color: \"#3296fa\",\r\n                                    textAlign: \"center\",\r\n                                    fontSize: 16,\r\n                                    borderRadius: 0,\r\n                                }\r\n                            })\r\n                    \r\n                            sself.btnAuthorize.onTap((uinfo) => {\r\n                                var sf=sself\r\n                                console.log(\"onTap uinfo: \",uinfo);\r\n                                if (uinfo.errMsg == \"getUserInfo:ok\") {\r\n                                    console.log(\"wxLogin auth success\");\r\n                                    wx.showToast({title:\"授权成功\"});\r\n                                    cc.sys.localStorage.setItem(\"encryptedData\", uinfo.encryptedData);\r\n                                    cc.sys.localStorage.setItem(\"iv\", uinfo.iv);\r\n                                    //sf.label_hint.string = \"uinfo.encryptedData=\"+uinfo.encryptedData+\"/\"+uinfo.iv;\r\n                                    sf.label_hint.string = uinfo.encryptedData ;\r\n                                    sf.btn_start.active = true;\r\n                                }else {\r\n                                    console.log(\"wxLogin auth fail\");\r\n                                    wx.showToast({title:\"授权失败\"});\r\n                                }\r\n                                sf.btnAuthorize.hide(); //获取用户信息成功后隐藏按钮\r\n                            });\r\n\r\n                        },\r\n                    });     \r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n     randomstring: function(L){\r\n        var s= '';\r\n        var randomchar=function(){\r\n         var n= Math.floor(Math.random()*62);\r\n         if(n<10) return n; //0-9\r\n         if(n<36) return String.fromCharCode(n+55); //A-Z\r\n         return String.fromCharCode(n+61); //a-z\r\n        }\r\n        while(s.length< L) s+= randomchar();\r\n        return s;\r\n    },\r\n\r\n\r\n     initKbengine: function() {\r\n        var args = new KBEngine.KBEngineArgs();\t\r\n\t    args.ip = SERVER_IP;\r\n        args.port = SERVER_PORT;\r\n        args.isWss = IS_USE_WSS;              //是否用wss协议， true:wss  false:ws\r\n        args.isByIP = LOGIN_BY_IP;             //用ip还是用域名登录服务器   有修改官方的kbengine.js\r\n        args.serverURL = SERVER_URL;\r\n\t    KBEngine.create(args);\r\n     },\r\n\r\n     installEvents:function() {\r\n        KBEngine.Event.register(\"onConnectionState\", this, \"onConnectionState\");\r\n        KBEngine.Event.register(\"onConnectionState2\", this, \"onConnectionState2\");\r\n        KBEngine.Event.register(\"onLoginFailed\", this, \"onLoginFailed\");\r\n        KBEngine.Event.register(\"onLoginBaseappFailed\", this, \"onLoginBaseappFailed\");\r\n\t\tKBEngine.Event.register(\"enterScene\", this, \"enterScene\");\r\n        KBEngine.Event.register(\"onReloginBaseappFailed\", this, \"onReloginBaseappFailed\");\r\n        KBEngine.Event.register(\"onReloginBaseappSuccessfully\", this, \"onReloginBaseappSuccessfully\");\r\n        KBEngine.Event.register(\"onLoginBaseapp\", this, \"onLoginBaseapp\");\r\n        KBEngine.Event.register(\"onSetSpaceData\", this, \"onSetSpaceData\");\r\n        \r\n     },\r\n\r\n     unInstallEvents() {\r\n        KBEngine.Event.deregister(\"onConnectionState\", this, \"onConnectionState\");\r\n        KBEngine.Event.deregister(\"onConnectionState2\", this, \"onConnectionState2\");\r\n        KBEngine.Event.deregister(\"onLoginFailed\", this, \"onLoginFailed\");\r\n        KBEngine.Event.deregister(\"onLoginBaseappFailed\", this, \"onLoginBaseappFailed\");\r\n\t\tKBEngine.Event.deregister(\"enterScene\", this, \"enterScene\");\r\n        KBEngine.Event.deregister(\"onReloginBaseappFailed\", this, \"onReloginBaseappFailed\");\r\n        KBEngine.Event.deregister(\"onReloginBaseappSuccessfully\", this, \"onReloginBaseappSuccessfully\");\r\n        KBEngine.Event.deregister(\"onLoginBaseapp\", this, \"onLoginBaseapp\");\r\n        KBEngine.Event.deregister(\"onSetSpaceData\", this, \"onSetSpaceData\");\r\n        \r\n     },\r\n\r\n     onConnectionState : function(success) {\r\n        var logStr = \"\";\r\n\t\tif(!success) {\r\n            logStr = \" Connect(\" + KBEngine.app.ip + \":\" + KBEngine.app.port + \") is error! (连接错误)\";\r\n            this.btn_start.active = true;\r\n            this.label_hint.string = \"连接错误onerror_before_onopen\";\r\n        }\r\n\t\telse {\r\n            logStr = \"Connect successfully, please wait...(连接成功，请等候...)\";\r\n        }\r\n     \r\n        KBEngine.INFO_MSG(logStr);\r\n    },\r\n    onConnectionState2 : function(success) {\r\n        var logStr = \"\";\r\n\t\tif(!success) {\r\n            logStr = \" Connect(\" + KBEngine.app.ip + \":\" + KBEngine.app.port + \") is error! (连接错误)\";\r\n            this.btn_start.active = true;\r\n            this.label_hint.string = \"连接错误socket not is null\";\r\n        }\r\n\t\telse {\r\n            logStr = \"Connect successfully, please wait...(连接成功，请等候...)\";\r\n        }\r\n     \r\n        KBEngine.INFO_MSG(logStr);\r\n\t},\r\n\r\n     onLoginFailed : function(failedcode) {\r\n        var logStr = '';\r\n        if(failedcode == 20)\r\n        {\r\n           logStr = \"Login is failed(登陆失败), err=\" + KBEngine.app.serverErr(failedcode) + \", \" + KBEngine.app.serverdatas;\r\n        }\r\n        else\r\n        {\r\n           logStr = \"Login is failed(登陆失败), err=\" + KBEngine.app.serverErr(failedcode);\r\n        }    \r\n        \r\n        this.label_hint.string = \"登陆失败,\" +  KBEngine.app.serverErr(failedcode);\r\n        this.btn_start.active = true;\r\n        KBEngine.INFO_MSG(logStr);\t\r\n     },\r\n\r\n     onReloginBaseappFailed: function(failedcode){\r\n        this.btn_start.active = true;\r\n        KBEngine.INFO_MSG(\"reogin is failed(断线重连失败), err=\" + KBEngine.app.serverErr(failedcode))\r\n     },\r\n\r\n     onReloginBaseappSuccessfully : function() {\r\n        KBEngine.INFO_MSG(\"reogin is successfully!(断线重连成功!)\")\r\n    },\r\n\r\n     onLoginBaseappFailed : function(failedcode) {\r\n        this.btn_start.active = true;\r\n        KBEngine.INFO_MSG(\"LoginBaseapp is failed(登陆网关失败), err=\" + KBEngine.app.serverErr(failedcode));\r\n     },\r\n\r\n     decodeEncryptedData:function() {\r\n        var encryptedData = cc.sys.localStorage.getItem(\"encryptedData\");\r\n        var sessionKey = cc.sys.localStorage.getItem(\"sessionKey\");\r\n        var iv = cc.sys.localStorage.getItem(\"iv\");\r\n        KBEngine.INFO_MSG(\"decodeEncryptedData: encryptedData=\" + encryptedData + \" ,iv=\" + iv + \" ,sessionKey=\" + sessionKey);\r\n        if(sessionKey && encryptedData && iv) {\r\n            //var pc = new WxBizDataCrypt(APPID, sessionKey);\r\n            var pc = new WxBizDataCrypt(\"wxbe1644556ed8afa6\", \"96c0e22af25571db5f175ebbb550e672\");\r\n            var data = pc.descrytData(encryptedData , iv);\r\n            console.log('解密后 data: ', data)\r\n        }\r\n     },\r\n     onSetSpaceData:function(){\r\n         cc.log(\"startscene.onSetSpaceData\")\r\n     },  \r\n     enterScene : function() {\r\n        KBEngine.INFO_MSG(\"Login is successfully!(登陆成功!)\");\r\n        this.label_hint.string = \"登陆成功 !!!\";\r\n        if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n            var player = KBEngine.app.player();\r\n            var encryptedData = cc.sys.localStorage.getItem(\"encryptedData\");\r\n            var iv = cc.sys.localStorage.getItem(\"iv\");\r\n            cc.log(\"encryptedData && iv\",encryptedData , iv)\r\n            this.label_hint.string = \"base.decodeEncryptedData()=\" + encryptedData + \"/\" + iv;\r\n            player.decodeEncryptedData();\r\n        } \r\n        //var player = KBEngine.app.player();//KBEngine.app.entities[KBEngine.app.entity_id];    \r\n        //player.joinRoom()\r\n\r\n        cc.director.loadScene(\"WorldScene\", ()=> {\r\n            KBEngine.INFO_MSG(\"load world scene finished\");\r\n            var player = KBEngine.app.player();//KBEngine.app.entities[KBEngine.app.entity_id];\r\n            //window.type=1\r\n            if(player){\r\n                if (window.type==1){\r\n                    player.joinRoom();\r\n                }\r\n                if (window.type==2){\r\n                    player.createPrivateRoom();\r\n                    \r\n                }\r\n                if (window.type==3 && window.roomIID.length>0){\r\n                    player.joinPrivateRoom(window.roomIID);\r\n                    window.roomIID=[]                    \r\n                }                \r\n            }\r\n            this.unInstallEvents();           \r\n        });\r\n     },\r\n \r\n     onLoginBaseapp : function() {\r\n        cc.log(\"Connect to loginBaseapp, please wait...(连接到网关， 请稍后...)\");\r\n     },\r\n \r\n     Loginapp_importClientMessages : function() {\r\n        this.label_hint.string = \"登陆中 ... ...\";\r\n        cc.log(\"Loginapp_importClientMessages ...\");\r\n     },\r\n \r\n     Baseapp_importClientMessages : function() {\r\n         cc.log(\"Baseapp_importClientMessages ..\");\r\n     },\r\n         \r\n     Baseapp_importClientEntityDef: function() {\r\n         cc.log(\"Baseapp_importClientEntityDef ..\")\r\n     },\r\n\r\n     createDictString: function(dic) {\r\n        var dictString = \"\";\r\n        var len = 0;\r\n        for(var pro in dic) len++;\r\n\r\n        if(len > 0) {\r\n            var index = 0;\r\n            var dictString = \"{\"\r\n            for(var prop in dic) {\r\n                dictString += \"'\" + prop + \"'\" ;\r\n                dictString += \":\";\r\n                dictString += \"'\" + dic[prop] + \"'\";\r\n                if(index == len-1) {\r\n                    dictString += \"}\";\r\n                }else {\r\n                    dictString += \",\";\r\n                }\r\n                index++;\r\n            }\r\n        }\r\n\r\n        return dictString;\r\n     },\r\n \r\n     startGame: function (event) {\r\n        window.loginres=100;\r\n        window.AudioMgr.playSFX(\"ui_click\")\r\n         //cc.log(\"cc.sys.platform\",cc.sys.platform,cc.sys.WECHAT_GAME)\r\n         window.type=1\r\n         if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n             this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n         }\r\n         if(this.userName.length == 0)\r\n         {\r\n             this.label_hint.string = \"用户名不能为空\";\r\n             return;\r\n         }\r\n         cc.log(\"this.userName=\", this.userName)  \r\n         var datas = {};\r\n         datas[\"platform\"] = cc.sys.platform;\r\n         datas = this.createDictString(datas);\r\n         KBEngine.INFO_MSG(\"login name=\" + this.userName);\r\n         KBEngine.Event.fire(\"login\", this.userName, \"123456\", datas);  \r\n         this.label_hint.string = \"登陆中 ... ...\";\r\n         this.btn_start.active = false;\r\n \r\n      },\r\n      createPrivateRoom: function (event) {\r\n          window.loginres=100; \r\n          window.type=2\r\n          window.AudioMgr.playSFX(\"ui_click\")\r\n          //cc.log(\"cc.sys.platform\",cc.sys.platform,cc.sys.WECHAT_GAME)\r\n          if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n              this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n          }\r\n          if(this.userName.length == 0)\r\n          {\r\n              this.label_hint.string = \"用户名不能为空\";\r\n              return;\r\n          }\r\n          cc.log(\"this.userName=\",this.userName)  \r\n          var datas = {};\r\n          datas[\"platform\"] = cc.sys.platform;\r\n          datas = this.createDictString(datas);\r\n          KBEngine.INFO_MSG(\"login name=\" + this.userName);\r\n          //var temp1=UnicodeToUtf8(this.userName)\r\n          //this.userName =java.net.URLDecoder.decode(temp,\"UTF-8\"); \r\n          //this.userName =Utf8ToUnicode(temp1)\r\n          //cc.log(\"this.userName=\",this.userName)  \r\n          KBEngine.Event.fire(\"login\", this.userName, \"123456\", datas);  \r\n          this.label_hint.string = \"登陆中 ... ...\";\r\n          this.btn_start.active = false;\r\n       },\r\n       joinPrivateRoominputcallback:function(roomId){ //参数是数组\r\n         window.type=3\r\n         window.loginres=100;\r\n         window.roomIID=roomId\r\n         if(this.JoinGame)\r\n            this.JoinGame.active=false\r\n           //////////////////////////////////////////////////\r\n          cc.log(\"this.userName=\",this.userName,roomId)  \r\n          var datas = {};\r\n          datas[\"platform\"] = cc.sys.platform;\r\n          datas = this.createDictString(datas);\r\n          KBEngine.INFO_MSG(\"login name=\" + this.userName);\r\n \r\n          KBEngine.Event.fire(\"login\", this.userName, \"123456\", datas);  \r\n          this.label_hint.string = \"登陆中 ... ...\";\r\n          this.btn_start.active = false;\r\n \r\n       },\r\n       joinPrivateRoom: function (event) {\r\n         \r\n         window.AudioMgr.playSFX(\"ui_click\")\r\n          //cc.log(\"cc.sys.platform\",cc.sys.platform,cc.sys.WECHAT_GAME)\r\n \r\n          \r\n          if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n              this.userName=cc.sys.localStorage.getItem(\"userName\");\r\n          }\r\n          if(this.userName.length == 0)\r\n          {\r\n              this.label_hint.string = \"用户名不能为空\";\r\n              return;\r\n          }\r\n          this.JoinGame.active=true\r\n          ///////////////////////////////////////////////////\r\n  \r\n  \r\n          \r\n       },\r\n\r\n\r\n\r\n});\r\n"]}