{"version":3,"sources":["assets\\scripts\\kbengine.js"],"names":["KBEngine","Class","extend","props","_super","prototype","fnTest","test","xyz","proto","Object","create","name","fn","tmp","ret","apply","arguments","newClass","ctor","hasOwnProperty","SubClass","EmptyClass","constructor","ArrayBuffer","transfer","source","length","dest","TypeError","byteLength","buf","Uint8Array","set","RangeError","window","PACKET_MAX_SIZE","PACKET_MAX_SIZE_TCP","PACKET_MAX_SIZE_UDP","MESSAGE_ID_LENGTH","MESSAGE_LENGTH_LENGTH","MESSAGE_LENGTH1_LENGTH","MESSAGE_MAX_SIZE","CLIENT_NO_FLOAT","KBE_FLT_MAX","INT64","lo","hi","sign","toString","result","low","high","i","UINT64","INFO_MSG","s","console","info","DEBUG_MSG","debug","ERROR_MSG","error","WARNING_MSG","warn","utf8ArrayToString","array","out","len","c","char2","char3","String","fromCharCode","stringToUTF8Bytes","str","utf8","charcode","charCodeAt","push","EventInfo","classinst","callbackfn","FiredEvent","evtName","evtInfo","ars","Event","_events","_isPause","_firedEvents","register","strCallback","undefined","evtlst","deregisterAll","itemkey","deregister","found","splice","removeFiredEvent","removeAllFiredEvent","firedEvents","evt","fire","eobj","pause","resume","shift","MemoryStream","size_or_buffer","buffer","rpos","wpos","PackFloatXType","_unionData","fv","Float32Array","uv","Uint32Array","iv","Int32Array","readInt8","Int8Array","readInt16","v","readUint16","readInt32","readUint32","readInt64","readUint8","readUint64","readFloat","e","slice","readDouble","Float64Array","readString","Error","readBlob","size","readStream","readPackXZ","xPackData","zPackData","v1","v2","v3","data","Array","readPackY","writeInt8","writeInt16","writeInt32","writeInt64","writeUint8","writeUint16","writeUint32","writeUint64","writeFloat","buf1","buf2","writeDouble","writeBlob","space","writeString","idx","append","stream","offset","readSkip","readEOF","done","getbuffer","clear","Bundle","memorystreams","numMessage","messageLengthBuffer","messageLength","msgtype","newMessage","fini","id","writeMsgLength","issend","send","network","tmpStream","checkStream","reader","datatype2id","mappingDataType","writer","argType","bindwriter","writeStream","bindReader","Message","argstype","args","handler","argsType","createFromStream","msgstream","call","handleMessage","app","messages","clientmessages","bufferedCreateEntityMessages","Vector2","x","y","distance","pos","Math","sqrt","add","vec3","sub","mul","num","div","neg","Vector3","z","Vector4","w","vec4","clampf","value","min_inclusive","max_inclusive","temp","int82angle","angle","half","PI","angle2int8","floor","float","floorf","Entity","className","position","direction","velocity","cell","base","inWorld","inited","isControlled","entityLastLocalPos","entityLastLocalDir","isOnGround","holds","roomKeyc","__init__","callPropertysSetMethods","currModule","moduledefs","propertys","propertydata","properUtype","setmethod","flags","oldval","isPlayer","onDestroy","onControlled","bIsControlled","entity_id","baseCall","method","base_methods","methodID","newCall","bundle","isSameType","addToStream","sendCall","cellCall","cell_methods","enterWorld","onEnterWorld","cc","log","EventTypes","leaveWorld","onLeaveWorld","enterSpace","onEnterSpace","set_position","set_direction","leaveSpace","onLeaveSpace","set_roomKeyc","old","join","set_holds","entityServerPos","onUpdateVolatileData","ENTITYCALL_TYPE_CELL","ENTITYCALL_TYPE_BASE","EntityCall","type","networkInterface","isBase","isCell","Baseapp_onRemoteCallCellMethodFromClient","Entity_onRemoteMethodCall","datatypes","DATATYPE_UINT8","bind","parseDefaultValStr","parseInt","DATATYPE_UINT16","DATATYPE_UINT32","DATATYPE_UINT64","DATATYPE_INT8","DATATYPE_INT16","DATATYPE_INT32","DATATYPE_INT64","DATATYPE_FLOAT","parseFloat","DATATYPE_DOUBLE","DATATYPE_STRING","DATATYPE_VECTOR2","DATATYPE_VECTOR3","DATATYPE_VECTOR4","DATATYPE_PYTHON","DATATYPE_UNICODE","DATATYPE_ENTITYCALL","cid","utype","DATATYPE_BLOB","DATATYPE_ARRAY","datas","DATATYPE_FIXED_DICT","dicttype","implementedBy","KBEngineArgs","ip","port","updateHZ","serverHeartbeatTick","clientType","isOnInitCallPropertysSetMethods","isWss","createAccount","login","logout","reloginBaseapp","bindAccountEmail","newPassword","onKicked","onDisconnected","onConnectionState","onConnectionState2","onCreateAccountResult","onVersionNotMatch","onScriptVersionNotMatch","onLoginFailed","onLoginBaseapp","onLoginBaseappFailed","onReloginBaseapp","onReloginBaseappSuccessfully","onReloginBaseappFailed","updatePosition","addSpaceGeometryMapping","onSetSpaceData","onDelSpaceData","onLoseControlledEntity","onStreamDataStarted","onStreamDataRecv","onStreamDataCompleted","KBEngineApp","kbengineArgs","assert","username","password","clientdatas","encryptedKey","loginappMessageImported","baseappMessageImported","serverErrorsDescrImported","entitydefImported","getSingleton","ServerErr","descr","serverErrs","protocol","baseappIP","baseappPort","currMsgID","currMsgCount","currMsgLen","FragmentDataTypes","FRAGMENT_DATA_UNKNOW","FRAGMENT_DATA_MESSAGE_ID","FRAGMENT_DATA_MESSAGE_LENGTH","FRAGMENT_DATA_MESSAGE_LENGTH1","FRAGMENT_DATA_MESSAGE_BODY","fragmentStream","fragmentDatasFlag","fragmentDatasRemain","resetSocket","socket","sock","onopen","onerror","onmessage","onclose","close","reset","entities","clearEntities","currserver","currstate","currconnect","serverdatas","serverVersion","serverScriptVersion","serverProtocolMD5","serverEntityDefMD5","clientVersion","clientScriptVersion","entity_uuid","entity_type","useAliasEntityID","entityIDAliasIDList","controlledEntities","spacedata","spaceID","spaceResPath","isLoadedGeometry","dateObject","Date","lastTickTime","getTime","lastTickCBTime","component","installEvents","uninstallEvents","hello","Loginapp_hello","Baseapp_hello","player","findEntity","entityID","connect","addr","WebSocket","binaryType","onerror_before_onopen","disconnect","onerror_after_onopen","msg","writeFragmentMessage","msgHandler","msglen","mergeFragmentMessage","FragmentDataType","datasize","opsize","update","Loginapp_onClientActiveTick","Baseapp_onClientActiveTick","updatePlayerToServer","Client_onAppActiveTickCB","serverErr","Client_onImportServerErrorsDescr","onOpenLoginapp_login","Loginapp_importClientMessages","Client_onImportClientMessages","onImportClientMessagesCompleted","onOpenLoginapp_createAccount","Loginapp_importServerErrorsDescr","login_loginapp","resetpassword_loginapp","createAccount_loginapp","Baseapp_importClientEntityDef","onImportEntityDefCompleted","createDataTypeFromStreams","canprint","aliassize","createDataTypeFromStream","datatype","valname","keysize","keyname","keyutype","uitemtype","Client_onImportClientEntityDef","scriptmodule_name","scriptUtype","propertysize","methodsize","base_methodsize","cell_methodsize","currModuleDefs","self_propertys","self_methods","self_base_methods","self_cell_methods","properFlags","aliasID","defaultValStr","savedata","methodUtype","argssize","defmethod","infos","methods","Client_onVersionNotMatch","Client_onScriptVersionNotMatch","login_baseapp","importClientMessages","msgid","msgname","argtype","argsize","argstypes","isClientMethod","indexOf","onImportClientMessages","getServerAddr","serverAddr","noconnect","Loginapp_reqCreateAccount","emailAddress","Baseapp_reqAccountBindEmail","old_password","new_password","Baseapp_reqAccountNewPassword","Baseapp_logoutBaseapp","Loginapp_login","onOpenLoginapp_resetpassword","reset_password","Loginapp_reqAccountResetPassword","onOpenBaseapp","Baseapp_importClientMessages","baseappIp","Baseapp_loginBaseapp","onReOpenBaseapp","Baseapp_reloginBaseapp","Client_onHelloCB","ctype","Client_onLoginFailed","failedcode","Client_onLoginSuccessfully","accountName","Client_onLoginBaseappFailed","Client_onReloginBaseappFailed","Client_onReloginBaseappSuccessfully","entityclass","getentityclass","entityType","runclass","Client_onCreatedProxies","rndUUID","eid","entity","entityMessage","Client_onUpdatePropertys","getViewEntityIDFromStream","Length","onUpdatePropertys_","stream1","pdatas","usePropertyDescrAlias","val","Client_onUpdatePropertysOptimized","onRemoteMethodCall_","useMethodDescrAlias","methoddata","argsdata","Client_onRemoteMethodCallOptimized","Client_onRemoteMethodCall","Client_onEntityEnterWorld","Client_onEntityLeaveWorldOptimized","Client_onEntityLeaveWorld","newArray0","newArray","clearSpace","Client_onEntityDestroyed","Client_onEntityEnterSpace","Client_onEntityLeaveSpace","Client_onKicked","Client_onCreateAccountResult","retcode","Client_onControlEntity","isCont","Baseapp_onUpdateDataFromClient","posHasChanged","dirHasChanged","Baseapp_onUpdateDataFromClientForControlledEntity","respath","isAll","Client_initSpaceData","key","Client_setSpaceData","Client_delSpaceData","Client_getSpaceData","Client_onUpdateBasePos","Client_onUpdateBasePosXZ","Client_onUpdateData","Client_onSetEntityPosAndDir","Client_onUpdateData_ypr","p","r","_updateVolatileData","Client_onUpdateData_yp","Client_onUpdateData_yr","Client_onUpdateData_pr","Client_onUpdateData_y","Client_onUpdateData_p","Client_onUpdateData_r","Client_onUpdateData_xz","xz","Client_onUpdateData_xz_ypr","Client_onUpdateData_xz_yp","Client_onUpdateData_xz_yr","Client_onUpdateData_xz_pr","Client_onUpdateData_xz_y","Client_onUpdateData_xz_p","Client_onUpdateData_xz_r","Client_onUpdateData_xyz","Client_onUpdateData_xyz_ypr","yaw","Client_onUpdateData_xyz_yp","Client_onUpdateData_xyz_yr","Client_onUpdateData_xyz_pr","Client_onUpdateData_xyz_y","Client_onUpdateData_xyz_p","Client_onUpdateData_xyz_r","pitch","roll","changeDirection","positionChanged","Client_onStreamDataStarted","Client_onStreamDataRecv","Client_onStreamDataCompleted","Client_onReqAccountResetPasswordCB","Client_onReqAccountBindEmailCB","Client_onReqAccountNewPasswordCB","bRet","idInterval","setInterval","destroy","clearInterval","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var KBEngine = KBEngine || {};\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t    \tJavaScript Inheritance\r\n-----------------------------------------------------------------------------------------*/\r\n/* Simple JavaScript Inheritance for ES 5.1\r\n * based on http://ejohn.org/blog/simple-javascript-inheritance/\r\n *  (inspired by base2 and Prototype)\r\n * MIT Licensed.\r\n */\r\n\r\n// The base Class implementation (does nothing)\r\nKBEngine.Class = function(){};\r\n// Create a new Class that inherits from this class\r\nKBEngine.Class.extend = function(props) {\r\n\tvar _super = this.prototype;\r\n    var fnTest = /xyz/.test(function(){xyz;}) ? /\\b_super\\b/ : /.*/;\r\n\t// Set up the prototype to inherit from the base class\r\n\t// (but without running the ctor constructor)\r\n\tvar proto = Object.create(_super);\r\n\r\n\t// Copy the properties over onto the new prototype\r\n\tfor (var name in props) {\r\n\t\t// Check if we're overwriting an existing function\r\n\t\tproto[name] = typeof props[name] === \"function\" &&\r\n\t\ttypeof _super[name] == \"function\" && fnTest.test(props[name])\r\n\t\t\t? (function(name, fn){\r\n\t\t\t\treturn function() {\r\n\t\t\t\t\tvar tmp = this._super;\r\n\r\n\t\t\t\t\t// Add a new ._super() method that is the same method\r\n\t\t\t\t\t// but on the super-class\r\n\t\t\t\t\tthis._super = _super[name];\r\n\r\n\t\t\t\t\t// The method only need to be bound temporarily, so we\r\n\t\t\t\t\t// remove it when we're done executing\r\n\t\t\t\t\tvar ret = fn.apply(this, arguments);\r\n\t\t\t\t\tthis._super = tmp;\r\n\r\n\t\t\t\t\treturn ret;\r\n\t\t\t\t};\r\n\t\t\t})(name, props[name])\r\n\t\t\t: props[name];\r\n\t}\r\n\r\n\t// The new constructor\r\n\tvar newClass = typeof proto.ctor === \"function\"\r\n\t\t? proto.hasOwnProperty(\"ctor\")\r\n\t\t\t? proto.ctor // All construction is actually done in the ctor method\r\n\t\t\t: function SubClass(){ _super.ctor.apply(this, arguments); }\r\n\t\t: function EmptyClass(){};\r\n\r\n\t// Populate our constructed prototype object\r\n\tnewClass.prototype = proto;\r\n\r\n\t// Enforce the constructor to be what we expect\r\n\tproto.constructor = newClass;\r\n\r\n\t// And make this class extendable\r\n\tnewClass.extend = KBEngine.Class.extend;\r\n\r\n\treturn newClass;\r\n};\r\n\r\n/*\r\n\t如果ArrayBuffer没有transfer()的方法, 则为ArrayBuffer添加transfer()方法\r\n\t该方法回一个新的ArrayBuffer， 其内容取自oldBuffer的数据，并且根据 newByteLength 的大小来对数据进行截取\r\n\t参考:https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer/transfer\r\n */\r\nif(!ArrayBuffer.transfer) {\r\n    ArrayBuffer.transfer = function (source, length) {\r\n        source = Object(source);\r\n\t\tvar dest = new ArrayBuffer(length);\r\n\t\t\r\n        if(!(source instanceof ArrayBuffer) || !(dest instanceof ArrayBuffer)) {\r\n            throw new TypeError(\"ArrayBuffer.transfer, error: Source and destination must be ArrayBuffer instances\");\r\n\t\t}\r\n\t\t\r\n        if(dest.byteLength >= source.byteLength) {\r\n\t\t\tvar buf = new Uint8Array(dest);\r\n\t\t\tbuf.set(new Uint8Array(source), 0);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new RangeError(\"ArrayBuffer.transfer, error: destination has not enough space\");\r\n\t\t}\r\n\t\t\r\n\t\treturn dest;\r\n    };\r\n};\r\n\r\n// export\r\nwindow.Class = KBEngine.Class;\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tglobal\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.PACKET_MAX_SIZE\t\t = 1500;\r\nKBEngine.PACKET_MAX_SIZE_TCP\t = 1460;\r\nKBEngine.PACKET_MAX_SIZE_UDP\t = 1472;\r\n\r\nKBEngine.MESSAGE_ID_LENGTH\t\t = 2;\r\nKBEngine.MESSAGE_LENGTH_LENGTH\t = 2;\r\nKBEngine.MESSAGE_LENGTH1_LENGTH  = 4;\r\nKBEngine.MESSAGE_MAX_SIZE\t\t = 65535;\r\n\r\nKBEngine.CLIENT_NO_FLOAT\t\t = 0;\r\nKBEngine.KBE_FLT_MAX\t\t\t = 3.402823466e+38;\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tnumber64bits\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.INT64 = function(lo, hi)\r\n{\r\n\tthis.lo = lo;\r\n\tthis.hi = hi;\r\n\t\r\n\tthis.sign = 1;\r\n\t\r\n\tif(hi >= 2147483648)\r\n\t{\r\n\t\tthis.sign = -1;\r\n\t\tif(this.lo > 0)\r\n\t\t{\r\n\t\t\tthis.lo = (4294967296 - this.lo) & 0xffffffff;\r\n\t\t\tthis.hi = 4294967295 - this.hi;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.lo = (4294967296 - this.lo) & 0xffffffff;\r\n\t\t\tthis.hi = 4294967296 - this.hi;\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.toString = function()\r\n\t{\r\n\t\tvar result = \"\";\r\n\t\t\r\n\t\tif(this.sign < 0)\r\n\t\t{\r\n\t\t\tresult += \"-\"\r\n\t\t}\r\n\t\t\r\n\t\tvar low = this.lo.toString(16);\r\n\t\tvar high = this.hi.toString(16);\r\n\t\t\r\n\t\tif(this.hi > 0)\r\n\t\t{\r\n\t\t\tresult += high;\r\n\t\t\tfor(var i = 8 - low.length; i > 0; --i)\r\n\t\t\t{\r\n\t\t\t\tresult += \"0\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tresult += low;\r\n\t\t\r\n\t\treturn result;\r\n\t\t\r\n\t}\r\n}\r\n\r\nKBEngine.UINT64 = function(lo, hi)\r\n{\r\n\tthis.lo = lo;\r\n\tthis.hi = hi;\r\n\t\r\n\tthis.toString = function()\r\n\t{\r\n\t\tvar low = this.lo.toString(16);\r\n\t\tvar high = this.hi.toString(16);\r\n\t\t\r\n\t\tvar result = \"\";\r\n\t\tif(this.hi > 0)\r\n\t\t{\r\n\t\t\tresult += high;\r\n\t\t\tfor(var i = 8 - low.length; i > 0; --i)\r\n\t\t\t{\r\n\t\t\t\tresult += \"0\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tresult += low;\r\n\t\treturn result;\r\n\t}\r\n}\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tdebug\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.INFO_MSG = function(s)\r\n{\r\n\tconsole.info(s);\r\n}\r\n\r\nKBEngine.DEBUG_MSG = function(s)\r\n{\r\n\tconsole.debug(s);\r\n}\r\n\r\nKBEngine.ERROR_MSG = function(s)\r\n{\r\n\tconsole.error(s);\r\n}\r\n\r\nKBEngine.WARNING_MSG = function(s)\r\n{\r\n\tconsole.warn(s);\r\n}\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tstring\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.utf8ArrayToString = function(array)\r\n{\r\n    var out, i, len, c;\r\n    var char2, char3;\r\n\r\n    out = \"\";\r\n    len = array.length;\r\n    i = 0;\r\n\r\n    while(i < len)\r\n    {\r\n        c = array[i++];\r\n\r\n        switch(c >> 4)\r\n        {\r\n            case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7:\r\n            // 0xxxxxxx\r\n            out += String.fromCharCode(c);\r\n            break;\r\n            case 12: case 13:\r\n            // 110x xxxx   10xx xxxx\r\n            char2 = array[i++];\r\n            out += String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F));\r\n            break;\r\n            case 14:\r\n                // 1110 xxxx  10xx xxxx  10xx xxxx\r\n                char2 = array[i++];\r\n                char3 = array[i++];\r\n                out += String.fromCharCode(((c & 0x0F) << 12) |\r\n                    ((char2 & 0x3F) << 6) |\r\n                    ((char3 & 0x3F) << 0));\r\n                break;\r\n        }\r\n    }\r\n    \r\n    return out;\r\n}\r\n\r\nKBEngine.stringToUTF8Bytes = function(str) \r\n{\r\n    var utf8 = [];\r\n    for (var i=0; i < str.length; i++) {\r\n        var charcode = str.charCodeAt(i);\r\n        if (charcode < 0x80) utf8.push(charcode);\r\n        else if (charcode < 0x800) {\r\n            utf8.push(0xc0 | (charcode >> 6), \r\n                      0x80 | (charcode & 0x3f));\r\n        }\r\n        else if (charcode < 0xd800 || charcode >= 0xe000) {\r\n            utf8.push(0xe0 | (charcode >> 12), \r\n                      0x80 | ((charcode>>6) & 0x3f), \r\n                      0x80 | (charcode & 0x3f));\r\n        }\r\n        // surrogate pair\r\n        else {\r\n            i++;\r\n            // UTF-16 encodes 0x10000-0x10FFFF by\r\n            // subtracting 0x10000 and splitting the\r\n            // 20 bits of 0x0-0xFFFFF into two halves\r\n            charcode = 0x10000 + (((charcode & 0x3ff)<<10)\r\n                      | (str.charCodeAt(i) & 0x3ff))\r\n            utf8.push(0xf0 | (charcode >>18), \r\n                      0x80 | ((charcode>>12) & 0x3f), \r\n                      0x80 | ((charcode>>6) & 0x3f), \r\n                      0x80 | (charcode & 0x3f));\r\n        }\r\n    }\r\n    return utf8;\r\n}\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tevent\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.EventInfo = function(classinst, callbackfn)\r\n{\r\n\tthis.callbackfn = callbackfn;\r\n\tthis.classinst = classinst;\r\n}\r\n\r\nKBEngine.FiredEvent = function(evtName, evtInfo, ars)\r\n{\r\n\tthis.evtName = evtName;\r\n\tthis.evtInfo = evtInfo;\r\n\tthis.ars = ars;\r\n}\r\n\r\nKBEngine.Event = function()\r\n{\r\n\tthis._events = {};\r\n\tthis._isPause = false;\r\n\tthis._firedEvents = [];\r\n\t\r\n\tthis.register = function(evtName, classinst, strCallback)\r\n\t{\r\n\t\tvar callbackfn = classinst[strCallback];\r\n\t\tif(callbackfn == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG('KBEngine.Event::fire: not found strCallback(' + classinst  + \")!\"+strCallback);  \r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar evtlst = this._events[evtName];\r\n\t\tif(evtlst == undefined)\r\n\t\t{\r\n\t\t\tevtlst = [];\r\n\t\t\tthis._events[evtName] = evtlst;\r\n\t\t}\r\n\t\t\r\n\t\tvar info = new KBEngine.EventInfo(classinst, callbackfn);\r\n\t\tevtlst.push(info);\r\n\t}\r\n\r\n\tthis.deregisterAll = function(classinst)\r\n\t{\r\n\t\tfor(var itemkey in this._events)\r\n\t\t{\r\n\t\t\tthis.deregister(itemkey, classinst);\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.deregister = function(evtName, classinst)\r\n\t{\r\n\t\tvar evtlst = this._events[evtName];\r\n\r\n\t\tif(evtlst == undefined)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twhile(true)\r\n\t\t{\r\n\t\t\tvar found = false;\r\n\t\t\tfor(var i=0; i<evtlst.length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar info = evtlst[i];\r\n\t\t\t\tif(info.classinst == classinst)\r\n\t\t\t\t{\r\n\t\t\t\t\tevtlst.splice(i, 1);\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(!found)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.removeFiredEvent(evtName, classinst);\r\n\t}\r\n\r\n\tthis.removeAllFiredEvent = function(classinst)\r\n\t{\r\n\t\tthis.removeFiredEvent(\"\", classinst);\r\n\t}\r\n\r\n\tthis.removeFiredEvent = function(evtName, classinst)\r\n\t{\r\n\t\tvar firedEvents = this._firedEvents;\r\n\t\twhile(true)\r\n\t\t{\r\n\t\t\tvar found = false;\r\n\t\t\tfor(var i=0; i<firedEvents.length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar evt = firedEvents[i];\r\n\t\t\t\tif((evtName == \"\" || evt.evtName == evtName) && evt.evtInfo.classinst == classinst)\r\n\t\t\t\t{\r\n\t\t\t\t\tfiredEvents.splice(i, 1);\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!found)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.fire = function()\r\n\t{\r\n\t\tif(arguments.length < 1)\r\n\t\t{\r\n\t\t\t//KBEngine.ERROR_MSG('KBEngine.Event::fire: not found eventName!');  \r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar evtName = arguments[0];\r\n\t\tvar evtlst = this._events[evtName];\r\n\t\t\r\n\t\tif(evtlst == undefined)\r\n\t\t{\r\n\t\t\treturn;\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tvar ars = [];\r\n\t\tfor(var i=1; i<arguments.length; i++) \r\n\t\t\tars.push(arguments[i]);\r\n\t\t\r\n\t\tfor(var i=0; i<evtlst.length; i++)\r\n\t\t{\r\n\t\t\tvar info = evtlst[i];\r\n\r\n\t\t\tif(!this._isPause)\r\n\t\t\t{\r\n\t\t\t\tif(ars.length < 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tinfo.callbackfn.apply(info.classinst);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tinfo.callbackfn.apply(info.classinst, ars);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tvar eobj = new KBEngine.FiredEvent(evtName, info, ars);\r\n\t\t\t\tthis._firedEvents.push(eobj);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis.pause = function() \r\n\t{\r\n\t\tthis._isPause = true;\r\n\t}\r\n\r\n\tthis.resume = function()\r\n\t{\r\n\t\tthis._isPause = false;\r\n\r\n\t\tvar firedEvents = this._firedEvents;\r\n\t\twhile(firedEvents.length > 0)\r\n\t\t{\r\n\t\t\tvar evt = firedEvents.shift();\r\n\t\t\tvar info = evt.evtInfo;\r\n\t\t\tvar ars = evt.ars;\r\n\r\n\t\t\tif(ars.length < 1)\r\n\t\t\t{\r\n\t\t\t\tinfo.callbackfn.apply(info.classinst);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tinfo.callbackfn.apply(info.classinst, ars);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nKBEngine.Event = new KBEngine.Event();\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tmemorystream\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.MemoryStream = function(size_or_buffer)\r\n{\r\n\tif(size_or_buffer instanceof ArrayBuffer)\r\n\t{\r\n\t\tthis.buffer = size_or_buffer;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(size_or_buffer);\r\n\t}\r\n\r\n\tthis.rpos = 0;\r\n\tthis.wpos = 0;\r\n\t\r\n\t/*\r\n\t\tunion PackFloatXType\r\n\t\t{\r\n\t\t\tfloat\tfv;\r\n\t\t\tuint32\tuv;\r\n\t\t\tint\t\tiv;\r\n\t\t};\t\r\n\t*/\r\n\tKBEngine.MemoryStream.PackFloatXType = function()\r\n\t{\r\n\t\tthis._unionData = new ArrayBuffer(4);\r\n\t\tthis.fv = new Float32Array(this._unionData, 0, 1);\r\n\t\tthis.uv = new Uint32Array(this._unionData, 0, 1);\r\n\t\tthis.iv = new Int32Array(this._unionData, 0, 1);\r\n\t};\r\n\t\t\t\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.readInt8 = function()\r\n\t{\r\n\t\tvar buf = new Int8Array(this.buffer, this.rpos, 1);\r\n\t\tthis.rpos += 1;\r\n\t\treturn buf[0];\r\n\t}\r\n\r\n\tthis.readInt16 = function()\r\n\t{\r\n\t\tvar v = this.readUint16();\r\n\t\tif(v >= 32768)\r\n\t\t\tv -= 65536;\r\n\t\treturn v;\r\n\t}\r\n\t\t\r\n\tthis.readInt32 = function()\r\n\t{\r\n\t\tvar v = this.readUint32();\r\n\t\tif(v >= 2147483648)\r\n\t\t\tv -= 4294967296;\r\n\t\treturn v;\r\n\t}\r\n\r\n\tthis.readInt64 = function()\r\n\t{\r\n\t\tvar lo = this.readInt32();\r\n\t\tvar hi = this.readInt32();\r\n\t\treturn new KBEngine.INT64(lo, hi);\r\n\t}\r\n\t\r\n\tthis.readUint8 = function()\r\n\t{\r\n\t\tvar buf = new Uint8Array(this.buffer, this.rpos, 1);\r\n\t\tthis.rpos += 1;\r\n\t\treturn buf[0];\r\n\t}\r\n\r\n\tthis.readUint16 = function()\r\n\t{\r\n\t\tvar buf = new Uint8Array(this.buffer, this.rpos);\r\n\t\tthis.rpos += 2;\r\n\t\treturn ((buf[1] & 0xff) << 8) + (buf[0] & 0xff);\r\n\t}\r\n\t\t\r\n\tthis.readUint32 = function()\r\n\t{\r\n\t\tvar buf = new Uint8Array(this.buffer, this.rpos);\r\n\t\tthis.rpos += 4;\r\n\t\treturn (buf[3] << 24) + (buf[2] << 16) + (buf[1] << 8) + buf[0];\r\n\t}\r\n\r\n\tthis.readUint64 = function()\r\n\t{\r\n\t\tvar lo = this.readUint32();\r\n\t\tvar hi = this.readUint32();\r\n\t\treturn new KBEngine.UINT64(lo, hi);\r\n\t}\r\n\t\r\n\tthis.readFloat = function()\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tvar buf = new Float32Array(this.buffer, this.rpos, 1);\r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{\r\n\t\t\tvar buf = new Float32Array(this.buffer.slice(this.rpos, this.rpos + 4));\r\n\t\t}\r\n\t\t\r\n\t\tthis.rpos += 4;\r\n\t\treturn buf[0];\r\n\t}\r\n\r\n\tthis.readDouble = function()\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tvar buf = new Float64Array(this.buffer, this.rpos, 1);\r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{\r\n\t\t\tvar buf = new Float64Array(this.buffer.slice(this.rpos, this.rpos + 8), 0, 1);\r\n\t\t}\r\n\t\t\r\n\t\tthis.rpos += 8;\r\n\t\treturn buf[0];\r\n\t}\r\n\t\r\n\tthis.readString = function()\r\n\t{\r\n\t\tvar buf = new Uint8Array(this.buffer, this.rpos);\r\n\t\tvar i = 0;\r\n\t\tvar s = \"\";\r\n\t\t\r\n\t\twhile(true)\r\n\t\t{\r\n\t\t\tif(buf[i] != 0)\r\n\t\t\t{\r\n\t\t\t\ts += String.fromCharCode(buf[i]);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\ti++;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ti++;\r\n\t\t\t\r\n\t\t\tif(this.rpos + i >= this.buffer.byteLength)\r\n\t\t\t\tthrow(new Error(\"KBEngine.MemoryStream::readString: rpos(\" + (this.rpos + i) + \")>=\" + \r\n\t\t\t\t\tthis.buffer.byteLength + \" overflow!\"));\r\n\t\t}\r\n\t\t\r\n\t\tthis.rpos += i;\r\n\t\treturn s;\r\n\t}\r\n\r\n\tthis.readBlob = function()\r\n\t{\r\n\t\tvar size = this.readUint32();\r\n\t\tvar buf = new Uint8Array(this.buffer, this.rpos, size);\r\n\t\tthis.rpos += size;\r\n\t\treturn buf;\r\n\t}\r\n\r\n\tthis.readStream = function()\r\n\t{\r\n\t\tvar buf = new Uint8Array(this.buffer, this.rpos, this.buffer.byteLength - this.rpos);\r\n\t\tthis.rpos = this.buffer.byteLength;\r\n\t\treturn new KBEngine.MemoryStream(buf);\r\n\t}\r\n\t\r\n\tthis.readPackXZ = function()\r\n\t{\r\n\t\tvar xPackData = new KBEngine.MemoryStream.PackFloatXType();\r\n\t\tvar zPackData = new KBEngine.MemoryStream.PackFloatXType();\r\n\t\t\r\n\t\txPackData.fv[0] = 0.0;\r\n\t\tzPackData.fv[0] = 0.0;\r\n\r\n\t\txPackData.uv[0] = 0x40000000;\r\n\t\tzPackData.uv[0] = 0x40000000;\r\n\t\t\t\r\n\t\tvar v1 = this.readUint8();\r\n\t\tvar v2 = this.readUint8();\r\n\t\tvar v3 = this.readUint8();\r\n\r\n\t\tvar data = 0;\r\n\t\tdata |= (v1 << 16);\r\n\t\tdata |= (v2 << 8);\r\n\t\tdata |= v3;\r\n\r\n\t\txPackData.uv[0] |= (data & 0x7ff000) << 3;\r\n\t\tzPackData.uv[0] |= (data & 0x0007ff) << 15;\r\n\r\n\t\txPackData.fv[0] -= 2.0;\r\n\t\tzPackData.fv[0] -= 2.0;\r\n\t\r\n\t\txPackData.uv[0] |= (data & 0x800000) << 8;\r\n\t\tzPackData.uv[0] |= (data & 0x000800) << 20;\r\n\t\t\t\r\n\t\tvar data = new Array(2);\r\n\t\tdata[0] = xPackData.fv[0];\r\n\t\tdata[1] = zPackData.fv[0];\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.readPackY = function()\r\n\t{\r\n\t\tvar v = this.readUint16();\r\n\t\treturn v;\r\n\t}\r\n\t\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.writeInt8 = function(v)\r\n\t{\r\n\t\tvar buf = new Int8Array(this.buffer, this.wpos, 1);\r\n\t\tbuf[0] = v;\r\n\t\tthis.wpos += 1;\r\n\t}\r\n\r\n\tthis.writeInt16 = function(v)\r\n\t{\t\r\n\t\tthis.writeInt8(v & 0xff);\r\n\t\tthis.writeInt8(v >> 8 & 0xff);\r\n\t}\r\n\t\t\r\n\tthis.writeInt32 = function(v)\r\n\t{\r\n\t\tfor(var i=0; i<4; i++)\r\n\t\t\tthis.writeInt8(v >> i * 8 & 0xff);\r\n\t}\r\n\r\n\tthis.writeInt64 = function(v)\r\n\t{\r\n\t\tthis.writeInt32(v.lo);\r\n\t\tthis.writeInt32(v.hi);\r\n\t}\r\n\t\r\n\tthis.writeUint8 = function(v)\r\n\t{\r\n\t\tvar buf = new Uint8Array(this.buffer, this.wpos, 1);\r\n\t\tbuf[0] = v;\r\n\t\tthis.wpos += 1;\r\n\t}\r\n\r\n\tthis.writeUint16 = function(v)\r\n\t{\r\n\t\tthis.writeUint8(v & 0xff);\r\n\t\tthis.writeUint8(v >> 8 & 0xff);\r\n\t}\r\n\t\t\r\n\tthis.writeUint32 = function(v)\r\n\t{\r\n\t\tfor(var i=0; i<4; i++)\r\n\t\t\tthis.writeUint8(v >> i * 8 & 0xff);\r\n\t}\r\n\r\n\tthis.writeUint64 = function(v)\r\n\t{\r\n\t\tthis.writeUint32(v.lo);\r\n\t\tthis.writeUint32(v.hi);\r\n\t}\r\n\t\r\n\tthis.writeFloat = function(v)\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tvar buf = new Float32Array(this.buffer, this.wpos, 1);\r\n\t\t\tbuf[0] = v;\r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{\r\n\t\t\tvar buf = new Float32Array(1);\r\n\t\t\tbuf[0] = v;\r\n\t\t\tvar buf1 = new Uint8Array(this.buffer);\r\n\t\t\tvar buf2 = new Uint8Array(buf.buffer);\r\n\t\t\tbuf1.set(buf2, this.wpos);\r\n\t\t}\r\n\t\t\r\n\t\tthis.wpos += 4;\r\n\t}\r\n\r\n\tthis.writeDouble = function(v)\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tvar buf = new Float64Array(this.buffer, this.wpos, 1);\r\n\t\t\tbuf[0] = v;\r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{\r\n\t\t\tvar buf = new Float64Array(1);\r\n\t\t\tbuf[0] = v;\r\n\t\t\tvar buf1 = new Uint8Array(this.buffer);\r\n\t\t\tvar buf2 = new Uint8Array(buf.buffer);\r\n\t\t\tbuf1.set(buf2, this.wpos);\r\n\t\t}\r\n\r\n\t\tthis.wpos += 8;\r\n\t}\r\n\r\n\tthis.writeBlob = function(v)\r\n\t{\r\n\t\tvar size = v.length;\r\n\t\tif(size + 4> this.space())\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"memorystream::writeBlob: no free!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis.writeUint32(size);\r\n\t\tvar buf = new Uint8Array(this.buffer, this.wpos, size);\r\n\t\t\r\n\t\tif(typeof(v) == \"string\")\r\n\t\t{\r\n\t\t\tfor(var i=0; i<size; i++)\r\n\t\t\t{\r\n\t\t\t\tbuf[i] = v.charCodeAt(i);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfor(var i=0; i<size; i++)\r\n\t\t\t{\r\n\t\t\t\tbuf[i] = v[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.wpos += size;\r\n\t}\r\n\t\r\n\tthis.writeString = function(v)\r\n\t{\r\n\t\tif(v.length > this.space())\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"memorystream::writeString: no free!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar buf = new Uint8Array(this.buffer, this.wpos);\r\n\t\tvar i = 0;\r\n\t\tfor(var idx=0; idx<v.length; idx++)\r\n\t\t{\r\n\t\t\tbuf[i++] = v.charCodeAt(idx);\r\n\t\t}\r\n\t\t\r\n\t\tbuf[i++] = 0;\r\n\t\tthis.wpos += i;\r\n\t}\r\n\r\n\tthis.append = function(stream, offset, size)\r\n\t{\r\n\t\tif(!(stream instanceof KBEngine.MemoryStream)) \r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"MemoryStream::append(): stream must be MemoryStream instances\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(size > this.space())\r\n\t\t{\r\n\t\t\tthis.buffer = ArrayBuffer.transfer(this.buffer, this.buffer.byteLength + size * 2);\r\n\t\t}\r\n\r\n\t\tvar buf = new Uint8Array(this.buffer, this.wpos, size);\r\n\t\tbuf.set(new Uint8Array(stream.buffer, offset, size), 0);\r\n\t\tthis.wpos += size;\r\n\t}\r\n\t\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.readSkip = function(v)\r\n\t{\r\n\t\tthis.rpos += v;\r\n\t}\r\n\t\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.space = function()\r\n\t{\r\n\t\treturn this.buffer.byteLength - this.wpos;\r\n\t}\r\n\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.length = function()\r\n\t{\r\n\t\treturn this.wpos - this.rpos;\r\n\t}\r\n\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.readEOF = function()\r\n\t{\r\n\t\treturn this.buffer.byteLength - this.rpos <= 0;\r\n\t}\r\n\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.done = function()\r\n\t{\r\n\t\tthis.rpos = this.wpos;\r\n\t}\r\n\t\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.getbuffer = function(v)\r\n\t{\r\n\t\treturn this.buffer.slice(this.rpos, this.wpos);\r\n\t}\r\n\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.size = function()\r\n\t{\r\n\t\treturn this.buffer.byteLength;\r\n\t}\r\n\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.clear = function()\r\n\t{\r\n\t\tthis.rpos = 0;\r\n\t\tthis.wpos = 0;\r\n\r\n\t\tif(this.buffer.byteLength > KBEngine.PACKET_MAX_SIZE)\r\n\t\t\tthis.buffer = new ArrayBuffer(KBEngine.PACKET_MAX_SIZE);\r\n\t}\r\n}\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tbundle\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.Bundle = function()\r\n{\r\n\tthis.memorystreams = new Array();\r\n\tthis.stream = new KBEngine.MemoryStream(KBEngine.PACKET_MAX_SIZE_TCP);\r\n\t\r\n\tthis.numMessage = 0;\r\n\tthis.messageLengthBuffer = null;\r\n\tthis.messageLength = 0;\r\n\tthis.msgtype = null;\r\n\t\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.newMessage = function(msgtype)\r\n\t{\r\n\t\tthis.fini(false);\r\n\t\t\r\n\t\tthis.msgtype = msgtype;\r\n\t\tthis.numMessage += 1;\r\n\t\t\r\n\t\tif(this.msgtype.length == -1)\r\n\t\t{\r\n\t\t\tthis.messageLengthBuffer = new Uint8Array(this.stream.buffer, this.stream.wpos + KBEngine.MESSAGE_ID_LENGTH, 2);\r\n\t\t}\r\n\t\t\r\n\t\tthis.writeUint16(msgtype.id);\r\n\t\t\r\n\t\tif(this.messageLengthBuffer)\r\n\t\t{\r\n\t\t\tthis.writeUint16(0);\r\n\t\t\tthis.messageLengthBuffer[0] = 0;\r\n\t\t\tthis.messageLengthBuffer[1] = 0;\r\n\t\t\tthis.messageLength = 0;\r\n\t\t}\r\n\t}\r\n\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.writeMsgLength = function(v)\r\n\t{\r\n\t\tif(this.messageLengthBuffer)\r\n\t\t{\r\n\t\t\tthis.messageLengthBuffer[0] = v & 0xff;\r\n\t\t\tthis.messageLengthBuffer[1] = v >> 8 & 0xff;\r\n\t\t}\r\n\t}\r\n\t\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.fini = function(issend)\r\n\t{\r\n\t\tif(this.numMessage > 0)\r\n\t\t{\r\n\t\t\tthis.writeMsgLength(this.messageLength);\r\n\t\t\tif(this.stream)\r\n\t\t\t\tthis.memorystreams.push(this.stream);\r\n\t\t}\r\n\t\t\r\n\t\tif(issend)\r\n\t\t{\r\n\t\t\tthis.messageLengthBuffer = null;\r\n\t\t\tthis.numMessage = 0;\r\n\t\t\tthis.msgtype = null;\r\n\t\t}\r\n\t}\r\n\t\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.send = function(network)\r\n\t{\r\n\t\tthis.fini(true);\r\n\t\t\r\n\t\tfor(var i=0; i<this.memorystreams.length; i++)\r\n\t\t{\r\n\t\t\tvar tmpStream = this.memorystreams[i];\r\n\t\t\tnetwork.send(tmpStream.getbuffer());\r\n\t\t}\r\n\t\t\r\n\t\tthis.memorystreams = new Array();\r\n\t\tthis.stream = new KBEngine.MemoryStream(KBEngine.PACKET_MAX_SIZE_TCP);\r\n\t}\r\n\t\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.checkStream = function(v)\r\n\t{\r\n\t\tif(v > this.stream.space())\r\n\t\t{\r\n\t\t\tthis.memorystreams.push(this.stream);\r\n\t\t\tthis.stream = new KBEngine.MemoryStream(KBEngine.PACKET_MAX_SIZE_TCP);\r\n\t\t}\r\n\r\n\t\tthis.messageLength += v;\r\n\t}\r\n\t\r\n\t//---------------------------------------------------------------------------------\r\n\tthis.writeInt8 = function(v)\r\n\t{\r\n\t\tthis.checkStream(1);\r\n\t\tthis.stream.writeInt8(v);\r\n\t}\r\n\r\n\tthis.writeInt16 = function(v)\r\n\t{\r\n\t\tthis.checkStream(2);\r\n\t\tthis.stream.writeInt16(v);\r\n\t}\r\n\t\t\r\n\tthis.writeInt32 = function(v)\r\n\t{\r\n\t\tthis.checkStream(4);\r\n\t\tthis.stream.writeInt32(v);\r\n\t}\r\n\r\n\tthis.writeInt64 = function(v)\r\n\t{\r\n\t\tthis.checkStream(8);\r\n\t\tthis.stream.writeInt64(v);\r\n\t}\r\n\t\r\n\tthis.writeUint8 = function(v)\r\n\t{\r\n\t\tthis.checkStream(1);\r\n\t\tthis.stream.writeUint8(v);\r\n\t}\r\n\r\n\tthis.writeUint16 = function(v)\r\n\t{\r\n\t\tthis.checkStream(2);\r\n\t\tthis.stream.writeUint16(v);\r\n\t}\r\n\t\t\r\n\tthis.writeUint32 = function(v)\r\n\t{\r\n\t\tthis.checkStream(4);\r\n\t\tthis.stream.writeUint32(v);\r\n\t}\r\n\r\n\tthis.writeUint64 = function(v)\r\n\t{\r\n\t\tthis.checkStream(8);\r\n\t\tthis.stream.writeUint64(v);\r\n\t}\r\n\t\r\n\tthis.writeFloat = function(v)\r\n\t{\r\n\t\tthis.checkStream(4);\r\n\t\tthis.stream.writeFloat(v);\r\n\t}\r\n\r\n\tthis.writeDouble = function(v)\r\n\t{\r\n\t\tthis.checkStream(8);\r\n\t\tthis.stream.writeDouble(v);\r\n\t}\r\n\t\r\n\tthis.writeString = function(v)\r\n\t{\r\n\t\tthis.checkStream(v.length + 1);\r\n\t\tthis.stream.writeString(v);\r\n\t}\r\n\t\r\n\tthis.writeBlob = function(v)\r\n\t{\r\n\t\tthis.checkStream(v.length + 4);\r\n\t\tthis.stream.writeBlob(v);\r\n\t}\r\n}\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tmessages\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.reader = new KBEngine.MemoryStream(0);\r\nKBEngine.datatype2id = {};\r\n\r\nKBEngine.mappingDataType = function(writer, argType)\r\n{\r\n\tKBEngine.datatype2id = {};\r\n\tKBEngine.datatype2id[\"STRING\"] = 1;\r\n\tKBEngine.datatype2id[\"STD::STRING\"] = 1;\r\n\r\n\tKBEngine.datatype2id[\"UINT8\"] = 2;\r\n\tKBEngine.datatype2id[\"BOOL\"] = 2;\r\n\tKBEngine.datatype2id[\"DATATYPE\"] = 2;\r\n\tKBEngine.datatype2id[\"CHAR\"] = 2;\r\n\tKBEngine.datatype2id[\"DETAIL_TYPE\"] = 2;\r\n\tKBEngine.datatype2id[\"ENTITYCALL_CALL_TYPE\"] = 2;\r\n\r\n\tKBEngine.datatype2id[\"UINT16\"] = 3;\r\n\tKBEngine.datatype2id[\"UNSIGNED SHORT\"] = 3;\r\n\tKBEngine.datatype2id[\"SERVER_ERROR_CODE\"] = 3;\r\n\tKBEngine.datatype2id[\"ENTITY_TYPE\"] = 3;\r\n\tKBEngine.datatype2id[\"ENTITY_PROPERTY_UID\"] = 3;\r\n\tKBEngine.datatype2id[\"ENTITY_METHOD_UID\"] = 3;\r\n\tKBEngine.datatype2id[\"ENTITY_SCRIPT_UID\"] = 3;\r\n\tKBEngine.datatype2id[\"DATATYPE_UID\"] = 3;\r\n\r\n\tKBEngine.datatype2id[\"UINT32\"] = 4;\r\n\tKBEngine.datatype2id[\"UINT\"] = 4;\r\n\tKBEngine.datatype2id[\"UNSIGNED INT\"] = 4;\r\n\tKBEngine.datatype2id[\"ARRAYSIZE\"] = 4;\r\n\tKBEngine.datatype2id[\"SPACE_ID\"] = 4;\r\n\tKBEngine.datatype2id[\"GAME_TIME\"] = 4;\r\n\tKBEngine.datatype2id[\"TIMER_ID\"] = 4;\r\n\r\n\tKBEngine.datatype2id[\"UINT64\"] = 5;\r\n\tKBEngine.datatype2id[\"DBID\"] = 5;\r\n\tKBEngine.datatype2id[\"COMPONENT_ID\"] = 5;\r\n\r\n\tKBEngine.datatype2id[\"INT8\"] = 6;\r\n\tKBEngine.datatype2id[\"COMPONENT_ORDER\"] = 6;\r\n\r\n\tKBEngine.datatype2id[\"INT16\"] = 7;\r\n\tKBEngine.datatype2id[\"SHORT\"] = 7;\r\n\r\n\tKBEngine.datatype2id[\"INT32\"] = 8;\r\n\tKBEngine.datatype2id[\"INT\"] = 8;\r\n\tKBEngine.datatype2id[\"ENTITY_ID\"] = 8;\r\n\tKBEngine.datatype2id[\"CALLBACK_ID\"] = 8;\r\n\tKBEngine.datatype2id[\"COMPONENT_TYPE\"] = 8;\r\n\r\n\tKBEngine.datatype2id[\"INT64\"] = 9;\r\n\r\n\tKBEngine.datatype2id[\"PYTHON\"] = 10;\r\n\tKBEngine.datatype2id[\"PY_DICT\"] = 10;\r\n\tKBEngine.datatype2id[\"PY_TUPLE\"] = 10;\r\n\tKBEngine.datatype2id[\"PY_LIST\"] = 10;\r\n\r\n\tKBEngine.datatype2id[\"BLOB\"] = 11;\r\n\r\n\tKBEngine.datatype2id[\"UNICODE\"] = 12;\r\n\r\n\tKBEngine.datatype2id[\"FLOAT\"] = 13;\r\n\r\n\tKBEngine.datatype2id[\"DOUBLE\"] = 14;\r\n\r\n\tKBEngine.datatype2id[\"VECTOR2\"] = 15;\r\n\r\n\tKBEngine.datatype2id[\"VECTOR3\"] = 16;\r\n\r\n\tKBEngine.datatype2id[\"VECTOR4\"] = 17;\r\n\r\n\tKBEngine.datatype2id[\"FIXED_DICT\"] = 18;\r\n\r\n\tKBEngine.datatype2id[\"ARRAY\"] = 19;\r\n\r\n\tKBEngine.datatype2id[\"ENTITYCALL\"] = 20;\r\n}\r\n\r\nKBEngine.mappingDataType();\r\n\r\nKBEngine.bindwriter = function(writer, argType)\r\n{\r\n\tif(argType == KBEngine.datatype2id[\"UINT8\"])\r\n\t{\r\n\t\treturn writer.writeUint8;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"UINT16\"])\r\n\t{\r\n\t\treturn writer.writeUint16;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"UINT32\"])\r\n\t{\r\n\t\treturn writer.writeUint32;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"UINT64\"])\r\n\t{\r\n\t\treturn writer.writeUint64;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"INT8\"])\r\n\t{\r\n\t\treturn writer.writeInt8;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"INT16\"])\r\n\t{\r\n\t\treturn writer.writeInt16;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"INT32\"])\r\n\t{\r\n\t\treturn writer.writeInt32;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"INT64\"])\r\n\t{\r\n\t\treturn writer.writeInt64;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"FLOAT\"])\r\n\t{\r\n\t\treturn writer.writeFloat;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"DOUBLE\"])\r\n\t{\r\n\t\treturn writer.writeDouble;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"STRING\"])\r\n\t{\r\n\t\treturn writer.writeString;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"FIXED_DICT\"])\r\n\t{\r\n\t\treturn writer.writeStream;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"ARRAY\"])\r\n\t{\r\n\t\treturn writer.writeStream;\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturn writer.writeStream;\r\n\t}\r\n}\r\n\r\nKBEngine.bindReader = function(argType)\r\n{\r\n\tif(argType == KBEngine.datatype2id[\"UINT8\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readUint8;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"UINT16\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readUint16;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"UINT32\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readUint32;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"UINT64\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readUint64;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"INT8\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readInt8;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"INT16\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readInt16;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"INT32\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readInt32;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"INT64\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readInt64;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"FLOAT\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readFloat;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"DOUBLE\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readDouble;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"STRING\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readString;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"PYTHON\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readStream;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"VECTOR2\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readStream;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"VECTOR3\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readStream;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"VECTOR4\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readStream;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"BLOB\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readStream;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"UNICODE\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readStream;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"FIXED_DICT\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readStream;\r\n\t}\r\n\telse if(argType == KBEngine.datatype2id[\"ARRAY\"])\r\n\t{\r\n\t\treturn KBEngine.reader.readStream;\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturn KBEngine.reader.readStream;\r\n\t}\r\n}\r\n\t\r\nKBEngine.Message = function(id, name, length, argstype, args, handler)\r\n{\r\n\tthis.id = id;\r\n\tthis.name = name;\r\n\tthis.length = length;\r\n\tthis.argsType = argstype;\r\n\t\r\n\t// 绑定执行\r\n\tfor(var i=0; i<args.length; i++)\r\n\t{\r\n\t\targs[i] = KBEngine.bindReader(args[i]);\r\n\t}\r\n\t\r\n\tthis.args = args;\r\n\tthis.handler = handler;\r\n\t\r\n\tthis.createFromStream = function(msgstream)\r\n\t{\r\n\t\tif(this.args.length <= 0)\r\n\t\t\treturn msgstream;\r\n\t\t\r\n\t\tvar result = new Array(this.args.length);\r\n\t\tfor(var i=0; i<this.args.length; i++)\r\n\t\t{\r\n\t\t\tresult[i] = this.args[i].call(msgstream);\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tthis.handleMessage = function(msgstream)\r\n\t{\r\n\t\tif(this.handler == null)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngine.Message::handleMessage: interface(\" + this.name + \"/\" + this.id + \") no implement!\");  \r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(this.args.length <= 0)\r\n\t\t{\r\n\t\t\tif(this.argsType < 0)\r\n\t\t\t\tthis.handler(msgstream);\r\n\t\t\telse\r\n\t\t\t\tthis.handler();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.handler.apply(KBEngine.app, this.createFromStream(msgstream));\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// 上行消息\r\nKBEngine.messages = {};\r\nKBEngine.messages[\"loginapp\"] = {};\r\nKBEngine.messages[\"baseapp\"] = {};\r\nKBEngine.clientmessages = {};\r\n\r\nKBEngine.messages[\"Loginapp_importClientMessages\"] = new KBEngine.Message(5, \"importClientMessages\", 0, 0, new Array(), null);\r\nKBEngine.messages[\"Baseapp_importClientMessages\"] = new KBEngine.Message(207, \"importClientMessages\", 0, 0, new Array(), null);\r\nKBEngine.messages[\"Baseapp_importClientEntityDef\"] = new KBEngine.Message(208, \"importClientEntityDef\", 0, 0, new Array(), null);\r\nKBEngine.messages[\"onImportClientMessages\"] = new KBEngine.Message(518, \"onImportClientMessages\", -1, -1, new Array(), null);\r\n\r\nKBEngine.bufferedCreateEntityMessages = {};\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tmath\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.Vector2 = KBEngine.Class.extend(\r\n{\r\n\t\tctor:function (x, y) {\r\n\t\t\tthis.x = x;\r\n\t\t\tthis.y = y;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\r\n\t\tdistance : function(pos)\r\n\t\t{\r\n\t\t\tvar x = pos.x - this.x;\r\n\t\t\tvar y = pos.y - this.y;\r\n\t\t\treturn Math.sqrt(x * x + y * y);\r\n\t\t},\r\n\r\n\t\tadd : function(vec3)\r\n\t\t{\r\n\t\t\tthis.x += vec3.x;\r\n\t\t\tthis.y += vec3.y;\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsub: function(vec3)\r\n\t\t{\r\n\t\t\tthis.x -= vec3.x;\r\n\t\t\tthis.y -= vec3.y;\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tmul: function(num)\r\n\t\t{\r\n\t\t\tthis.x *= num;\r\n\t\t\tthis.y *= num;\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tdiv: function(num)\r\n\t\t{\r\n\t\t\tthis.x /= num;\r\n\t\t\tthis.y /= num;\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tneg: function()\r\n\t\t{\r\n\t\t\tthis.x = -this.x;\r\n\t\t\tthis.y = -this.y;\r\n\t\t\treturn this;\r\n\t\t}\r\n});\r\n\r\nKBEngine.Vector3 = KBEngine.Class.extend(\r\n{\r\n    ctor:function (x, y, z) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n        return true;\r\n    },\r\n\r\n    distance : function(pos)\r\n    {\r\n    \tvar x = pos.x - this.x;\r\n    \tvar y = pos.y - this.y;\r\n    \tvar z = pos.z - this.z;\r\n    \treturn Math.sqrt(x * x + y * y + z * z);\r\n\t},\r\n\t\r\n\t//向量加法\r\n\tadd : function(vec3)\r\n\t{\r\n\t\tthis.x += vec3.x;\r\n\t\tthis.y += vec3.y;\r\n\t\tthis.z += vec3.z;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t//向量减法\r\n\tsub: function(vec3)\r\n\t{\r\n\t\tthis.x -= vec3.x;\r\n\t\tthis.y -= vec3.y;\r\n\t\tthis.z -= vec3.z;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t//向量乘法\r\n\tmul: function(num)\r\n\t{\r\n\t\tthis.x *= num;\r\n\t\tthis.y *= num;\r\n\t\tthis.z *= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t//向量除法\r\n\tdiv: function(num)\r\n\t{\r\n\t\tthis.x /= num;\r\n\t\tthis.y /= num;\r\n\t\tthis.z /= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t// 向量取反\r\n\tneg: function()\r\n\t{\r\n\t\tthis.x = -this.x;\r\n\t\tthis.y = -this.y;\r\n\t\tthis.z = -this.z;\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nKBEngine.Vector4 = KBEngine.Class.extend(\r\n{\r\n\tctor:function (x, y, z, w) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\t\tthis.w = w;\r\n\t\treturn true;\r\n\t},\r\n\r\n\tdistance : function(pos)\r\n\t{\r\n\t\tvar x = pos.x - this.x;\r\n\t\tvar y = pos.y - this.y;\r\n\t\tvar z = pos.z - this.z;\r\n\t\tvar w = pos.w - this.w;\r\n\t\treturn Math.sqrt(x * x + y * y + z * z + w * w );\r\n\t},\r\n\r\n\tadd : function(vec4)\r\n\t{\r\n\t\tthis.x += vec4.x;\r\n\t\tthis.y += vec4.y;\r\n\t\tthis.z += vec4.z;\r\n\t\tthis.w += vec4.w;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsub: function(vec4)\r\n\t{\r\n\t\tthis.x -= vec4.x;\r\n\t\tthis.y -= vec4.y;\r\n\t\tthis.z -= vec4.z;\r\n\t\tthis.w -= vec4.w;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tmul: function(num)\r\n\t{\r\n\t\tthis.x *= num;\r\n\t\tthis.y *= num;\r\n\t\tthis.z *= num;\r\n\t\tthis.w *= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdiv: function(num)\r\n\t{\r\n\t\tthis.x /= num;\r\n\t\tthis.y /= num;\r\n\t\tthis.z /= num;\r\n\t\tthis.w /= num;\r\n\t\treturn this;\r\n\t},\r\n\r\n\tneg: function()\r\n\t{\r\n\t\tthis.x = -this.x;\r\n\t\tthis.y = -this.y;\r\n\t\tthis.z = -this.z;\r\n\t\tthis.w = -this.w;\r\n\t\treturn this;\r\n\t}\r\n});\r\n\r\nKBEngine.clampf = function (value, min_inclusive, max_inclusive) \r\n{\r\n    if (min_inclusive > max_inclusive) {\r\n        var temp = min_inclusive;\r\n        min_inclusive = max_inclusive;\r\n        max_inclusive = temp;\r\n    }\r\n    return value < min_inclusive ? min_inclusive : value < max_inclusive ? value : max_inclusive;\r\n};\r\n\r\nKBEngine.int82angle = function(angle/*int8*/, half/*bool*/)\r\n{\r\n\treturn angle * (Math.PI / (half ? 254.0 : 128.0));\r\n};\r\n\r\nKBEngine.angle2int8 = function(v/*float*/, half/*bool*/)\r\n{\r\n\tvar angle = 0;\r\n\tif(!half)\r\n\t{\r\n\t\tangle = Math.floor((v * 128.0) / float(Math.PI) + 0.5);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tangle = KBEngine.clampf(floorf( (v * 254.0) / float(Math.PI) + 0.5), -128.0, 127.0);\r\n\t}\r\n\r\n\treturn angle;\r\n};\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tentity\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.Entity = KBEngine.Class.extend(\r\n{\r\n    ctor:function () {\r\n\t\tthis.id = 0;\r\n\t\tthis.className = \"\";\r\n\t\tthis.position = new KBEngine.Vector3(0.0, 0.0, 0.0);\r\n\t\tthis.direction = new KBEngine.Vector3(0.0, 0.0, 0.0);\r\n\t\tthis.velocity = 0.0\r\n\t\t\t\r\n\t\tthis.cell = null;\r\n\t\tthis.base = null;\r\n\t\t\r\n\t\t// enterworld之后设置为true\r\n\t\tthis.inWorld = false;\r\n\t\t\r\n\t\t// __init__调用之后设置为true\r\n\t\tthis.inited = false;\r\n\t\t\r\n\t\t// 是否被控制\r\n\t\tthis.isControlled = false;\r\n\r\n\t\tthis.entityLastLocalPos = new KBEngine.Vector3(0.0, 0.0, 0.0);\r\n\t\tthis.entityLastLocalDir = new KBEngine.Vector3(0.0, 0.0, 0.0);\r\n\t\t\r\n\t\t// 玩家是否在地面上\r\n\t\tthis.isOnGround = false;\r\n\r\n\t\tthis.holds=[]\r\n\t\tthis.roomKeyc=[]\r\n\t\t\r\n\r\n        return true;\r\n    },\r\n    \r\n    // 与服务端实体脚本中__init__类似, 代表初始化实体\r\n\t__init__ : function()\r\n\t{\r\n\t},\r\n\r\n\tcallPropertysSetMethods : function()\r\n\t{\r\n\t\tvar currModule = KBEngine.moduledefs[this.className];\r\n\t\tfor(var name in currModule.propertys)\r\n\t\t{\r\n\t\t\tvar propertydata = currModule.propertys[name];\r\n\t\t\tvar properUtype = propertydata[0];\r\n\t\t\tvar name = propertydata[2];\r\n\t\t\tvar setmethod = propertydata[5];\r\n\t\t\tvar flags = propertydata[6];\r\n\t\t\tvar oldval = this[name];\r\n\t\t\t\r\n\t\t\tif(setmethod != null)\r\n\t\t\t{\r\n\t\t\t\t// base类属性或者进入世界后cell类属性会触发set_*方法\r\n\t\t\t\t// ED_FLAG_BASE_AND_CLIENT、ED_FLAG_BASE\r\n\t\t\t\tif(flags == 0x00000020 || flags == 0x00000040)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(this.inited && !this.inWorld)\r\n\t\t\t\t\t\tsetmethod.call(this, oldval);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif(this.inWorld)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(flags == 0x00000008 || flags == 0x00000010)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif(!this.isPlayer())\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsetmethod.call(this, oldval);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\r\n\tonDestroy : function()\r\n\t{\r\n\t},\r\n\r\n\tonControlled : function(bIsControlled)\r\n\t{\r\n\t},\r\n\r\n\tisPlayer : function()\r\n\t{\r\n\t\treturn this.id == KBEngine.app.entity_id;\r\n\t},\r\n\r\n\tbaseCall : function()\r\n\t{\r\n\t\tif(arguments.length < 1)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG('KBEngine.Entity::baseCall: not fount interfaceName!');  \r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(this.base == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG('KBEngine.Entity::baseCall: base is None!');  \r\n\t\t\treturn;\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tvar method = KBEngine.moduledefs[this.className].base_methods[arguments[0]];\r\n\r\n\t\tif(method == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngine.Entity::baseCall: The server did not find the def_method(\" + this.className + \".\" + arguments[0] + \")!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar methodID = method[0];\r\n\t\tvar args = method[3];\r\n\t\t\r\n\t\tif(arguments.length - 1 != args.length)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngine.Entity::baseCall: args(\" + (arguments.length - 1) + \"!= \" + args.length + \") size is error!\");  \r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis.base.newCall();\r\n\t\tthis.base.bundle.writeUint16(methodID);\r\n\t\t\r\n\t\ttry\r\n\t\t{\r\n\t\t\tfor(var i=0; i<args.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif(args[i].isSameType(arguments[i + 1]))\r\n\t\t\t\t{\r\n\t\t\t\t\targs[i].addToStream(this.base.bundle, arguments[i + 1]);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error(\"KBEngine.Entity::baseCall: arg[\" + i + \"] is error!\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(e.toString());\r\n\t\t\tKBEngine.ERROR_MSG('KBEngine.Entity::baseCall: args is error!');\r\n\t\t\tthis.base.bundle = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis.base.sendCall();\r\n\t},\r\n\t\r\n\tcellCall : function()\r\n\t{\r\n\t\tif(arguments.length < 1)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG('KBEngine.Entity::cellCall: not fount interfaceName!');  \r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(this.cell == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG('KBEngine.Entity::cellCall: cell is None!');  \r\n\t\t\treturn;\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tvar method = KBEngine.moduledefs[this.className].cell_methods[arguments[0]];\r\n\t\t\r\n\t\tif(method == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngine.Entity::cellCall: The server did not find the def_method(\" + this.className + \".\" + arguments[0] + \")!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar methodID = method[0];\r\n\t\tvar args = method[3];\r\n\t\t\r\n\t\tif(arguments.length - 1 != args.length)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngine.Entity::cellCall: args(\" + (arguments.length - 1) + \"!= \" + args.length + \") size is error!\");  \r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis.cell.newCall();\r\n\t\tthis.cell.bundle.writeUint16(methodID);\r\n\t\t\r\n\t\ttry\r\n\t\t{\r\n\t\t\tfor(var i=0; i<args.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif(args[i].isSameType(arguments[i + 1]))\r\n\t\t\t\t{\r\n\t\t\t\t\targs[i].addToStream(this.cell.bundle, arguments[i + 1]);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow new Error(\"KBEngine.Entity::cellCall: arg[\" + i + \"] is error!\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(e.toString());\r\n\t\t\tKBEngine.ERROR_MSG('KBEngine.Entity::cellCall: args is error!');\r\n\t\t\tthis.cell.bundle = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis.cell.sendCall();\r\n\t},\r\n\t\r\n\tenterWorld : function()\r\n\t{\r\n\t\tKBEngine.INFO_MSG(this.className + '::enterWorld: ' + this.id); //多次收到\r\n\t\tthis.inWorld = true;\r\n\t\t\r\n\t\t//KBEngine.Event.fire(KBEngine.EventTypes.onSetSpaceData, this);\r\n\t\tthis.onEnterWorld();//转到子Avatar.js 中的onEnterWorld()\r\n\t},\r\n\r\n\tonEnterWorld : function()  \r\n\t{\r\n\t\tcc.log(\"entity.onEnterWorld\")\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onEnterWorld, this);\r\n\t},\r\n\t\t\r\n\tleaveWorld : function()\r\n\t{\r\n\t\tKBEngine.INFO_MSG(this.className + '::leaveWorld: ' + this.id); \r\n\t\tthis.inWorld = false;\r\n\t\tthis.onLeaveWorld();\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onLeaveWorld, this);\r\n\t},\r\n\r\n\tonLeaveWorld : function()\r\n\t{\r\n\t},\r\n\t\t\r\n\tenterSpace : function()\r\n\t{\r\n\t\tKBEngine.INFO_MSG(this.className + '::enterSpace: ' + this.id); \r\n\t\tthis.onEnterSpace();\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onEnterSpace, this);\r\n\t\t\r\n\t\t// 要立即刷新表现层对象的位置\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.set_position, this);\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.set_direction, this);\r\n\t},\r\n\r\n\tonEnterSpace : function()\r\n\t{\r\n\t},\r\n\t\t\r\n\tleaveSpace : function()\r\n\t{\r\n\t\tKBEngine.INFO_MSG(this.className + '::leaveSpace: ' + this.id); \r\n\t\tthis.onLeaveSpace();\r\n\t\tKBEngine.Event.fire(\"onLeaveSpace\", this);\r\n\t},\r\n\r\n\tonLeaveSpace : function()\r\n\t{\r\n\t},\r\n\tset_roomKeyc : function(old)\r\n\t{\r\n\t\t\r\n\t\tcc.log(\"kbengine.entity ::set_roomkeyc\",this.roomKeyc.join(\"\"))\r\n\t\tKBEngine.Event.fire(\"entity_updateroomkey\",this.roomKeyc,this);\r\n\t\t\r\n\t},\r\n\tset_holds : function(old)\r\n\t{\r\n\t\t\r\n\t\tcc.log(\"kbengine.entity ::set_holds\")\r\n\t\tfor(var i=0;i<this.holds.length;i++){\r\n\t\t\tcc.log(this.holds[i])\r\n\t\t}\r\n\t\tKBEngine.Event.fire(\"entity_updateholds\",this.holds,this);\r\n\t},\r\n\tset_position : function(old)\r\n\t{\r\n\t\t// KBEngine.DEBUG_MSG(this.className + \"::set_position: \" + old);  \r\n\t\t\r\n\t\tif(this.isPlayer())\r\n\t\t{\r\n\t\t\tKBEngine.app.entityServerPos.x = this.position.x;\r\n\t\t\tKBEngine.app.entityServerPos.y = this.position.y;\r\n\t\t\tKBEngine.app.entityServerPos.z = this.position.z;\r\n\t\t}\r\n\t\t\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.set_position, this);\r\n\t},\r\n\r\n\tonUpdateVolatileData : function()\r\n\t{\r\n\t},\r\n\t\r\n\tset_direction : function(old)\r\n\t{\r\n\t\t// KBEngine.DEBUG_MSG(this.className + \"::set_direction: \" + old);  \r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.set_direction, this);\r\n\t}\r\n});\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tEntityCall\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.ENTITYCALL_TYPE_CELL = 0;\r\nKBEngine.ENTITYCALL_TYPE_BASE = 1;\r\n\r\nKBEngine.EntityCall = function()\r\n{\r\n\tthis.id = 0;\r\n\tthis.className = \"\";\r\n\tthis.type = KBEngine.ENTITYCALL_TYPE_CELL;\r\n\tthis.networkInterface = KBEngine.app;\r\n\t\r\n\tthis.bundle = null;\r\n\t\r\n\tthis.isBase = function()\r\n\t{\r\n\t\treturn this.type == KBEngine.ENTITYCALL_TYPE_BASE;\r\n\t}\r\n\r\n\tthis.isCell = function()\r\n\t{\r\n\t\treturn this.type == KBEngine.ENTITYCALL_TYPE_CELL;\r\n\t}\r\n\t\r\n\tthis.newCall = function()\r\n\t{  \r\n\t\tif(this.bundle == null)\r\n\t\t\tthis.bundle = new KBEngine.Bundle();\r\n\t\t\r\n\t\tif(this.type == KBEngine.ENTITYCALL_TYPE_CELL)\r\n\t\t\tthis.bundle.newMessage(KBEngine.messages.Baseapp_onRemoteCallCellMethodFromClient);\r\n\t\telse\r\n\t\t\tthis.bundle.newMessage(KBEngine.messages.Entity_onRemoteMethodCall);\r\n\r\n\t\tthis.bundle.writeInt32(this.id);\r\n\t\t\r\n\t\treturn this.bundle;\r\n\t}\r\n\t\r\n\tthis.sendCall = function(bundle)\r\n\t{\r\n\t\tif(bundle == undefined)\r\n\t\t\tbundle = this.bundle;\r\n\t\t\r\n\t\tbundle.send(this.networkInterface);\r\n\t\t\r\n\t\tif(this.bundle == bundle)\r\n\t\t\tthis.bundle = null;\r\n\t}\r\n}\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tentitydef\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.moduledefs = {};\r\nKBEngine.datatypes = {};\r\n\r\nKBEngine.DATATYPE_UINT8 = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.reader.readUint8.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeUint8(v);\r\n\t}\r\n\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn parseInt(v);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\tif(typeof(v) != \"number\")\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tif(v < 0 || v > 0xff)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_UINT16 = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.reader.readUint16.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeUint16(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn parseInt(v);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\tif(typeof(v) != \"number\")\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tif(v < 0 || v > 0xffff)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_UINT32 = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.reader.readUint32.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeUint32(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn parseInt(v);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\tif(typeof(v) != \"number\")\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tif(v < 0 || v > 0xffffffff)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_UINT64 = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.reader.readUint64.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeUint64(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn parseInt(v);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\treturn v instanceof KBEngine.UINT64;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_INT8 = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.reader.readInt8.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeInt8(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn parseInt(v);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\tif(typeof(v) != \"number\")\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tif(v < -0x80 || v > 0x7f)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_INT16 = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.reader.readInt16.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeInt16(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn parseInt(v);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\tif(typeof(v) != \"number\")\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tif(v < -0x8000 || v > 0x7fff)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_INT32 = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.reader.readInt32.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeInt32(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn parseInt(v);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\tif(typeof(v) != \"number\")\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tif(v < -0x80000000 || v > 0x7fffffff)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_INT64 = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.reader.readInt64.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeInt64(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn parseInt(v);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\treturn v instanceof KBEngine.INT64;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_FLOAT = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.reader.readFloat.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeFloat(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn parseFloat(v);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\treturn typeof(v) == \"number\";\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_DOUBLE = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.reader.readDouble.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeDouble(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn parseFloat(v);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\treturn typeof(v) == \"number\";\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_STRING = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.reader.readString.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeString(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\tif(typeof(v) == \"string\")\r\n\t\t\treturn v;\r\n\t\t\r\n\t\treturn \"\";\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\treturn typeof(v) == \"string\";\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_VECTOR2 = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\tif(KBEngine.CLIENT_NO_FLOAT)\r\n\t\t{\r\n\t\t\tvar x = KBEngine.reader.readInt32.call(stream);\r\n\t\t\tvar y = KBEngine.reader.readInt32.call(stream);\r\n\t\t\treturn new KBEngine.Vector2(x, y);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar x = KBEngine.reader.readFloat.call(stream);\r\n\t\t\tvar y = KBEngine.reader.readFloat.call(stream);\r\n\t\t\treturn new KBEngine.Vector2(x, y);\r\n\t\t}\r\n\t\t\r\n\t\treturn undefined;\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tif(KBEngine.CLIENT_NO_FLOAT)\r\n\t\t{\r\n\t\t\tstream.writeInt32(v.x);\r\n\t\t\tstream.writeInt32(v.y);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstream.writeFloat(v.x);\r\n\t\t\tstream.writeFloat(v.y);\t\t\t\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn new KBEngine.Vector2(0.0, 0.0);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\tif(! v instanceof KBEngine.Vector2)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_VECTOR3 = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\tif(KBEngine.CLIENT_NO_FLOAT)\r\n\t\t{\r\n\t\t\tvar x = KBEngine.reader.readInt32.call(stream);\r\n\t\t\tvar y = KBEngine.reader.readInt32.call(stream);\r\n\t\t\tvar z = KBEngine.reader.readInt32.call(stream);\r\n\t\t\treturn new KBEngine.Vector3(x, y, z);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar x = KBEngine.reader.readFloat.call(stream);\r\n\t\t\tvar y = KBEngine.reader.readFloat.call(stream);\r\n\t\t\tvar z = KBEngine.reader.readFloat.call(stream);\r\n\t\t\treturn new KBEngine.Vector3(x, y, z);\r\n\t\t}\r\n\t\r\n\t\treturn undefined;\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tif(KBEngine.CLIENT_NO_FLOAT)\r\n\t\t{\r\n\t\t\tstream.writeInt32(v.x);\r\n\t\t\tstream.writeInt32(v.y);\r\n\t\t\tstream.writeInt32(v.z);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstream.writeFloat(v.x);\r\n\t\t\tstream.writeFloat(v.y);\r\n\t\t\tstream.writeFloat(v.z);\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn new KBEngine.Vector3(0.0, 0.0, 0.0);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\tif(! v instanceof KBEngine.Vector3)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_VECTOR4 = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\tif(KBEngine.CLIENT_NO_FLOAT)\r\n\t\t{\r\n\t\t\tvar x = KBEngine.reader.readInt32.call(stream);\r\n\t\t\tvar y = KBEngine.reader.readInt32.call(stream);\r\n\t\t\tvar z = KBEngine.reader.readInt32.call(stream);\r\n\t\t\tvar w = KBEngine.reader.readInt32.call(stream);\r\n\t\t\treturn new KBEngine.Vector4(x, y, z, w);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar x = KBEngine.reader.readFloat.call(stream);\r\n\t\t\tvar y = KBEngine.reader.readFloat.call(stream);\r\n\t\t\tvar z = KBEngine.reader.readFloat.call(stream);\r\n\t\t\tvar w = KBEngine.reader.readFloat.call(stream);\r\n\t\t\treturn new KBEngine.Vector4(x, y, z, w);\r\n\t\t}\r\n\t\t\r\n\t\treturn undefined;\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tif(KBEngine.CLIENT_NO_FLOAT)\r\n\t\t{\r\n\t\t\tstream.writeInt32(v.x);\r\n\t\t\tstream.writeInt32(v.y);\r\n\t\t\tstream.writeInt32(v.z);\r\n\t\t\tstream.writeInt32(v.w);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstream.writeFloat(v.x);\r\n\t\t\tstream.writeFloat(v.y);\t\t\r\n\t\t\tstream.writeFloat(v.z);\r\n\t\t\tstream.writeFloat(v.w);\t\t\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn new KBEngine.Vector4(0.0, 0.0, 0.0, 0.0);\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\tif(! v instanceof KBEngine.Vector4)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_PYTHON = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn stream.readBlob();\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeBlob(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn new Uint8Array();\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_UNICODE = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\treturn KBEngine.utf8ArrayToString(KBEngine.reader.readBlob.call(stream));\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeBlob(KBEngine.stringToUTF8Bytes(v));\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\tif(typeof(v) == \"string\")\r\n\t\t\treturn v;\r\n\t\t\r\n\t\treturn \"\";\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\treturn typeof(v) == \"string\";\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_ENTITYCALL = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\tvar cid = KBEngine.reader.readUint64.call(stream);\r\n\t\tvar id = KBEngine.reader.readInt32.call(stream);\r\n\t\tvar type = KBEngine.reader.readUint16.call(stream);\r\n\t\tvar utype = KBEngine.reader.readUint16.call(stream);\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tvar cid = new KBEngine.UINT64(0, 0);\r\n\t\tvar id = 0;\r\n\t\tvar type = 0;\r\n\t\tvar utype = 0;\r\n\r\n\t\tstream.writeUint64(cid);\r\n\t\tstream.writeInt32(id);\r\n\t\tstream.writeUint16(type);\r\n\t\tstream.writeUint16(utype);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn new Uint8Array();\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_BLOB = function()\r\n{\r\n\tthis.bind = function()\r\n\t{\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\tvar size = KBEngine.reader.readUint32.call(stream);\r\n\t\tvar buf = new Uint8Array(stream.buffer, stream.rpos, size);\r\n\t\tstream.rpos += size;\r\n\t\treturn buf;\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeBlob(v);\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn new Uint8Array();\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_ARRAY = function()\r\n{\r\n\tthis.type = null;\r\n\t\r\n\tthis.bind = function()\r\n\t{\r\n\t\tif(typeof(this.type) == \"number\")\r\n\t\t\tthis.type = KBEngine.datatypes[this.type];\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\tvar size = stream.readUint32();\r\n\t\tvar datas = [];\r\n\t\t\r\n\t\twhile(size > 0)\r\n\t\t{\r\n\t\t\tsize--;\r\n\t\t\tdatas.push(this.type.createFromStream(stream));\r\n\t\t};\r\n\t\t\r\n\t\treturn datas;\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tstream.writeUint32(v.length);\r\n\t\tfor(var i=0; i<v.length; i++)\r\n\t\t{\r\n\t\t\tthis.type.addToStream(stream, v[i]);\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn [];\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\tfor(var i=0; i<v.length; i++)\r\n\t\t{\r\n\t\t\tif(!this.type.isSameType(v[i]))\r\n\t\t\t{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.DATATYPE_FIXED_DICT = function()\r\n{\r\n\tthis.dicttype = {};\r\n\tthis.implementedBy = null;\r\n\t\r\n\tthis.bind = function()\r\n\t{\r\n\t\tfor(var itemkey in this.dicttype)\r\n\t\t{\r\n\t\t\tvar utype = this.dicttype[itemkey];\r\n\t\t\t\r\n\t\t\tif(typeof(this.dicttype[itemkey]) == \"number\")\r\n\t\t\t\tthis.dicttype[itemkey] = KBEngine.datatypes[utype];\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.createFromStream = function(stream)\r\n\t{\r\n\t\tvar datas = {};\r\n\t\tfor(var itemkey in this.dicttype)\r\n\t\t{\r\n\t\t\tdatas[itemkey] = this.dicttype[itemkey].createFromStream(stream);\r\n\t\t}\r\n\t\t\r\n\t\treturn datas;\r\n\t}\r\n\t\r\n\tthis.addToStream = function(stream, v)\r\n\t{\r\n\t\tfor(var itemkey in this.dicttype)\r\n\t\t{\r\n\t\t\tthis.dicttype[itemkey].addToStream(stream, v[itemkey]);\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.parseDefaultValStr = function(v)\r\n\t{\r\n\t\treturn {};\r\n\t}\r\n\t\r\n\tthis.isSameType = function(v)\r\n\t{\r\n\t\tfor(var itemkey in this.dicttype)\r\n\t\t{\r\n\t\t\tif(!this.dicttype[itemkey].isSameType(v[itemkey]))\r\n\t\t\t{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nKBEngine.datatypes[\"UINT8\"]\t\t= new KBEngine.DATATYPE_UINT8();\r\nKBEngine.datatypes[\"UINT16\"]\t= new KBEngine.DATATYPE_UINT16();\r\nKBEngine.datatypes[\"UINT32\"]\t= new KBEngine.DATATYPE_UINT32();\r\nKBEngine.datatypes[\"UINT64\"]\t= new KBEngine.DATATYPE_UINT64();\r\n\r\nKBEngine.datatypes[\"INT8\"]\t\t= new KBEngine.DATATYPE_INT8();\r\nKBEngine.datatypes[\"INT16\"]\t\t= new KBEngine.DATATYPE_INT16();\r\nKBEngine.datatypes[\"INT32\"]\t\t= new KBEngine.DATATYPE_INT32();\r\nKBEngine.datatypes[\"INT64\"]\t\t= new KBEngine.DATATYPE_INT64();\r\n\r\nKBEngine.datatypes[\"FLOAT\"]\t\t= new KBEngine.DATATYPE_FLOAT();\r\nKBEngine.datatypes[\"DOUBLE\"]\t= new KBEngine.DATATYPE_DOUBLE();\r\n\r\nKBEngine.datatypes[\"STRING\"]\t= new KBEngine.DATATYPE_STRING();\r\nKBEngine.datatypes[\"VECTOR2\"]\t= new KBEngine.DATATYPE_VECTOR2;\r\nKBEngine.datatypes[\"VECTOR3\"]\t= new KBEngine.DATATYPE_VECTOR3;\r\nKBEngine.datatypes[\"VECTOR4\"]\t= new KBEngine.DATATYPE_VECTOR4;\r\nKBEngine.datatypes[\"PYTHON\"]\t= new KBEngine.DATATYPE_PYTHON();\r\nKBEngine.datatypes[\"UNICODE\"]\t= new KBEngine.DATATYPE_UNICODE();\r\nKBEngine.datatypes[\"ENTITYCALL\"]= new KBEngine.DATATYPE_ENTITYCALL();\r\nKBEngine.datatypes[\"BLOB\"]\t\t= new KBEngine.DATATYPE_BLOB();\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tKBEngine args\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.KBEngineArgs = function()\r\n{\r\n\tthis.ip = \"127.0.0.1\";\r\n\tthis.port = 20013;\r\n\tthis.updateHZ = 100;\r\n\tthis.serverHeartbeatTick = 15;\r\n\r\n\t// Reference: http://kbengine.github.io/docs/programming/clientsdkprogramming.html, client types\r\n\tthis.clientType = 5;\r\n\r\n\t// 在Entity初始化时是否触发属性的set_*事件(callPropertysSetMethods)\r\n\tthis.isOnInitCallPropertysSetMethods = true;\r\n\r\n\t// 是否用wss, 默认使用ws\r\n\tthis.isWss = false;\r\n}\r\n\r\n/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tKBEngine app\r\n-----------------------------------------------------------------------------------------*/\r\nKBEngine.EventTypes =\r\n{\r\n\t// Create new account.\r\n\t// <para> param1(string): accountName</para>\r\n\t// <para> param2(string): password</para>\r\n\t// <para> param3(bytes): datas // Datas by user defined. Data will be recorded into the KBE account database, you can access the datas through the script layer. If you use third-party account system, datas will be submitted to the third-party system.</para>\r\n\tcreateAccount : \"createAccount\",\r\n\r\n\t// Login to server.\r\n\t// <para> param1(string): accountName</para>\r\n\t// <para> param2(string): password</para>\r\n\t// <para> param3(bytes): datas // Datas by user defined. Data will be recorded into the KBE account database, you can access the datas through the script layer. If you use third-party account system, datas will be submitted to the third-party system.</para>\r\n\tlogin : \"login\",\r\n\r\n\t// Logout to baseapp, called when exiting the client.\t\r\n\tlogout : \"logout\",\r\n\r\n\t// Relogin to baseapp.\r\n\treloginBaseapp : \"reloginBaseapp\",\r\n\r\n\t// Request server binding account Email.\r\n\t// <para> param1(string): emailAddress</para>\r\n\tbindAccountEmail : \"bindAccountEmail\",\r\n\r\n\t// Request to set up a new password for the account. Note: account must be online.\r\n\t// <para> param1(string): old_password</para>\r\n\t// <para> param2(string): new_password</para>\r\n\tnewPassword : \"newPassword\",\r\n\r\n\t// ------------------------------------连接相关------------------------------------\r\n\r\n\t// Kicked of the current server.\r\n\t// <para> param1(uint16): retcode. // server_errors</para>\r\n\tonKicked : \"onKicked\",\r\n\r\n\t// Disconnected from the server.\r\n\tonDisconnected : \"onDisconnected\",\r\n\r\n\t// Status of connection server.\r\n\t// <para> param1(bool): success or fail</para>\r\n\tonConnectionState : \"onConnectionState\",\r\n\tonConnectionState2 : \"onConnectionState2\",\r\n\r\n\t// ------------------------------------logon相关------------------------------------\r\n\r\n\t// Create account feedback results.\r\n\t// <para> param1(uint16): retcode. // server_errors</para>\r\n\t// <para> param2(bytes): datas. // If you use third-party account system, the system may fill some of the third-party additional datas. </para>\r\n\tonCreateAccountResult : \"onCreateAccountResult\",\r\n\r\n\t// Engine version mismatch.\r\n\t// <para> param1(string): clientVersion\r\n\t// <para> param2(string): serverVersion\r\n\tonVersionNotMatch : \"onVersionNotMatch\",\r\n\r\n\t// script version mismatch.\r\n    // <para> param1(string): clientScriptVersion\r\n    // <para> param2(string): serverScriptVersion\r\n\tonScriptVersionNotMatch : \"onScriptVersionNotMatch\",\r\n\r\n\t// Login failed.\r\n    // <para> param1(uint16): retcode. // server_errors</para>\r\n\tonLoginFailed : \"onLoginFailed\",\r\n\r\n\t// Login to baseapp.\r\n\tonLoginBaseapp : \"onLoginBaseapp\",\r\n\r\n\t// Login baseapp failed.\r\n    // <para> param1(uint16): retcode. // server_errors</para>\r\n\tonLoginBaseappFailed : \"onLoginBaseappFailed\",\r\n\r\n\t// Relogin to baseapp.\r\n\tonReloginBaseapp : \"onReloginBaseapp\",\r\n\r\n\t// Relogin baseapp success.\r\n\tonReloginBaseappSuccessfully : \"onReloginBaseappSuccessfully\",\r\n\r\n\t// Relogin baseapp failed.\r\n    // <para> param1(uint16): retcode. // server_errors</para>\r\n\tonReloginBaseappFailed : \"onReloginBaseappFailed\",\r\n\r\n\t// ------------------------------------实体cell相关事件------------------------------------\r\n\r\n\t// Entity enter the client-world.\r\n    // <para> param1: Entity</para>\r\n\tonEnterWorld : \"onEnterWorld\",\r\n\r\n\t// Entity leave the client-world.\r\n    // <para> param1: Entity</para>\r\n\tonLeaveWorld : \"onLeaveWorld\",\r\n\r\n\t// Player enter the new space.\r\n    // <para> param1: Entity</para>\r\n\tonEnterSpace : \"onEnterSpace\",\r\n\r\n\t// Player leave the space.\r\n    // <para> param1: Entity</para>\r\n\tonLeaveSpace : \"onLeaveSpace\",\r\n\r\n\t// Sets the current position of the entity.\r\n\t// <para> param1: Entity</para>\r\n\tset_position : \"set_position\",\r\n\r\n\t// Sets the current direction of the entity.\r\n\t// <para> param1: Entity</para>\r\n\tset_direction : \"set_direction\",\r\n\r\n\t// The entity position is updated, you can smooth the moving entity to new location.\r\n\t// <para> param1: Entity</para>\r\n\tupdatePosition : \"updatePosition\",\r\n\r\n\t// The current space is specified by the geometry mapping.\r\n\t// Popular said is to load the specified Map Resources.\r\n\t// <para> param1(string): resPath</para>\r\n\taddSpaceGeometryMapping : \"addSpaceGeometryMapping\",\r\n\r\n\t// Server spaceData set data.\r\n\t// <para> param1(int32): spaceID</para>\r\n\t// <para> param2(string): key</para>\r\n\t// <para> param3(string): value</para>\r\n\tonSetSpaceData : \"onSetSpaceData\",\r\n\r\n\t// Start downloading data.\r\n\t// <para> param1(int32): rspaceID</para>\r\n\t// <para> param2(string): key</para>\r\n\tonDelSpaceData : \"onDelSpaceData\",\r\n\r\n\t// Triggered when the entity is controlled or out of control.\r\n\t// <para> param1: Entity</para>\r\n\t// <para> param2(bool): isControlled</para>\r\n\tonControlled : \"onControlled\",\r\n\r\n\t// Lose controlled entity.\r\n\t// <para> param1: Entity</para>\r\n\tonLoseControlledEntity : \"onLoseControlledEntity\",\r\n\r\n\t// ------------------------------------数据下载相关------------------------------------\r\n\r\n\t// Start downloading data.\r\n\t// <para> param1(uint16): resouce id</para>\r\n\t// <para> param2(uint32): data size</para>\r\n\t// <para> param3(string): description</para>\r\n\tonStreamDataStarted : \"onStreamDataStarted\",\r\n\r\n\t// Receive data.\r\n\t// <para> param1(uint16): resouce id</para>\r\n\t// <para> param2(bytes): datas</para>\r\n\tonStreamDataRecv : \"onStreamDataRecv\",\r\n\r\n\t// The downloaded data is completed.\r\n\t// <para> param1(uint16): resouce id</para>\r\n\tonStreamDataCompleted : \"onStreamDataCompleted\",\r\n}\r\n\r\nKBEngine.KBEngineApp = function(kbengineArgs)\r\n{\r\n\tconsole.assert(KBEngine.app == null || KBEngine.app == undefined, \"Assertion of KBEngine.app not is null\");\r\n\t\r\n\tKBEngine.app = this;\r\n\t\r\n\tthis.args = kbengineArgs;\r\n\t\r\n\tthis.username = \"testhtml51\";\r\n\tthis.password = \"123456\";\r\n\tthis.clientdatas = \"\";\r\n\tthis.encryptedKey = \"\";\r\n\t\r\n\tthis.loginappMessageImported = false;\r\n\tthis.baseappMessageImported = false;\r\n\tthis.serverErrorsDescrImported = false;\r\n\tthis.entitydefImported = false;\r\n\t\r\n\tKBEngine.getSingleton = function()\r\n\t{\r\n\t\tconsole.assert(KBEngine.app != undefined, \"KBEngineApp is null\");\r\n\t\treturn KBEngine.app;\r\n\t}\r\n\r\n\t// 描述服务端返回的错误信息\r\n\tKBEngine.ServerErr = function()\r\n\t{\r\n\t\tthis.name = \"\";\r\n\t\tthis.descr = \"\";\r\n\t\tthis.id = 0;\r\n\t}\r\n\r\n\tthis.serverErrs = {};\r\n\t\t\r\n\t// 登录loginapp的地址\r\n\tthis.ip = this.args.ip;\r\n\tthis.port = this.args.port;\r\n\tthis.isWss = this.args.isWss;\r\n\tthis.protocol = this.isWss ? \"wss://\" : \"ws://\";\r\n\t\r\n\t// 服务端分配的baseapp地址\r\n\tthis.baseappIP = \"\";\r\n\tthis.baseappPort = 0;\r\n\r\n\tthis.currMsgID = 0;\r\n\tthis.currMsgCount = 0;\r\n\tthis.currMsgLen = 0;\r\n\t\r\n\tKBEngine.FragmentDataTypes = \r\n\t{\r\n\t\tFRAGMENT_DATA_UNKNOW : 0,\r\n\t\tFRAGMENT_DATA_MESSAGE_ID : 1,\r\n\t\tFRAGMENT_DATA_MESSAGE_LENGTH : 2,\r\n\t\tFRAGMENT_DATA_MESSAGE_LENGTH1 : 3,\r\n\t\tFRAGMENT_DATA_MESSAGE_BODY : 4\r\n\t};\r\n\r\n\tthis.fragmentStream = null;\r\n\tthis.fragmentDatasFlag = KBEngine.FragmentDataTypes.FRAGMENT_DATA_UNKNOW;\r\n\tthis.fragmentDatasRemain = 0;\r\n\r\n\tthis.resetSocket = function()\r\n\t{\r\n\t\ttry\r\n\t\t{  \r\n\t\t\tif(KBEngine.app.socket != undefined && KBEngine.app.socket != null)\r\n\t\t\t{\r\n\t\t\t\tvar sock = KBEngine.app.socket;\r\n\t\t\t\t\r\n\t\t\t\tsock.onopen = undefined;\r\n\t\t\t\tsock.onerror = undefined;\r\n\t\t\t\tsock.onmessage = undefined;\r\n\t\t\t\tsock.onclose = undefined;\r\n\t\t\t\tKBEngine.app.socket = null;\r\n\t\t\t\tsock.close();\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{ \r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.reset = function()\r\n\t{\r\n\t\tif(KBEngine.app.entities != undefined && KBEngine.app.entities != null)\r\n\t\t{\r\n\t\t\tKBEngine.app.clearEntities(true);\r\n\t\t}\r\n\t\t\r\n\t\tKBEngine.app.resetSocket();\r\n\t\t\r\n\t\tKBEngine.app.currserver = \"loginapp\";\r\n\t\tKBEngine.app.currstate = \"create\";\r\n\t\tKBEngine.app.currconnect = \"loginapp\";\r\n\r\n\t\t// 扩展数据\r\n\t\tKBEngine.app.serverdatas = \"\";\r\n\t\t\r\n\t\t// 版本信息\r\n\t\tKBEngine.app.serverVersion = \"\";\r\n\t\tKBEngine.app.serverScriptVersion = \"\";\r\n\t\tKBEngine.app.serverProtocolMD5 = \"\";\r\n\t\tKBEngine.app.serverEntityDefMD5 = \"\";\r\n\t\tKBEngine.app.clientVersion = \"1.2.7\";\r\n\t\t//KBEngine.app.clientVersion = \"1.2.10\";\r\n\t\tKBEngine.app.clientScriptVersion = \"0.1.0\";\r\n\t\t\r\n\t\t// player的相关信息\r\n\t\tKBEngine.app.entity_uuid = null;\r\n\t\tKBEngine.app.entity_id = 0;\r\n\t\tKBEngine.app.entity_type = \"\";\r\n\r\n\t\t// 这个参数的选择必须与kbengine_defs.xml::cellapp/aliasEntityID的参数保持一致\r\n\t\tKBEngine.app.useAliasEntityID = true;\r\n\r\n\t\t// 当前玩家最后一次同步到服务端的位置与朝向与服务端最后一次同步过来的位置\r\n\t\tKBEngine.app.entityServerPos = new KBEngine.Vector3(0.0, 0.0, 0.0);\r\n\t\t\r\n\t\t// 客户端所有的实体\r\n\t\tKBEngine.app.entities = {};\r\n\t\tKBEngine.app.entityIDAliasIDList = [];\r\n\t\tKBEngine.app.controlledEntities = [];\r\n\r\n\t\t// 空间的信息\r\n\t\tKBEngine.app.spacedata = {};\r\n\t\tKBEngine.app.spaceID = 0;\r\n\t\tKBEngine.app.spaceResPath = \"\";\r\n\t\tKBEngine.app.isLoadedGeometry = false;\r\n\t\t\r\n\t\tvar dateObject = new Date();\r\n\t\tKBEngine.app.lastTickTime = dateObject.getTime();\r\n\t\tKBEngine.app.lastTickCBTime = dateObject.getTime();\r\n\t\t\r\n\t\tKBEngine.mappingDataType();\r\n\t\t\r\n\t\t// 当前组件类别， 配套服务端体系\r\n\t\tKBEngine.app.component = \"client\";\r\n\t}\r\n\r\n\tthis.installEvents = function()\r\n\t{\r\n\t\tKBEngine.Event.register(KBEngine.EventTypes.createAccount, KBEngine.app, \"createAccount\");\r\n\t\tKBEngine.Event.register(KBEngine.EventTypes.login, KBEngine.app, \"login\");\r\n\t\tKBEngine.Event.register(KBEngine.EventTypes.logout, KBEngine.app, \"logout\");\r\n\t\tKBEngine.Event.register(KBEngine.EventTypes.reloginBaseapp, KBEngine.app, \"reloginBaseapp\");\r\n\t\tKBEngine.Event.register(KBEngine.EventTypes.bindAccountEmail, KBEngine.app, \"bindAccountEmail\");\r\n\t\tKBEngine.Event.register(KBEngine.EventTypes.newPassword, KBEngine.app, \"newPassword\");\r\n\t}\r\n\r\n\tthis.uninstallEvents = function()\r\n\t{\r\n\t\tKBEngine.Event.deregister(KBEngine.EventTypes.createAccount, KBEngine.app);\r\n\t\tKBEngine.Event.deregister(KBEngine.EventTypes.login, KBEngine.app);\r\n\t\tKBEngine.Event.deregister(KBEngine.EventTypes.logout, KBEngine.app);\r\n\t\tKBEngine.Event.deregister(KBEngine.EventTypes.reloginBaseapp, KBEngine.app);\r\n\t\tKBEngine.Event.deregister(KBEngine.EventTypes.bindAccountEmail, KBEngine.app);\r\n\t\tKBEngine.Event.deregister(KBEngine.EventTypes.newPassword, KBEngine.app);\r\n\t}\r\n\t\r\n\tthis.hello = function()\r\n\t{  \r\n\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\r\n\t\tif(KBEngine.app.currserver == \"loginapp\")\r\n\t\t\tbundle.newMessage(KBEngine.messages.Loginapp_hello);\r\n\t\telse\r\n\t\t\tbundle.newMessage(KBEngine.messages.Baseapp_hello);\r\n\t\t\r\n\t\tbundle.writeString(KBEngine.app.clientVersion);\r\n\t\tbundle.writeString(KBEngine.app.clientScriptVersion);\r\n\t\tbundle.writeBlob(KBEngine.app.encryptedKey);\r\n\t\tbundle.send(KBEngine.app);\r\n\t}\r\n\r\n\tthis.player = function()\r\n\t{\r\n\t\treturn KBEngine.app.entities[KBEngine.app.entity_id];\r\n\t}\r\n\r\n\tthis.findEntity = function(entityID)\r\n\t{\r\n\t\treturn KBEngine.app.entities[entityID];\r\n\t}\r\n\t\t\r\n\tthis.connect = function(addr)\r\n\t{\r\n\t\tconsole.assert(KBEngine.app.socket == null, \"Assertion of socket not is null\");\r\n\t\t\r\n\t\ttry\r\n\t\t{  \r\n\t\t\tKBEngine.app.socket = new WebSocket(addr);  \r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{  \r\n\t\t\tKBEngine.ERROR_MSG('WebSocket init error(' + e.toString() + ')!'); \r\n\t\t\tKBEngine.Event.fire(KBEngine.EventTypes.onConnectionState2, false);\r\n\t\t\treturn;  \r\n\t\t}\r\n\t\t\r\n\t\tKBEngine.app.socket.binaryType = \"arraybuffer\";\r\n\t\tKBEngine.app.socket.onopen = KBEngine.app.onopen;  \r\n\t\tKBEngine.app.socket.onerror = KBEngine.app.onerror_before_onopen;  \r\n\t\tKBEngine.app.socket.onmessage = KBEngine.app.onmessage;  \r\n\t\tKBEngine.app.socket.onclose = KBEngine.app.onclose;\r\n\t}\r\n\r\n\tthis.disconnect = function()\r\n\t{\r\n\t\tKBEngine.app.resetSocket();\r\n\t}\r\n\t\r\n\tthis.onopen = function()\r\n\t{  \r\n\t\tKBEngine.INFO_MSG('connect success!');\r\n\t\tKBEngine.app.socket.onerror = KBEngine.app.onerror_after_onopen;\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onConnectionState, true);\r\n\t}\r\n\r\n\tthis.onerror_before_onopen = function(evt)\r\n\t{  \r\n\t\tKBEngine.ERROR_MSG('onerror_before_onopen error:' + evt.data);\r\n\t\tKBEngine.app.resetSocket();\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onConnectionState, false);\r\n\t}\r\n\t\r\n\tthis.onerror_after_onopen = function(evt)\r\n\t{\r\n\t\tKBEngine.ERROR_MSG('onerror_after_onopen error:' + evt.data);\r\n\t\tKBEngine.app.resetSocket();\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onDisconnected);\r\n\t}\r\n\t\r\n\tthis.onmessage = function(msg)\r\n\t{ \r\n\t\tvar stream = new KBEngine.MemoryStream(msg.data);\r\n\t\tstream.wpos = msg.data.byteLength;\r\n\t\tvar app =  KBEngine.app;\r\n\t\tvar FragmentDataTypes = KBEngine.FragmentDataTypes;\r\n\r\n\t\twhile(stream.length() > 0 || app.fragmentStream != null)\r\n\t\t{\r\n\t\t\tif(app.fragmentDatasFlag == FragmentDataTypes.FRAGMENT_DATA_UNKNOW)\r\n\t\t\t{\r\n\t\t\t\tif(app.currMsgID == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(KBEngine.MESSAGE_ID_LENGTH > 1 && stream.length() < KBEngine.MESSAGE_ID_LENGTH)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tapp.writeFragmentMessage(FragmentDataTypes.FRAGMENT_DATA_MESSAGE_ID, stream, KBEngine.MESSAGE_ID_LENGTH);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tapp.currMsgID = stream.readUint16();\r\n\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\tvar msgHandler = KBEngine.clientmessages[app.currMsgID];\r\n\t\t\t\t\r\n\t\t\t\tif(!msgHandler)\r\n\t\t\t\t{\r\n\t\t\t\t\tapp.currMsgID = 0;\r\n\t\t\t\t\tapp.currMsgLen = 0;\r\n\t\t\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::onmessage[\" + app.currserver + \"]: not found msg(\" + app.currMsgID + \")!\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(app.currMsgLen == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar msglen = msgHandler.length;\r\n\t\t\t\t\tif(msglen == -1)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(stream.length() < KBEngine.MESSAGE_LENGTH_LENGTH)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tapp.writeFragmentMessage(FragmentDataTypes.FRAGMENT_DATA_MESSAGE_LENGTH, stream, KBEngine.MESSAGE_LENGTH_LENGTH);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tmsglen = stream.readUint16();\r\n\t\t\t\t\t\t\tapp.currMsgLen = msglen;\r\n\r\n\t\t\t\t\t\t\t// 扩展长度\r\n\t\t\t\t\t\t\tif(msglen == KBEngine.MESSAGE_MAX_SIZE)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif(stream.length() < KBEngine.MESSAGE_LENGTH1_LENGTH)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tapp.writeFragmentMessage(FragmentDataTypes.FRAGMENT_DATA_MESSAGE_LENGTH1, stream, KBEngine.MESSAGE_LENGTH1_LENGTH);\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tapp.currMsgLen = stream.readUint32();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tapp.currMsgLen = msglen;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(app.fragmentStream != null && app.fragmentStream.length() >= app.currMsgLen)\r\n\t\t\t\t{\r\n\t\t\t\t\tmsgHandler.handleMessage(app.fragmentStream);\r\n\t\t\t\t\tapp.fragmentStream = null;\r\n\t\t\t\t}\r\n\t\t\t\telse if(stream.length() < app.currMsgLen && stream.length() > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tapp.writeFragmentMessage(FragmentDataTypes.FRAGMENT_DATA_MESSAGE_BODY, stream, app.currMsgLen);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tvar wpos = stream.wpos;\r\n\t\t\t\t\tvar rpos = stream.rpos + msglen;\r\n\t\t\t\t\tstream.wpos = rpos;\r\n\t\t\t\t\tmsgHandler.handleMessage(stream);\r\n\t\t\t\t\tstream.wpos = wpos;\r\n\t\t\t\t\tstream.rpos = rpos;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.currMsgID = 0;\r\n\t\t\t\tapp.currMsgLen = 0;\r\n\t\t\t\tapp.fragmentStream = null;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif(app.mergeFragmentMessage(stream))\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}  \r\n\r\n\tthis.writeFragmentMessage = function(FragmentDataType, stream, datasize)\r\n\t{\r\n\t\tif(!(stream instanceof KBEngine.MemoryStream))\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"writeFragmentMessage(): stream must be MemoryStream instances!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar app = KBEngine.app;\r\n\t\tvar opsize = stream.length();\r\n\t\t\r\n\t\tapp.fragmentDatasRemain = datasize - opsize;\r\n\t\tapp.fragmentDatasFlag = FragmentDataType;\r\n\t\tapp.fragmentStream = stream;\r\n\t}\r\n\r\n\tthis.mergeFragmentMessage = function(stream)\r\n\t{\r\n\t\tif(!(stream instanceof KBEngine.MemoryStream))\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"mergeFragmentMessage(): stream must be MemoryStream instances!\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar opsize = stream.length();\r\n\t\tif(opsize == 0)\r\n\t\t\treturn false;\r\n\r\n\t\tvar app = KBEngine.app;\r\n\t\tvar fragmentStream = app.fragmentStream;\r\n\t\tconsole.assert(fragmentStream != null);\r\n\r\n\t\tif(opsize >= app.fragmentDatasRemain)\r\n\t\t{\r\n\t\t\tvar FragmentDataTypes = KBEngine.FragmentDataTypes;\r\n\t\t\tfragmentStream.append(stream, stream.rpos, app.fragmentDatasRemain);\r\n\r\n\t\t\tswitch(app.fragmentDatasFlag)\r\n\t\t\t{\r\n\t\t\t\tcase FragmentDataTypes.FRAGMENT_DATA_MESSAGE_ID:\r\n\t\t\t\t\tapp.currMsgID = fragmentStream.readUint16();\r\n\t\t\t\t\tapp.fragmentStream = null;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase FragmentDataTypes.FRAGMENT_DATA_MESSAGE_LENGTH:\r\n\t\t\t\t\tapp.currMsgLen = fragmentStream.readUint16();\r\n\t\t\t\t\tapp.fragmentStream = null;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase FragmentDataTypes.FRAGMENT_DATA_MESSAGE_LENGTH1:\r\n\t\t\t\t\tapp.currMsgLen = fragmentStream.readUint32();\r\n\t\t\t\t\tapp.fragmentStream = null;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase FragmentDataTypes.FRAGMENT_DATA_MESSAGE_BODY:\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tstream.rpos += app.fragmentDatasRemain;\r\n\t\t\tapp.fragmentDatasFlag = FragmentDataTypes.FRAGMENT_DATA_UNKNOW;\r\n\t\t\tapp.fragmentDatasRemain = 0;\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfragmentStream.append(stream, stream.rpos, opsize);\r\n\t\t\tapp.fragmentDatasRemain -= opsize;\r\n\t\t\tstream.done();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.onclose = function()\r\n\t{  \r\n\t\tKBEngine.INFO_MSG('connect close:' + KBEngine.app.currserver);\r\n\r\n\t\tif(KBEngine.app.currconnect != KBEngine.app.currserver)\r\n\t\t\treturn;\r\n\r\n\t\tKBEngine.app.resetSocket();\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onDisconnected);\r\n\t\t//if(KBEngine.app.currserver != \"loginapp\")\r\n\t\t//\tKBEngine.app.reset();\r\n\t}\r\n\r\n\tthis.send = function(msg)\r\n\t{\r\n\t\tKBEngine.app.socket.send(msg);\r\n\t}\r\n\r\n\tthis.close = function() {\r\n\t\tKBEngine.INFO_MSG('KBEngine::close()');\r\n\t\tKBEngine.app.socket.close();  \r\n\t\tKBEngine.app.reset();\r\n\t}\r\n\t\r\n\tthis.update = function()\r\n\t{\r\n\t\tif(KBEngine.app.socket == null)\r\n\t\t\treturn;\r\n\r\n\t\tvar dateObject = new Date();\r\n\t\tif((dateObject.getTime() - KBEngine.app.lastTickTime) / 1000 > (KBEngine.app.args.serverHeartbeatTick / 2))\r\n\t\t{\r\n\t\t\t// 如果心跳回调接收时间小于心跳发送时间，说明没有收到回调\r\n\t\t\t// 此时应该通知客户端掉线了\r\n\t\t\tif(KBEngine.app.lastTickCBTime < KBEngine.app.lastTickTime)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.ERROR_MSG(\"sendTick: Receive appTick timeout!\");\r\n\t\t\t\tKBEngine.app.socket.close(); \r\n\t\t\t\treturn; \r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(KBEngine.app.currserver == \"loginapp\")\r\n\t\t\t{\r\n\t\t\t\tif(KBEngine.messages.Loginapp_onClientActiveTick != undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\t\t\tbundle.newMessage(KBEngine.messages.Loginapp_onClientActiveTick);\r\n\t\t\t\t\tbundle.send(KBEngine.app);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif(KBEngine.messages.Baseapp_onClientActiveTick != undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\t\t\tbundle.newMessage(KBEngine.messages.Baseapp_onClientActiveTick);\r\n\t\t\t\t\tbundle.send(KBEngine.app);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tKBEngine.app.lastTickTime = dateObject.getTime();\r\n\t\t}\r\n\t\t\r\n\t\tKBEngine.app.updatePlayerToServer();\r\n\t}\r\n\r\n\t/*\r\n\t\t服务器心跳回调\r\n\t*/\r\n\tthis.Client_onAppActiveTickCB = function()\r\n\t{\r\n\t\tvar dateObject = new Date();\r\n\t\tKBEngine.app.lastTickCBTime = dateObject.getTime();\r\n\t}\r\n\r\n\t/*\r\n\t\t通过错误id得到错误描述\r\n\t*/\r\n\tthis.serverErr = function(id)\r\n\t{\r\n\t\tvar e = KBEngine.app.serverErrs[id];\r\n\t\t\r\n\t\tif(e == undefined)\r\n\t\t{\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\r\n\t\treturn e.name + \" [\" + e.descr + \"]\";\r\n\t}\r\n\r\n\t/*\r\n\t\t服务端错误描述导入了\r\n\t*/\r\n\tthis.Client_onImportServerErrorsDescr = function(stream)\r\n\t{\r\n\t\tvar size = stream.readUint16();\r\n\t\twhile(size > 0)\r\n\t\t{\r\n\t\t\tsize -= 1;\r\n\t\t\t\r\n\t\t\tvar e = new KBEngine.ServerErr();\r\n\t\t\te.id = stream.readUint16();\r\n\t\t\te.name = KBEngine.utf8ArrayToString(stream.readBlob());\r\n\t\t\te.descr = KBEngine.utf8ArrayToString(stream.readBlob());\r\n\t\t\t\r\n\t\t\tKBEngine.app.serverErrs[e.id] = e;\r\n\t\t\t\t\r\n\t\t\tKBEngine.INFO_MSG(\"Client_onImportServerErrorsDescr: id=\" + e.id + \", name=\" + e.name + \", descr=\" + e.descr);\r\n\t\t}\r\n\t}\r\n\t\t\r\n\tthis.onOpenLoginapp_login = function()\r\n\t{  \r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::onOpenLoginapp_login: successfully!\");\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onConnectionState, true);\r\n\t\t\r\n\t\tKBEngine.app.currserver = \"loginapp\";\r\n\t\tKBEngine.app.currstate = \"login\";\r\n\t\t\r\n\t\tif(!KBEngine.app.loginappMessageImported)\r\n\t\t{\r\n\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\tbundle.newMessage(KBEngine.messages.Loginapp_importClientMessages);\r\n\t\t\tbundle.send(KBEngine.app);\r\n\t\t\tKBEngine.app.socket.onmessage = KBEngine.app.Client_onImportClientMessages;  \r\n\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::onOpenLoginapp_login: start importClientMessages ...\");\r\n\t\t\tKBEngine.Event.fire(\"Loginapp_importClientMessages\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tKBEngine.app.onImportClientMessagesCompleted();\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.onOpenLoginapp_createAccount = function()\r\n\t{  \r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onConnectionState, true);\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::onOpenLoginapp_createAccount: successfully!\");\r\n\t\tKBEngine.app.currserver = \"loginapp\";\r\n\t\tKBEngine.app.currstate = \"createAccount\";\r\n\t\t\r\n\t\tif(!KBEngine.app.loginappMessageImported)\r\n\t\t{\r\n\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\tbundle.newMessage(KBEngine.messages.Loginapp_importClientMessages);\r\n\t\t\tbundle.send(KBEngine.app);\r\n\t\t\tKBEngine.app.socket.onmessage = KBEngine.app.Client_onImportClientMessages;  \r\n\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::onOpenLoginapp_createAccount: start importClientMessages ...\");\r\n\t\t\tKBEngine.Event.fire(\"Loginapp_importClientMessages\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tKBEngine.app.onImportClientMessagesCompleted();\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.onImportClientMessagesCompleted = function()\r\n\t{\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::onImportClientMessagesCompleted: successfully!\");\r\n\t\tKBEngine.app.socket.onmessage = KBEngine.app.onmessage; \r\n\t\tKBEngine.app.hello();\r\n\t\t\r\n\t\tif(KBEngine.app.currserver == \"loginapp\")\r\n\t\t{\r\n\t\t\tif(!KBEngine.app.serverErrorsDescrImported)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.INFO_MSG(\"KBEngine::onImportClientMessagesCompleted(): send importServerErrorsDescr!\");\r\n\t\t\t\tKBEngine.app.serverErrorsDescrImported = true;\r\n\t\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\t\tbundle.newMessage(KBEngine.messages.Loginapp_importServerErrorsDescr);\r\n\t\t\t\tbundle.send(KBEngine.app);\r\n\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\tif(KBEngine.app.currstate == \"login\")\r\n\t\t\t\tKBEngine.app.login_loginapp(false);\r\n\t\t\telse if(KBEngine.app.currstate == \"resetpassword\")\r\n\t\t\t\tKBEngine.app.resetpassword_loginapp(false);\r\n\t\t\telse\r\n\t\t\t\tKBEngine.app.createAccount_loginapp(false);\r\n\t\t\t\r\n\t\t\tKBEngine.app.loginappMessageImported = true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tKBEngine.app.baseappMessageImported = true;\r\n\t\t\t\r\n\t\t\tif(!KBEngine.app.entitydefImported)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::onImportClientMessagesCompleted: start importEntityDef ...\");\r\n\t\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\t\tbundle.newMessage(KBEngine.messages.Baseapp_importClientEntityDef);\r\n\t\t\t\tbundle.send(KBEngine.app);\r\n\t\t\t\tKBEngine.Event.fire(\"Baseapp_importClientEntityDef\");\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tKBEngine.app.onImportEntityDefCompleted();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis.createDataTypeFromStreams = function(stream, canprint)\r\n\t{\r\n\t\tvar aliassize = stream.readUint16();\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::createDataTypeFromStreams: importAlias(size=\" + aliassize + \")!\");\r\n\t\t\r\n\t\twhile(aliassize > 0)\r\n\t\t{\r\n\t\t\taliassize--;\r\n\t\t\tKBEngine.app.createDataTypeFromStream(stream, canprint);\r\n\t\t};\t\r\n\t\t\r\n\t\tfor(var datatype in KBEngine.datatypes)\r\n\t\t{\r\n\t\t\tif(KBEngine.datatypes[datatype] != undefined)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.datatypes[datatype].bind();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis.createDataTypeFromStream = function(stream, canprint)\r\n\t{\r\n\t\tvar utype = stream.readUint16();\r\n\t\tvar name = stream.readString();\r\n\t\tvar valname = stream.readString();\r\n\t\t\r\n\t\t/* 有一些匿名类型，我们需要提供一个唯一名称放到datatypes中\r\n\t\t\t如：\r\n\t\t\t<onRemoveAvatar>\r\n\t\t\t\t<Arg>\tARRAY <of> INT8 </of>\t\t</Arg>\r\n\t\t\t</onRemoveAvatar>\t\t\t\t\r\n\t\t*/\r\n\t\tif(valname.length == 0)\r\n\t\t\tvalname = \"Null_\" + utype;\r\n\t\t\t\r\n\t\tif(canprint)\r\n\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onImportClientEntityDef: importAlias(\" + name + \":\" + valname + \")!\");\r\n\t\t\r\n\t\tif(name == \"FIXED_DICT\")\r\n\t\t{\r\n\t\t\tvar datatype = new KBEngine.DATATYPE_FIXED_DICT();\r\n\t\t\tvar keysize = stream.readUint8();\r\n\t\t\tdatatype.implementedBy = stream.readString();\r\n\t\t\t\t\r\n\t\t\twhile(keysize > 0)\r\n\t\t\t{\r\n\t\t\t\tkeysize--;\r\n\t\t\t\t\r\n\t\t\t\tvar keyname = stream.readString();\r\n\t\t\t\tvar keyutype = stream.readUint16();\r\n\t\t\t\tdatatype.dicttype[keyname] = keyutype;\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tKBEngine.datatypes[valname] = datatype;\r\n\t\t}\r\n\t\telse if(name == \"ARRAY\")\r\n\t\t{\r\n\t\t\tvar uitemtype = stream.readUint16();\r\n\t\t\tvar datatype = new KBEngine.DATATYPE_ARRAY();\r\n\t\t\tdatatype.type = uitemtype;\r\n\t\t\tKBEngine.datatypes[valname] = datatype;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tKBEngine.datatypes[valname] = KBEngine.datatypes[name];\r\n\t\t}\r\n\r\n\t\tKBEngine.datatypes[utype] = KBEngine.datatypes[valname];\r\n\t\t\r\n\t\t// 将用户自定义的类型补充到映射表中\r\n\t\tKBEngine.datatype2id[valname] = utype;\r\n\t}\r\n\t\r\n\tthis.Client_onImportClientEntityDef = function(stream)\r\n\t{\r\n\t\tKBEngine.app.createDataTypeFromStreams(stream, true);\r\n\t\t\r\n\t\twhile(stream.length() > 0)\r\n\t\t{\r\n\t\t\tvar scriptmodule_name = stream.readString();\r\n\t\t\tvar scriptUtype = stream.readUint16();\r\n\t\t\tvar propertysize = stream.readUint16();\r\n\t\t\tvar methodsize = stream.readUint16();\r\n\t\t\tvar base_methodsize = stream.readUint16();\r\n\t\t\tvar cell_methodsize = stream.readUint16();\r\n\t\t\t\r\n\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onImportClientEntityDef: import(\" + scriptmodule_name + \"), propertys(\" + propertysize + \"), \" +\r\n\t\t\t\t\t\"clientMethods(\" + methodsize + \"), baseMethods(\" + base_methodsize + \"), cellMethods(\" + cell_methodsize + \")!\");\r\n\t\t\t\r\n\t\t\tKBEngine.moduledefs[scriptmodule_name] = {};\r\n\t\t\tvar currModuleDefs = KBEngine.moduledefs[scriptmodule_name];\r\n\t\t\tcurrModuleDefs[\"name\"] = scriptmodule_name;\r\n\t\t\tcurrModuleDefs[\"propertys\"] = {};\r\n\t\t\tcurrModuleDefs[\"methods\"] = {};\r\n\t\t\tcurrModuleDefs[\"base_methods\"] = {};\r\n\t\t\tcurrModuleDefs[\"cell_methods\"] = {};\r\n\t\t\tKBEngine.moduledefs[scriptUtype] = currModuleDefs;\r\n\t\t\t\r\n\t\t\tvar self_propertys = currModuleDefs[\"propertys\"];\r\n\t\t\tvar self_methods = currModuleDefs[\"methods\"];\r\n\t\t\tvar self_base_methods = currModuleDefs[\"base_methods\"];\r\n\t\t\tvar self_cell_methods = currModuleDefs[\"cell_methods\"];\r\n\t\t\t\r\n\t\t\tvar Class = KBEngine[scriptmodule_name];\r\n\t\t\t\r\n\t\t\twhile(propertysize > 0)\r\n\t\t\t{\r\n\t\t\t\tpropertysize--;\r\n\t\t\t\t\r\n\t\t\t\tvar properUtype = stream.readUint16();\r\n\t\t\t\tvar properFlags = stream.readUint32();\r\n\t\t\t\tvar aliasID = stream.readInt16();\r\n\t\t\t\tvar name = stream.readString();\r\n\t\t\t\tvar defaultValStr = stream.readString();\r\n\t\t\t\tvar utype = KBEngine.datatypes[stream.readUint16()];\r\n\t\t\t\tvar setmethod = null;\r\n\t\t\t\t\r\n\t\t\t\tif(Class != undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\tsetmethod = Class.prototype[\"set_\" + name];\r\n\t\t\t\t\tif(setmethod == undefined)\r\n\t\t\t\t\t\tsetmethod = null;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar savedata = [properUtype, aliasID, name, defaultValStr, utype, setmethod, properFlags];\r\n\t\t\t\tself_propertys[name] = savedata;\r\n\t\t\t\t\r\n\t\t\t\tif(aliasID != -1)\r\n\t\t\t\t{\r\n\t\t\t\t\tself_propertys[aliasID] = savedata;\r\n\t\t\t\t\tcurrModuleDefs[\"usePropertyDescrAlias\"] = true;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tself_propertys[properUtype] = savedata;\r\n\t\t\t\t\tcurrModuleDefs[\"usePropertyDescrAlias\"] = false;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onImportClientEntityDef: add(\" + scriptmodule_name + \"), property(\" + name + \"/\" + properUtype + \").\");\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\twhile(methodsize > 0)\r\n\t\t\t{\r\n\t\t\t\tmethodsize--;\r\n\t\t\t\t\r\n\t\t\t\tvar methodUtype = stream.readUint16();\r\n\t\t\t\tvar aliasID = stream.readInt16();\r\n\t\t\t\tvar name = stream.readString();\r\n\t\t\t\tvar argssize = stream.readUint8();\r\n\t\t\t\tvar args = [];\r\n\t\t\t\t\r\n\t\t\t\twhile(argssize > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\targssize--;\r\n\t\t\t\t\targs.push(KBEngine.datatypes[stream.readUint16()]);\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\tvar savedata = [methodUtype, aliasID, name, args];\r\n\t\t\t\tself_methods[name] = savedata;\r\n\t\t\t\t\r\n\t\t\t\tif(aliasID != -1)\r\n\t\t\t\t{\r\n\t\t\t\t\tself_methods[aliasID] = savedata;\r\n\t\t\t\t\tcurrModuleDefs[\"useMethodDescrAlias\"] = true;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tself_methods[methodUtype] = savedata;\r\n\t\t\t\t\tcurrModuleDefs[\"useMethodDescrAlias\"] = false;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onImportClientEntityDef: add(\" + scriptmodule_name + \"), method(\" + name + \").\");\r\n\t\t\t};\r\n\r\n\t\t\twhile(base_methodsize > 0)\r\n\t\t\t{\r\n\t\t\t\tbase_methodsize--;\r\n\t\t\t\t\r\n\t\t\t\tvar methodUtype = stream.readUint16();\r\n\t\t\t\tvar aliasID = stream.readInt16();\r\n\t\t\t\tvar name = stream.readString();\r\n\t\t\t\tvar argssize = stream.readUint8();\r\n\t\t\t\tvar args = [];\r\n\t\t\t\t\r\n\t\t\t\twhile(argssize > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\targssize--;\r\n\t\t\t\t\targs.push(KBEngine.datatypes[stream.readUint16()]);\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\tself_base_methods[name] = [methodUtype, aliasID, name, args];\r\n\t\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onImportClientEntityDef: add(\" + scriptmodule_name + \"), base_method(\" + name + \").\");\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\twhile(cell_methodsize > 0)\r\n\t\t\t{\r\n\t\t\t\tcell_methodsize--;\r\n\t\t\t\t\r\n\t\t\t\tvar methodUtype = stream.readUint16();\r\n\t\t\t\tvar aliasID = stream.readInt16();\r\n\t\t\t\tvar name = stream.readString();\r\n\t\t\t\tvar argssize = stream.readUint8();\r\n\t\t\t\tvar args = [];\r\n\t\t\t\t\r\n\t\t\t\twhile(argssize > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\targssize--;\r\n\t\t\t\t\targs.push(KBEngine.datatypes[stream.readUint16()]);\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\tself_cell_methods[name] = [methodUtype, aliasID, name, args];\r\n\t\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onImportClientEntityDef: add(\" + scriptmodule_name + \"), cell_method(\" + name + \").\");\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tvar defmethod = KBEngine[scriptmodule_name];\r\n\r\n\t\t\tif(defmethod == undefined)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onImportClientEntityDef: module(\" + scriptmodule_name + \") not found!\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor(var name in currModuleDefs.propertys)\r\n\t\t\t{\r\n\t\t\t\tvar infos = currModuleDefs.propertys[name];\r\n\t\t\t\tvar properUtype = infos[0];\r\n\t\t\t\tvar aliasID = infos[1];\r\n\t\t\t\tvar name = infos[2];\r\n\t\t\t\tvar defaultValStr = infos[3];\r\n\t\t\t\tvar utype = infos[4];\r\n\r\n\t\t\t\tif(defmethod != undefined)\r\n\t\t\t\t\tdefmethod.prototype[name] = utype.parseDefaultValStr(defaultValStr);\r\n\t\t\t};\r\n\r\n\t\t\tfor(var name in currModuleDefs.methods)\r\n\t\t\t{\r\n\t\t\t\tvar infos = currModuleDefs.methods[name];\r\n\t\t\t\tvar properUtype = infos[0];\r\n\t\t\t\tvar aliasID = infos[1];\r\n\t\t\t\tvar name = infos[2];\r\n\t\t\t\tvar args = infos[3];\r\n\t\t\t\t\r\n\t\t\t\tif(defmethod != undefined && defmethod.prototype[name] == undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\tKBEngine.WARNING_MSG(scriptmodule_name + \":: method(\" + name + \") no implement!\");\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\t\r\n\t\tKBEngine.app.onImportEntityDefCompleted();\r\n\t}\r\n\r\n\tthis.Client_onVersionNotMatch = function(stream)\r\n\t{\r\n\t\tKBEngine.app.serverVersion = stream.readString();\r\n\t\tKBEngine.ERROR_MSG(\"Client_onVersionNotMatch: verInfo=\" + KBEngine.app.clientVersion + \" not match(server: \" + KBEngine.app.serverVersion + \")\");\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onVersionNotMatch, KBEngine.app.clientVersion, KBEngine.app.serverVersion);\r\n\t}\r\n\r\n\tthis.Client_onScriptVersionNotMatch = function(stream)\r\n\t{\r\n\t\tKBEngine.app.serverScriptVersion = stream.readString();\r\n\t\tKBEngine.ERROR_MSG(\"Client_onScriptVersionNotMatch: verInfo=\" + KBEngine.app.clientScriptVersion + \" not match(server: \" + KBEngine.app.serverScriptVersion + \")\");\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onScriptVersionNotMatch, KBEngine.app.clientScriptVersion, KBEngine.app.serverScriptVersion);\r\n\t}\r\n\t\r\n\tthis.onImportEntityDefCompleted = function()\r\n\t{\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::onImportEntityDefCompleted: successfully!\");\r\n\t\tKBEngine.app.entitydefImported = true;\r\n\t\tKBEngine.app.login_baseapp(false);\r\n\t}\r\n\r\n\tthis.importClientMessages = function(stream)\r\n\t{\r\n\t\tvar app = KBEngine.app;\r\n\r\n\t\twhile(app.currMsgCount > 0)\r\n\t\t{\r\n\t\t\tapp.currMsgCount--;\r\n\t\t\r\n\t\t\tvar msgid = stream.readUint16();\r\n\t\t\tvar msglen = stream.readInt16();\r\n\t\t\tvar msgname = stream.readString();\r\n\t\t\tvar argtype = stream.readInt8();\r\n\t\t\tvar argsize = stream.readUint8();\r\n\t\t\tvar argstypes = new Array(argsize);\r\n\t\t\t\r\n\t\t\tfor(var i=0; i<argsize; i++)\r\n\t\t\t{\r\n\t\t\t\targstypes[i] = stream.readUint8();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar handler = null;\r\n\t\t\tvar isClientMethod = msgname.indexOf(\"Client_\") >= 0;\r\n\t\t\tif(isClientMethod)\r\n\t\t\t{\r\n\t\t\t\thandler = app[msgname];\r\n\t\t\t\tif(handler == null || handler == undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\tKBEngine.WARNING_MSG(\"KBEngineApp::onImportClientMessages[\" + app.currserver + \"]: interface(\" + msgname + \"/\" + msgid + \") no implement!\");\r\n\t\t\t\t\thandler = null;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::onImportClientMessages: import(\" + msgname + \") successfully!\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t\tif(msgname.length > 0)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.messages[msgname] = new KBEngine.Message(msgid, msgname, msglen, argtype, argstypes, handler);\r\n\t\t\t\t\r\n\t\t\t\tif(isClientMethod)\r\n\t\t\t\t\tKBEngine.clientmessages[msgid] = KBEngine.messages[msgname];\r\n\t\t\t\telse\r\n\t\t\t\t\tKBEngine.messages[KBEngine.app.currserver][msgid] = KBEngine.messages[msgname];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tKBEngine.messages[app.currserver][msgid] = new KBEngine.Message(msgid, msgname, msglen, argtype, argstypes, handler);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tapp.onImportClientMessagesCompleted();\r\n\t\tapp.currMsgID = 0;\r\n\t\tapp.currMsgLen = 0;\r\n\t\tapp.currMsgCount = 0;\r\n\t\tapp.fragmentStream = null;\r\n\t}\r\n\t\r\n\tthis.Client_onImportClientMessages = function(msg)\r\n\t{\r\n\t\tvar stream = new KBEngine.MemoryStream(msg.data);\r\n\t\tstream.wpos = msg.data.byteLength;\r\n\t\tvar app = KBEngine.app;\r\n\r\n\t\tif(app.currMsgID == 0)\r\n\t\t{\r\n\t\t\tapp.currMsgID = stream.readUint16();\r\n\t\t} \r\n\r\n\t\tif(app.currMsgID == KBEngine.messages.onImportClientMessages.id)\r\n\t\t{\r\n\t\t\tif(app.currMsgLen == 0) \r\n\t\t\t{\r\n\t\t\t\tapp.currMsgLen = stream.readUint16();\r\n\t\t\t\tapp.currMsgCount = stream.readUint16();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar FragmentDataTypes = KBEngine.FragmentDataTypes\r\n\t\t\tif(stream.length() + 2 < app.currMsgLen && app.fragmentStream == null)\r\n\t\t\t{\r\n\t\t\t\tapp.writeFragmentMessage(FragmentDataTypes.FRAGMENT_DATA_MESSAGE_BODY, stream, app.currMsgLen - 2);\r\n\t\t\t}\r\n\t\t\telse if(app.fragmentStream != null)\r\n\t\t\t{\r\n\t\t\t\tapp.mergeFragmentMessage(stream);\r\n\t\t\t\t\r\n\t\t\t\tif(app.fragmentStream.length() + 2 >= app.currMsgLen)\r\n\t\t\t\t{\r\n\t\t\t\t\tapp.importClientMessages(app.fragmentStream);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tapp.importClientMessages(stream);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::onmessage: not found msg(\" + app.currMsgID + \")!\");\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.createAccount = function(username, password, datas)\r\n\t{  \r\n\t\tKBEngine.app.reset();\r\n\t\tKBEngine.app.username = username;\r\n\t\tKBEngine.app.password = password;\r\n\t\tKBEngine.app.clientdatas = datas;\r\n\t\t\r\n\t\tKBEngine.app.createAccount_loginapp(true);\r\n\t}\r\n\t\r\n\tthis.getServerAddr = function(ip, port)\r\n\t{\r\n\t\tvar serverAddr = KBEngine.app.protocol + ip;\r\n\t\tif(port != \"\")\r\n\t\t{\r\n\t\t\tserverAddr += \":\" + port;\r\n\t\t}\r\n\t\t\r\n\t\treturn serverAddr;\r\n\t}\r\n\t\r\n\tthis.createAccount_loginapp = function(noconnect)\r\n\t{  \r\n\t\tcc.log(\"this.createAccount_loginapp\")\r\n\t\tif(noconnect)\r\n\t\t{\r\n\t\t\tvar serverAddr = this.getServerAddr(KBEngine.app.ip, KBEngine.app.port);\r\n\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::createAccount_loginapp: start connect to \" + serverAddr + \"!\");\r\n\t\t\tKBEngine.app.currconnect = \"loginapp\";\r\n\t\t\tKBEngine.app.connect(serverAddr);\r\n\t\t\tKBEngine.app.socket.onopen = KBEngine.app.onOpenLoginapp_createAccount;  \r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\tbundle.newMessage(KBEngine.messages.Loginapp_reqCreateAccount);\r\n\t\t\tbundle.writeString(KBEngine.app.username);\r\n\t\t\tbundle.writeString(KBEngine.app.password);\r\n\t\t\tbundle.writeBlob(KBEngine.app.clientdatas);\r\n\t\t\tbundle.send(KBEngine.app);\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.bindAccountEmail = function(emailAddress)\r\n\t{  \r\n\t\tvar bundle = new KBEngine.Bundle();\r\n\t\tbundle.newMessage(KBEngine.messages.Baseapp_reqAccountBindEmail);\r\n\t\tbundle.writeInt32(KBEngine.app.entity_id);\r\n\t\tbundle.writeString(KBEngine.app.password);\r\n\t\tbundle.writeString(emailAddress);\r\n\t\tbundle.send(KBEngine.app);\r\n\t}\r\n\t\r\n\tthis.newPassword = function(old_password, new_password)\r\n\t{\r\n\t\tvar bundle = new KBEngine.Bundle();\r\n\t\tbundle.newMessage(KBEngine.messages.Baseapp_reqAccountNewPassword);\r\n\t\tbundle.writeInt32(KBEngine.app.entity_id);\r\n\t\tbundle.writeString(old_password);\r\n\t\tbundle.writeString(new_password);\r\n\t\tbundle.send(KBEngine.app);\r\n\t}\r\n\t\r\n\tthis.login = function(username, password, datas)\r\n\t{  \r\n\t\tKBEngine.app.reset();\r\n\t\tKBEngine.app.username = username;\r\n\t\tKBEngine.app.password = password;\r\n\t\tKBEngine.app.clientdatas = datas;\r\n\t\t\r\n\t\tKBEngine.app.login_loginapp(true);\r\n\t}\r\n\t\r\n\tthis.logout = function()\r\n\t{\r\n\t\tvar bundle = new KBEngine.Bundle();\r\n\t\tbundle.newMessage(KBEngine.messages.Baseapp_logoutBaseapp);\r\n\t\tbundle.writeUint64(KBEngine.app.entity_uuid);\r\n\t\tbundle.writeInt32(KBEngine.app.entity_id);\r\n\t\tbundle.send(KBEngine.app);\r\n\t}\r\n\t\r\n\tthis.login_loginapp = function(noconnect)\r\n\t{  \r\n\t\t//cc.log(\"send login_loginapp\")\r\n\t\tif(noconnect)\r\n\t\t{\r\n\t\t\tvar serverAddr = this.getServerAddr(KBEngine.app.ip, KBEngine.app.port);\r\n\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::login_loginapp: start connect to \" + serverAddr + \"!\");\r\n\t\t\tKBEngine.app.currconnect = \"loginapp\";\r\n\t\t\tKBEngine.app.connect(serverAddr);\r\n\t\t\tKBEngine.app.socket.onopen = KBEngine.app.onOpenLoginapp_login;  \r\n\t\t}\r\n\t\telse\r\n\t\t{ \r\n\t\t\t\r\n\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\tbundle.newMessage(KBEngine.messages.Loginapp_login);\r\n\t\t\tbundle.writeInt8(KBEngine.app.args.clientType); // clientType\r\n\t\t\tbundle.writeBlob(KBEngine.app.clientdatas);\r\n\t\t\tbundle.writeString(KBEngine.app.username);\r\n\t\t\tbundle.writeString(KBEngine.app.password);\r\n\t\t\tbundle.send(KBEngine.app);\r\n\t\t}\r\n\t}\r\n\r\n\tthis.onOpenLoginapp_resetpassword = function()\r\n\t{  \r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::onOpenLoginapp_resetpassword: successfully!\");\r\n\t\tKBEngine.app.currserver = \"loginapp\";\r\n\t\tKBEngine.app.currstate = \"resetpassword\";\r\n\t\t\r\n\t\tif(!KBEngine.app.loginappMessageImported)\r\n\t\t{\r\n\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\tbundle.newMessage(KBEngine.messages.Loginapp_importClientMessages);\r\n\t\t\tbundle.send(KBEngine.app);\r\n\t\t\tKBEngine.app.socket.onmessage = KBEngine.app.Client_onImportClientMessages;  \r\n\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::onOpenLoginapp_resetpassword: start importClientMessages ...\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tKBEngine.app.onImportClientMessagesCompleted();\r\n\t\t}\r\n\t}\r\n\r\n\tthis.reset_password = function(username)\r\n\t{ \r\n\t\tKBEngine.app.reset();\r\n\t\tKBEngine.app.username = username;\r\n\t\tKBEngine.app.resetpassword_loginapp(true);\r\n\t}\r\n\t\r\n\tthis.resetpassword_loginapp = function(noconnect)\r\n\t{  \r\n\t\tif(noconnect)\r\n\t\t{\r\n\t\t\tvar serverAddr = this.getServerAddr(KBEngine.app.ip, KBEngine.app.port);\r\n\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::resetpassword_loginapp: start connect to \" + serverAddr + \"!\");\r\n\t\t\tKBEngine.app.currconnect = \"loginapp\";\r\n\t\t\tKBEngine.app.connect(serverAddr);\r\n\t\t\tKBEngine.app.socket.onopen = KBEngine.app.onOpenLoginapp_resetpassword;  \r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\tbundle.newMessage(KBEngine.messages.Loginapp_reqAccountResetPassword);\r\n\t\t\tbundle.writeString(KBEngine.app.username);\r\n\t\t\tbundle.send(KBEngine.app);\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.onOpenBaseapp = function()\r\n\t{\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::onOpenBaseapp: successfully!\");\r\n\t\tKBEngine.app.currserver = \"baseapp\";\r\n\t\t\r\n\t\tif(!KBEngine.app.baseappMessageImported)\r\n\t\t{\r\n\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\tbundle.newMessage(KBEngine.messages.Baseapp_importClientMessages);\r\n\t\t\tbundle.send(KBEngine.app);\r\n\t\t\tKBEngine.app.socket.onmessage = KBEngine.app.Client_onImportClientMessages;  \r\n\t\t\tKBEngine.Event.fire(\"Baseapp_importClientMessages\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tKBEngine.app.onImportClientMessagesCompleted();\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.login_baseapp = function(noconnect)\r\n\t{  \r\n\t\tif(noconnect)\r\n\t\t{\r\n\t\t\tKBEngine.Event.fire(KBEngine.EventTypes.onLoginBaseapp);\r\n\t\t\tvar serverAddr = this.getServerAddr(KBEngine.app.baseappIp, KBEngine.app.baseappPort);\r\n\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::login_baseapp: start connect to \" + serverAddr + \"!\");\r\n\t\t\tKBEngine.app.currconnect = \"baseapp\";\r\n\t\t\tKBEngine.app.connect(serverAddr);\r\n\t\t\t\r\n\t\t\tif(KBEngine.app.socket != undefined && KBEngine.app.socket != null)\r\n\t\t\t\tKBEngine.app.socket.onopen = KBEngine.app.onOpenBaseapp;  \r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\tbundle.newMessage(KBEngine.messages.Baseapp_loginBaseapp);\r\n\t\t\tbundle.writeString(KBEngine.app.username);\r\n\t\t\tbundle.writeString(KBEngine.app.password);\r\n\t\t\tbundle.send(KBEngine.app);\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.reloginBaseapp = function()\r\n\t{\r\n\t\tvar dateObject = new Date();\r\n\t\tKBEngine.app.lastTickTime = dateObject.getTime();\r\n\t\tKBEngine.app.lastTickCBTime = dateObject.getTime();\r\n\r\n\t\tif(KBEngine.app.socket != undefined && KBEngine.app.socket != null)\r\n\t\t\treturn;\r\n\t\t\r\n\t\tKBEngine.app.resetSocket();\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onReloginBaseapp);\r\n\r\n\t\tvar serverAddr = this.getServerAddr(KBEngine.app.baseappIp, KBEngine.app.baseappPort);\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::reloginBaseapp: start connect to \" + serverAddr + \"!\");\r\n\t\tKBEngine.app.currconnect = \"baseapp\";\r\n\t\tKBEngine.app.connect(serverAddr);\r\n\t\t\r\n\t\tif(KBEngine.app.socket != undefined && KBEngine.app.socket != null)\r\n\t\t\tKBEngine.app.socket.onopen = KBEngine.app.onReOpenBaseapp;  \r\n\t}\r\n\t\r\n\tthis.onReOpenBaseapp = function()\r\n\t{\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::onReOpenBaseapp: successfully!\");\r\n\t\tKBEngine.app.currserver = \"baseapp\";\r\n\t\t\r\n\t\tvar bundle = new KBEngine.Bundle();\r\n\t\tbundle.newMessage(KBEngine.messages.Baseapp_reloginBaseapp);\r\n\t\tbundle.writeString(KBEngine.app.username);\r\n\t\tbundle.writeString(KBEngine.app.password);\r\n\t\tbundle.writeUint64(KBEngine.app.entity_uuid);\r\n\t\tbundle.writeInt32(KBEngine.app.entity_id);//用我的Entity_id在baseapp.findEntity(id)\r\n\t\tbundle.send(KBEngine.app);\r\n\t\t\r\n\t\tvar dateObject = new Date();\r\n\t\tKBEngine.app.lastTickCBTime = dateObject.getTime();\r\n\t}\r\n\t\r\n\tthis.Client_onHelloCB = function(args)\r\n\t{\r\n\t\tKBEngine.app.serverVersion = args.readString();\r\n\t\tKBEngine.app.serverScriptVersion = args.readString();\r\n\t\tKBEngine.app.serverProtocolMD5 = args.readString();\r\n\t\tKBEngine.app.serverEntityDefMD5 = args.readString();\r\n\t\t\r\n\t\tvar ctype = args.readInt32();\r\n\t\t\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onHelloCB: verInfo(\" + KBEngine.app.serverVersion + \"), scriptVerInfo(\" + \r\n\t\t\tKBEngine.app.serverScriptVersion + \"), serverProtocolMD5(\" + KBEngine.app.serverProtocolMD5 + \"), serverEntityDefMD5(\" + \r\n\t\t\tKBEngine.app.serverEntityDefMD5 + \"), ctype(\" + ctype + \")!\");\r\n\t\t\r\n\t\tvar dateObject = new Date();\r\n\t\tKBEngine.app.lastTickCBTime = dateObject.getTime();\r\n\t}\r\n\t\r\n\tthis.Client_onLoginFailed = function(args)\r\n\t{\r\n\t\tvar failedcode = args.readUint16();\r\n\t\tKBEngine.app.serverdatas = args.readBlob();\r\n\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onLoginFailed: failedcode(\" + KBEngine.app.serverErrs[failedcode].name + \"), datas(\" + KBEngine.app.serverdatas.length + \")!\");\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onLoginFailed, failedcode);\r\n\t}\r\n\t\r\n\tthis.Client_onLoginSuccessfully = function(args)\r\n\t{\r\n\t\tvar accountName = args.readString();\r\n\t\tKBEngine.app.username = accountName;\r\n\t\tKBEngine.app.baseappIp = args.readString();\r\n\t\tKBEngine.app.baseappPort = args.readUint16();\r\n\t\tKBEngine.app.serverdatas = args.readBlob();\r\n\t\tcc.log(\"this.Client_onLoginSuccessfully111\")\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onLoginSuccessfully: accountName(\" + accountName + \"), addr(\" + \r\n\t\t\t\tKBEngine.app.baseappIp + \":\" + KBEngine.app.baseappPort + \"), datas(\" + KBEngine.app.serverdatas.length + \")!\");\r\n\t\t\r\n\t\tKBEngine.app.disconnect();\r\n\t\tKBEngine.app.login_baseapp(true);\r\n\t}\r\n\t\r\n\tthis.Client_onLoginBaseappFailed = function(failedcode)\r\n\t{\r\n\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onLoginBaseappFailed: failedcode(\" + KBEngine.app.serverErrs[failedcode].name + \")!\");\r\n\t\tKBEngine.Event.fire(KBEngine.onLoginBaseappFailed.onLoginBaseappFailed, failedcode);\r\n\t}\r\n\r\n\tthis.Client_onReloginBaseappFailed = function(failedcode)\r\n\t{\r\n\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onReloginBaseappFailed: failedcode(\" + KBEngine.app.serverErrs[failedcode].name + \")!\");\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onReloginBaseappFailed, failedcode);\r\n\t}\r\n\r\n\tthis.Client_onReloginBaseappSuccessfully = function(stream)\r\n\t{\r\n\t\tKBEngine.app.entity_uuid = stream.readUint64();\r\n\t\tKBEngine.DEBUG_MSG(\"KBEngineApp::Client_onReloginBaseappSuccessfully: \" + KBEngine.app.username);\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onReloginBaseappSuccessfully);\r\n\t}\r\n\t\r\n\tthis.entityclass = {};\r\n\tthis.getentityclass = function(entityType)\r\n\t{\r\n\t\tvar runclass = KBEngine.app.entityclass[entityType];\r\n\t\tif(runclass == undefined)\r\n\t\t{\r\n\t\t\trunclass = KBEngine[entityType];\r\n\t\t\tif(runclass == undefined)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::getentityclass: entityType(\" + entityType + \") is error!\");\r\n\t\t\t\treturn runclass;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tKBEngine.app.entityclass[entityType] = runclass;\r\n\t\t}\r\n\r\n\t\treturn runclass;\r\n\t}\r\n\t\r\n\tthis.Client_onCreatedProxies = function(rndUUID, eid, entityType)\r\n\t{\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onCreatedProxies: eid(\" + eid + \"), entityType(\" + entityType + \")!\");\r\n\t\t\r\n\t\tvar entity = KBEngine.app.entities[eid];\r\n\t\t\r\n\t\tKBEngine.app.entity_uuid = rndUUID;\r\n\t\tKBEngine.app.entity_id = eid;\r\n\t\t\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\tvar runclass = KBEngine.app.getentityclass(entityType);\r\n\t\t\tif(runclass == undefined)\r\n\t\t\t\treturn;\r\n\t\t\t\r\n\t\t\tvar entity = new runclass();\r\n\t\t\tentity.id = eid;\r\n\t\t\tentity.className = entityType;\r\n\t\t\t\r\n\t\t\tentity.base = new KBEngine.EntityCall();\r\n\t\t\tentity.base.id = eid;\r\n\t\t\tentity.base.className = entityType;\r\n\t\t\tentity.base.type = KBEngine.ENTITYCALL_TYPE_BASE;\r\n\t\t\t\r\n\t\t\tKBEngine.app.entities[eid] = entity;\r\n\t\t\t\r\n\t\t\tvar entityMessage = KBEngine.bufferedCreateEntityMessages[eid];\r\n\t\t\tif(entityMessage != undefined)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.app.Client_onUpdatePropertys(entityMessage);\r\n\t\t\t\tdelete KBEngine.bufferedCreateEntityMessages[eid];\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tentity.__init__();\r\n\t\t\tentity.inited = true;\r\n\t\t\t\r\n\t\t\tif(KBEngine.app.args.isOnInitCallPropertysSetMethods)\r\n\t\t\t\tentity.callPropertysSetMethods();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar entityMessage = KBEngine.bufferedCreateEntityMessages[eid];\r\n\t\t\tif(entityMessage != undefined)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.app.Client_onUpdatePropertys(entityMessage);\r\n\t\t\t\tdelete KBEngine.bufferedCreateEntityMessages[eid];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.getViewEntityIDFromStream = function(stream)\r\n\t{\r\n\t\tvar id = 0;\r\n\t\tif(KBEngine.app.entityIDAliasIDList.Length > 255)\r\n\t\t{\r\n\t\t\tid = stream.readInt32();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar aliasID = stream.readUint8();\r\n\r\n\t\t\t// 如果为0且客户端上一步是重登陆或者重连操作并且服务端entity在断线期间一直处于在线状态\r\n\t\t\t// 则可以忽略这个错误, 因为cellapp可能一直在向baseapp发送同步消息， 当客户端重连上时未等\r\n\t\t\t// 服务端初始化步骤开始则收到同步信息, 此时这里就会出错。\r\n\t\t\tif(KBEngine.app.entityIDAliasIDList.length <= aliasID)\r\n\t\t\t\treturn 0;\r\n\t\t\r\n\t\t\tid = KBEngine.app.entityIDAliasIDList[aliasID];\r\n\t\t}\r\n\t\t\r\n\t\treturn id;\r\n\t}\r\n\t\r\n\tthis.onUpdatePropertys_ = function(eid, stream)\r\n\t{\r\n\t\tvar entity = KBEngine.app.entities[eid];\r\n\t\t\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\tvar entityMessage = KBEngine.bufferedCreateEntityMessages[eid];\r\n\t\t\tif(entityMessage != undefined)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onUpdatePropertys: entity(\" + eid + \") not found!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar stream1 = new KBEngine.MemoryStream(stream.buffer);\r\n\t\t\tstream1.wpos = stream.wpos;\r\n\t\t\tstream1.rpos = stream.rpos - 4;\r\n\t\t\tKBEngine.bufferedCreateEntityMessages[eid] = stream1;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar currModule = KBEngine.moduledefs[entity.className];\r\n\t\tvar pdatas = currModule.propertys;\r\n\t\twhile(stream.length() > 0)\r\n\t\t{\r\n\t\t\tvar utype = 0;\r\n\t\t\tif(currModule.usePropertyDescrAlias)\r\n\t\t\t\tutype = stream.readUint8();\r\n\t\t\telse\r\n\t\t\t\tutype = stream.readUint16();\r\n\t\t\r\n\t\t\tvar propertydata = pdatas[utype];\r\n\t\t\tvar setmethod = propertydata[5];\r\n\t\t\tvar flags = propertydata[6];\r\n\t\t\tvar val = propertydata[4].createFromStream(stream);\r\n\t\t\tvar oldval = entity[propertydata[2]];\r\n\t\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onUpdatePropertys: \" + entity.className + \"(id=\" + eid  + \" \" + propertydata[2] + \", val=\" + val + \")!\");\r\n\t\t\t\r\n\t\t\tif(propertydata[2]==\"position\"){\r\n\t\t\t\tcc.log(\"val.y\",val.y)\r\n\t\t\t\tval.y=0\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tentity[propertydata[2]] = val;\r\n\t\t\tif(setmethod != null)\r\n\t\t\t{\r\n\t\t\t\t// base类属性或者进入世界后cell类属性会触发set_*方法\r\n\t\t\t\tif(flags == 0x00000020 || flags == 0x00000040)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(entity.inited)\r\n\t\t\t\t\t\tsetmethod.call(entity, oldval);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif(entity.inWorld){\r\n\t\t\t\t\t\tcc.log(\"setmethod=\",setmethod)\r\n\t\t\t\t\t\tsetmethod.call(entity, oldval);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis.Client_onUpdatePropertysOptimized = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\tKBEngine.app.onUpdatePropertys_(eid, stream);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdatePropertys = function(stream)\r\n\t{\r\n\t\tvar eid = stream.readInt32();\r\n\t\tKBEngine.app.onUpdatePropertys_(eid, stream);\r\n\t}\r\n\r\n\tthis.onRemoteMethodCall_ = function(eid, stream)\r\n\t{\r\n\t\tvar entity = KBEngine.app.entities[eid];\r\n\t\t\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onRemoteMethodCall: entity(\" + eid + \") not found!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar methodUtype = 0;\r\n\t\tif(KBEngine.moduledefs[entity.className].useMethodDescrAlias)\r\n\t\t\tmethodUtype = stream.readUint8();\r\n\t\telse\r\n\t\t\tmethodUtype = stream.readUint16();\r\n\t\t\r\n\t\tvar methoddata = KBEngine.moduledefs[entity.className].methods[methodUtype];\r\n\t\tvar args = [];\r\n\t\tvar argsdata = methoddata[3];\r\n\t\tfor(var i=0; i<argsdata.length; i++)\r\n\t\t{\r\n\t\t\targs.push(argsdata[i].createFromStream(stream));\r\n\t\t}\r\n\t\t\r\n\t\tif(entity[methoddata[2]] != undefined)\r\n\t\t{\r\n\t\t\tentity[methoddata[2]].apply(entity, args);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onRemoteMethodCall: entity(\" + eid + \") not found method(\" + methoddata[2] + \")!\");\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.Client_onRemoteMethodCallOptimized = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\tKBEngine.app.onRemoteMethodCall_(eid, stream);\r\n\t}\r\n\t\r\n\tthis.Client_onRemoteMethodCall = function(stream)\r\n\t{\r\n\t\tvar eid = stream.readInt32();\r\n\t\tKBEngine.app.onRemoteMethodCall_(eid, stream);\r\n\t}\r\n\t\r\n\tthis.Client_onEntityEnterWorld = function(stream)\r\n\t{\r\n\t\tvar eid = stream.readInt32();\r\n\t\tif(KBEngine.app.entity_id > 0 && eid != KBEngine.app.entity_id)\r\n\t\t\tKBEngine.app.entityIDAliasIDList.push(eid)\r\n\t\t\r\n\t\tvar entityType;\r\n\t\tif(KBEngine.moduledefs.Length > 255)\r\n\t\t\tentityType = stream.readUint16();\r\n\t\telse\r\n\t\t\tentityType = stream.readUint8();\r\n\t\t\r\n\t\tvar isOnGround = true;\r\n\t\t\r\n\t\tif(stream.length() > 0)\r\n\t\t\tisOnGround = stream.readInt8();\r\n\t\tcc.log(\"entityType=\",entityType)\r\n\t\tentityType = KBEngine.moduledefs[entityType].name;\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onEntityEnterWorld: \" + entityType + \"(\" + eid + \"), spaceID(\" + KBEngine.app.spaceID + \"), isOnGround(\" + isOnGround + \")!\");\r\n\t\t\r\n\t\tvar entity = KBEngine.app.entities[eid];\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\tvar entityMessage = KBEngine.bufferedCreateEntityMessages[eid];\r\n\t\t\tif(entityMessage == undefined)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onEntityEnterWorld: entity(\" + eid + \") not found!\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar runclass = KBEngine.app.getentityclass(entityType);\r\n\t\t\tif(runclass == undefined)\r\n\t\t\t\treturn;\r\n\t\t\t\r\n\t\t\tvar entity = new runclass();\r\n\t\t\tentity.id = eid;\r\n\t\t\tentity.className = entityType;\r\n\t\t\t\r\n\t\t\tentity.cell = new KBEngine.EntityCall();\r\n\t\t\tentity.cell.id = eid;\r\n\t\t\tentity.cell.className = entityType;\r\n\t\t\tentity.cell.type = KBEngine.ENTITYCALL_TYPE_CELL;\r\n\t\t\t\r\n\t\t\tKBEngine.app.entities[eid] = entity;\r\n\t\t\t\r\n\t\t\tKBEngine.app.Client_onUpdatePropertys(entityMessage);\r\n\t\t\tdelete KBEngine.bufferedCreateEntityMessages[eid];\r\n\t\t\t\r\n\t\t\tentity.isOnGround = isOnGround > 0;\r\n\t\t\tentity.__init__();\r\n\t\t\tentity.inited = true;\r\n\t\t\tentity.inWorld = true;\r\n\t\t\tentity.enterWorld();\r\n\t\t\t\r\n\t\t\tif(KBEngine.app.args.isOnInitCallPropertysSetMethods)\r\n\t\t\t\tentity.callPropertysSetMethods();\r\n\t\t\t\r\n\t\t\tentity.set_direction(entity.direction);\r\n\t\t\tentity.set_position(entity.position);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif(!entity.inWorld)\r\n\t\t\t{\r\n\t\t\t\tentity.cell = new KBEngine.EntityCall();\r\n\t\t\t\tentity.cell.id = eid;\r\n\t\t\t\tentity.cell.className = entityType;\r\n\t\t\t\tentity.cell.type = KBEngine.ENTITYCALL_TYPE_CELL;\r\n\r\n\t\t\t\t// 安全起见， 这里清空一下\r\n\t\t\t\t// 如果服务端上使用giveClientTo切换控制权\r\n\t\t\t\t// 之前的实体已经进入世界， 切换后的实体也进入世界， 这里可能会残留之前那个实体进入世界的信息\r\n\t\t\t\tKBEngine.app.entityIDAliasIDList = [];\r\n\t\t\t\tKBEngine.app.entities = {}\r\n\t\t\t\tKBEngine.app.entities[entity.id] = entity;\r\n\r\n\t\t\t\tentity.set_direction(entity.direction);\r\n\t\t\t\tentity.set_position(entity.position);\r\n\r\n\t\t\t\tKBEngine.app.entityServerPos.x = entity.position.x;\r\n\t\t\t\tKBEngine.app.entityServerPos.y = entity.position.y;\r\n\t\t\t\tKBEngine.app.entityServerPos.z = entity.position.z;\r\n\t\t\t\t\r\n\t\t\t\tentity.isOnGround = isOnGround > 0;\r\n\t\t\t\tentity.inWorld = true;\r\n\t\t\t\tentity.enterWorld();\r\n\t\t\t\t\r\n\t\t\t\tif(KBEngine.app.args.isOnInitCallPropertysSetMethods)\r\n\t\t\t\t\tentity.callPropertysSetMethods();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthis.Client_onEntityLeaveWorldOptimized = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\tKBEngine.app.Client_onEntityLeaveWorld(eid);\r\n\t}\r\n\t\r\n\tthis.Client_onEntityLeaveWorld = function(eid)\r\n\t{\r\n\t\tvar entity = KBEngine.app.entities[eid];\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onEntityLeaveWorld: entity(\" + eid + \") not found!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif(entity.inWorld)\r\n\t\t\tentity.leaveWorld();\r\n\t\t\r\n\t\tif(KBEngine.app.entity_id > 0 && eid != KBEngine.app.entity_id)\r\n\t\t{\r\n\t\t\tvar newArray0 = [];\r\n\r\n\t\t\tfor(var i=0; i<KBEngine.app.controlledEntities.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif(KBEngine.app.controlledEntities[i] != eid)\r\n\t\t\t\t{\r\n\t\t\t       \tnewArray0.push(KBEngine.app.controlledEntities[i]);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tKBEngine.Event.fire(KBEngine.EventTypes.onLoseControlledEntity);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tKBEngine.app.controlledEntities = newArray0\r\n\t\t\t\t\r\n\t\t\tdelete KBEngine.app.entities[eid];\r\n\t\t\t\r\n\t\t\tvar newArray = [];\r\n\t\t\tfor(var i=0; i<KBEngine.app.entityIDAliasIDList.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif(KBEngine.app.entityIDAliasIDList[i] != eid)\r\n\t\t\t\t{\r\n\t\t\t\t\tnewArray.push(KBEngine.app.entityIDAliasIDList[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tKBEngine.app.entityIDAliasIDList = newArray\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tKBEngine.app.clearSpace(false);\r\n\t\t\tentity.cell = null;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.Client_onEntityDestroyed = function(eid)\r\n\t{\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onEntityDestroyed: entity(\" + eid + \")!\");\r\n\t\t\r\n\t\tvar entity = KBEngine.app.entities[eid];\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onEntityDestroyed: entity(\" + eid + \") not found!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(entity.inWorld)\r\n\t\t{\r\n\t\t\tif(KBEngine.app.entity_id == eid)\r\n\t\t\t\tKBEngine.app.clearSpace(false);\r\n\r\n\t\t\tentity.leaveWorld();\r\n\t\t}\r\n\t\t\t\r\n\t\tdelete KBEngine.app.entities[eid];\r\n\t}\r\n\t\r\n\tthis.Client_onEntityEnterSpace = function(stream)\r\n\t{\r\n\t\tvar eid = stream.readInt32();\r\n\t\tKBEngine.app.spaceID = stream.readUint32();\r\n\t\tvar isOnGround = true;\r\n\t\t\r\n\t\tif(stream.length() > 0)\r\n\t\t\tisOnGround = stream.readInt8();\r\n\t\t\r\n\t\tvar entity = KBEngine.app.entities[eid];\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onEntityEnterSpace: entity(\" + eid + \") not found!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tentity.isOnGround = isOnGround;\r\n\t\tKBEngine.app.entityServerPos.x = entity.position.x;\r\n\t\tKBEngine.app.entityServerPos.y = entity.position.y;\r\n\t\tKBEngine.app.entityServerPos.z = entity.position.z;\r\n\t\tentity.enterSpace();\r\n\t}\r\n\t\r\n\tthis.Client_onEntityLeaveSpace = function(eid)\r\n\t{\r\n\t\tvar entity = KBEngine.app.entities[eid];\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onEntityLeaveSpace: entity(\" + eid + \") not found!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tKBEngine.app.clearSpace(false);\r\n\t\tentity.leaveSpace();\r\n\t}\r\n\r\n\tthis.Client_onKicked = function(failedcode)\r\n\t{\r\n\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onKicked: failedcode(\" + KBEngine.app.serverErrs[failedcode].name + \")!\");\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onKicked, failedcode);\r\n\t}\r\n\r\n\tthis.Client_onCreateAccountResult = function(stream)\r\n\t{\r\n\t\tvar retcode = stream.readUint16();\r\n\t\tvar datas = stream.readBlob();\r\n\t\t\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onCreateAccountResult, retcode, datas);\r\n\t\t\r\n\t\tif(retcode != 0)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onCreateAccountResult: \" + KBEngine.app.username + \" create is failed! code=\" + KBEngine.app.serverErrs[retcode].name + \"!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onCreateAccountResult: \" + KBEngine.app.username + \" create is successfully!\");\r\n\t}\r\n\r\n\tthis.Client_onControlEntity = function(eid, isControlled)\r\n\t{\r\n\t\tvar eid = stream.readInt32();\r\n\t\tvar entity = KBEngine.app.entities[eid];\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onControlEntity: entity(\" + eid + \") not found!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar isCont = isControlled != 0;\r\n\t\tif (isCont)\r\n\t\t{\r\n\t\t\t// 如果被控制者是玩家自己，那表示玩家自己被其它人控制了\r\n\t\t\t// 所以玩家自己不应该进入这个被控制列表\r\n\t\t\tif (KBEngine.app.player().id != entity.id)\r\n\t\t\t{\r\n\t\t\t\tKBEngine.app.controlledEntities.push(entity)\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar newArray = [];\r\n\r\n\t\t\tfor(var i=0; i<KBEngine.app.controlledEntities.length; i++)\r\n\t\t\t\tif(KBEngine.app.controlledEntities[i] != entity.id)\r\n\t\t\t       \tnewArray.push(KBEngine.app.controlledEntities[i]);\r\n\t\t\t\r\n\t\t\tKBEngine.app.controlledEntities = newArray\r\n\t\t}\r\n\t\t\r\n\t\tentity.isControlled = isCont;\r\n\t\t\r\n\t\ttry\r\n\t\t{\r\n\t\t\tentity.onControlled(isCont);\r\n\t\t\tKBEngine.Event.fire(KBEngine.EventTypes.onControlled, entity, isCont);\r\n\t\t}\r\n\t\tcatch (e)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngine::Client_onControlEntity: entity id = '\" + eid + \"', is controlled = '\" + isCont + \"', error = '\" + e + \"'\");\r\n\t\t}\r\n\t}\r\n\r\n\tthis.updatePlayerToServer = function()\r\n\t{\r\n\t\tvar player = KBEngine.app.player();\r\n\t\tif(player == undefined || player.inWorld == false || KBEngine.app.spaceID == 0 || player.isControlled)\r\n\t\t\treturn;\r\n\t\t\r\n\t\tif(player.entityLastLocalPos.distance(player.position) > 0.001 || player.entityLastLocalDir.distance(player.direction) > 0.001)\r\n\t\t{\r\n\t\t\t// 记录玩家最后一次上报位置时自身当前的位置\r\n\t\t\tplayer.entityLastLocalPos.x = player.position.x;\r\n\t\t\tplayer.entityLastLocalPos.y = player.position.y;\r\n\t\t\tplayer.entityLastLocalPos.z = player.position.z;\r\n\t\t\tplayer.entityLastLocalDir.x = player.direction.x;\r\n\t\t\tplayer.entityLastLocalDir.y = player.direction.y;\r\n\t\t\tplayer.entityLastLocalDir.z = player.direction.z;\t\r\n\t\t\t\t\t\t\t\r\n\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\tbundle.newMessage(KBEngine.messages.Baseapp_onUpdateDataFromClient);\r\n\t\t\tbundle.writeFloat(player.position.x);\r\n\t\t\tbundle.writeFloat(player.position.y);\r\n\t\t\tbundle.writeFloat(player.position.z);\r\n\t\t\tbundle.writeFloat(player.direction.x);\r\n\t\t\tbundle.writeFloat(player.direction.y);\r\n\t\t\tbundle.writeFloat(player.direction.z);\r\n\t\t\tbundle.writeUint8(player.isOnGround);\r\n\t\t\tbundle.writeUint32(KBEngine.app.spaceID);\r\n\t\t\tbundle.send(KBEngine.app);\r\n\t\t}\r\n\t\t\r\n\t\t// 开始同步所有被控制了的entity的位置\r\n\t\tfor (var eid in KBEngine.app.controlledEntities)  \r\n\t\t{ \r\n\t\t\tvar entity = KBEngine.app.controlledEntities[i];\r\n\t\t\tposition = entity.position;\r\n\t\t\tdirection = entity.direction;\r\n\r\n\t\t\tposHasChanged = entity.entityLastLocalPos.distance(position) > 0.001;\r\n\t\t\tdirHasChanged = entity.entityLastLocalDir.distance(direction) > 0.001;\r\n\r\n\t\t\tif (posHasChanged || dirHasChanged)\r\n\t\t\t{\r\n\t\t\t\tentity.entityLastLocalPos = position;\r\n\t\t\t\tentity.entityLastLocalDir = direction;\r\n\r\n\t\t\t\tvar bundle = new KBEngine.Bundle();\r\n\t\t\t\tbundle.newMessage(KBEngine.messages.Baseapp_onUpdateDataFromClientForControlledEntity);\r\n\t\t\t\tbundle.writeInt32(entity.id);\r\n\t\t\t\tbundle.writeFloat(position.x);\r\n\t\t\t\tbundle.writeFloat(position.y);\r\n\t\t\t\tbundle.writeFloat(position.z);\r\n\r\n\t\t\t\tbundle.writeFloat(direction.x);\r\n\t\t\t\tbundle.writeFloat(direction.y);\r\n\t\t\t\tbundle.writeFloat(direction.z);\r\n\t\t\t\tbundle.writeUint8(entity.isOnGround);\r\n\t\t\t\tbundle.writeUint32(KBEngine.app.spaceID);\r\n\t\t\t\tbundle.send(KBEngine.app);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.addSpaceGeometryMapping = function(spaceID, respath)\r\n\t{\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::addSpaceGeometryMapping: spaceID(\" + spaceID + \"), respath(\" + respath + \")!\");\r\n\t\t\r\n\t\tKBEngine.app.spaceID = spaceID;\r\n\t\tKBEngine.app.spaceResPath = respath;\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.addSpaceGeometryMapping, respath);\r\n\t}\r\n\r\n\tthis.clearSpace = function(isAll)\r\n\t{\r\n\t\tKBEngine.app.entityIDAliasIDList = [];\r\n\t\tKBEngine.app.spacedata = {};\r\n\t\tKBEngine.app.clearEntities(isAll);\r\n\t\tKBEngine.app.isLoadedGeometry = false;\r\n\t\tKBEngine.app.spaceID = 0;\r\n\t}\r\n\r\n\tthis.clearEntities = function(isAll)\r\n\t{\r\n\t\tKBEngine.app.controlledEntities = []\r\n\r\n\t\tif(!isAll)\r\n\t\t{\r\n\t\t\tvar entity = KBEngine.app.player();\r\n\t\t\t\r\n\t\t\tfor (var eid in KBEngine.app.entities)  \r\n\t\t\t{ \r\n\t\t\t\tif(eid == entity.id)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t\r\n\t\t\t\tif(KBEngine.app.entities[eid].inWorld)\r\n\t\t\t\t{\r\n\t\t\t    \tKBEngine.app.entities[eid].leaveWorld();\r\n\t\t\t    }\r\n\t\t\t    \r\n\t\t\t    KBEngine.app.entities[eid].onDestroy();\r\n\t\t\t}  \r\n\t\t\t\t\r\n\t\t\tKBEngine.app.entities = {}\r\n\t\t\tKBEngine.app.entities[entity.id] = entity;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfor (var eid in KBEngine.app.entities)  \r\n\t\t\t{ \r\n\t\t\t\tif(KBEngine.app.entities[eid].inWorld)\r\n\t\t\t    {\r\n\t\t\t    \tKBEngine.app.entities[eid].leaveWorld();\r\n\t\t\t    }\r\n\t\t\t    \r\n\t\t\t    KBEngine.app.entities[eid].onDestroy();\r\n\t\t\t}  \r\n\t\t\t\t\r\n\t\t\tKBEngine.app.entities = {}\r\n\t\t}\r\n\t}\r\n\r\n\tthis.Client_initSpaceData = function(stream)\r\n\t{\r\n\t\tKBEngine.app.clearSpace(false);\r\n\t\t\r\n\t\tKBEngine.app.spaceID = stream.readInt32();\r\n\t\twhile(stream.length() > 0)\r\n\t\t{\r\n\t\t\tvar key = stream.readString();\r\n\t\t\tvar value = stream.readString();\r\n\t\t\tKBEngine.app.Client_setSpaceData(KBEngine.app.spaceID, key, value);\r\n\t\t}\r\n\t\t//KBEngine.Event.fire(KBEngine.EventTypes.onSetSpaceData);\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_initSpaceData: spaceID(\" + KBEngine.app.spaceID + \"), datas(\" + KBEngine.app.spacedata + \")!\");\r\n\t}\r\n\t\r\n\tthis.Client_setSpaceData = function(spaceID, key, value)\r\n\t{\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_setSpaceData: spaceID(\" + spaceID + \"), key(\" + key + \"), value(\" + value + \")!\");\r\n\t\t\r\n\t\tKBEngine.app.spacedata[key] = value;\r\n\t\t\r\n\t\tif(key == \"_mapping\")\r\n\t\t\tKBEngine.app.addSpaceGeometryMapping(spaceID, value);\r\n\t\t\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onSetSpaceData, spaceID, key, value);\r\n\t}\r\n\t\r\n\tthis.Client_delSpaceData = function(spaceID, key)\r\n\t{\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_delSpaceData: spaceID(\" + spaceID + \"), key(\" + key + \")!\");\r\n\t\t\r\n\t\tdelete KBEngine.app.spacedata[key];\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onDelSpaceData, spaceID, key);\r\n\t}\r\n\t\r\n\tthis.Client_getSpaceData = function(spaceID, key)\r\n\t{\r\n\t\treturn KBEngine.app.spacedata[key];\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateBasePos = function(x, y, z)\r\n\t{\r\n\t\tKBEngine.app.entityServerPos.x = x;\r\n\t\tKBEngine.app.entityServerPos.y = y;\r\n\t\tKBEngine.app.entityServerPos.z = z;\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateBasePosXZ = function(x, z)\r\n\t{\r\n\t\tKBEngine.app.entityServerPos.x = x;\r\n\t\tKBEngine.app.entityServerPos.z = z;\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\tvar entity = KBEngine.app.entities[eid];\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onUpdateData: entity(\" + eid + \") not found!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.Client_onSetEntityPosAndDir = function(stream)\r\n\t{\r\n\t\tvar eid = stream.readInt32();\r\n\t\tvar entity = KBEngine.app.entities[eid];\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onSetEntityPosAndDir: entity(\" + eid + \") not found!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tentity.position.x = stream.readFloat();\r\n\t\tentity.position.y = stream.readFloat();\r\n\t\tentity.position.z = stream.readFloat();\r\n\t\tentity.direction.x = stream.readFloat();\r\n\t\tentity.direction.y = stream.readFloat();\r\n\t\tentity.direction.z = stream.readFloat();\r\n\t\t\r\n\t\t// 记录玩家最后一次上报位置时自身当前的位置\r\n\t\tentity.entityLastLocalPos.x = entity.position.x;\r\n\t\tentity.entityLastLocalPos.y = entity.position.y;\r\n\t\tentity.entityLastLocalPos.z = entity.position.z;\r\n\t\tentity.entityLastLocalDir.x = entity.direction.x;\r\n\t\tentity.entityLastLocalDir.y = entity.direction.y;\r\n\t\tentity.entityLastLocalDir.z = entity.direction.z;\t\r\n\t\t\t\t\r\n\t\tentity.set_direction(entity.direction);\r\n\t\tentity.set_position(entity.position);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_ypr = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar y = stream.readInt8();\r\n\t\tvar p = stream.readInt8();\r\n\t\tvar r = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, y, p, r, -1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_yp = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar y = stream.readInt8();\r\n\t\tvar p = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, y, p, KBEngine.KBE_FLT_MAX, -1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_yr = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar y = stream.readInt8();\r\n\t\tvar r = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, y, KBEngine.KBE_FLT_MAX, r, -1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_pr = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar p = stream.readInt8();\r\n\t\tvar r = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, p, r, -1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_y = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar y = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, y, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, -1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_p = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar p = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, p, KBEngine.KBE_FLT_MAX, -1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_r = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar r = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, r, -1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xz = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], KBEngine.KBE_FLT_MAX, xz[1], KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, 1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xz_ypr = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\r\n\t\tvar y = stream.readInt8();\r\n\t\tvar p = stream.readInt8();\r\n\t\tvar r = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], KBEngine.KBE_FLT_MAX, xz[1], y, p, r, 1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xz_yp = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\r\n\t\tvar y = stream.readInt8();\r\n\t\tvar p = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], KBEngine.KBE_FLT_MAX, xz[1], y, p, KBEngine.KBE_FLT_MAX, 1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xz_yr = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\r\n\t\tvar y = stream.readInt8();\r\n\t\tvar r = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], KBEngine.KBE_FLT_MAX, xz[1], y, KBEngine.KBE_FLT_MAX, r, 1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xz_pr = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\r\n\t\tvar p = stream.readInt8();\r\n\t\tvar r = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], KBEngine.KBE_FLT_MAX, xz[1], KBEngine.KBE_FLT_MAX, p, r, 1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xz_y = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\r\n\t\tvar y = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], KBEngine.KBE_FLT_MAX, xz[1], y, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, 1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xz_p = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\r\n\t\tvar p = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], KBEngine.KBE_FLT_MAX, xz[1], KBEngine.KBE_FLT_MAX, p, KBEngine.KBE_FLT_MAX, 1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xz_r = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\r\n\t\tvar r = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], KBEngine.KBE_FLT_MAX, xz[1], KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, r, 1);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xyz = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\t\tvar y = stream.readPackY();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], y, xz[1], KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, 0);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xyz_ypr = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\t\tvar y = stream.readPackY();\r\n\t\t\r\n\t\tvar yaw = stream.readInt8();\r\n\t\tvar p = stream.readInt8();\r\n\t\tvar r = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], y, xz[1], yaw, p, r, 0);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xyz_yp = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\t\tvar y = stream.readPackY();\r\n\t\t\r\n\t\tvar yaw = stream.readInt8();\r\n\t\tvar p = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], y, xz[1], yaw, p, KBEngine.KBE_FLT_MAX, 0);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xyz_yr = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\t\tvar y = stream.readPackY();\r\n\t\t\r\n\t\tvar yaw = stream.readInt8();\r\n\t\tvar r = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], y, xz[1], yaw, KBEngine.KBE_FLT_MAX, r, 0);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xyz_pr = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\t\tvar y = stream.readPackY();\r\n\t\t\r\n\t\tvar p = stream.readInt8();\r\n\t\tvar r = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, x, y, z, KBEngine.KBE_FLT_MAX, p, r, 0);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xyz_y = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\t\tvar y = stream.readPackY();\r\n\t\t\r\n\t\tvar yaw = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], y, xz[1], yaw, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, 0);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xyz_p = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\t\tvar y = stream.readPackY();\r\n\t\t\r\n\t\tvar p = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], y, xz[1], KBEngine.KBE_FLT_MAX, p, KBEngine.KBE_FLT_MAX, 0);\r\n\t}\r\n\t\r\n\tthis.Client_onUpdateData_xyz_r = function(stream)\r\n\t{\r\n\t\tvar eid = KBEngine.app.getViewEntityIDFromStream(stream);\r\n\t\t\r\n\t\tvar xz = stream.readPackXZ();\r\n\t\tvar y = stream.readPackY();\r\n\t\t\r\n\t\tvar p = stream.readInt8();\r\n\t\t\r\n\t\tKBEngine.app._updateVolatileData(eid, xz[0], y, xz[1], r, KBEngine.KBE_FLT_MAX, KBEngine.KBE_FLT_MAX, 0);\r\n\t}\r\n\t\r\n\tthis._updateVolatileData = function(entityID, x, y, z, yaw, pitch, roll, isOnGround)\r\n\t{\r\n\t\tvar entity = KBEngine.app.entities[entityID];\r\n\t\tif(entity == undefined)\r\n\t\t{\r\n\t\t\t// 如果为0且客户端上一步是重登陆或者重连操作并且服务端entity在断线期间一直处于在线状态\r\n\t\t\t// 则可以忽略这个错误, 因为cellapp可能一直在向baseapp发送同步消息， 当客户端重连上时未等\r\n\t\t\t// 服务端初始化步骤开始则收到同步信息, 此时这里就会出错。\t\t\t\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::_updateVolatileData: entity(\" + entityID + \") not found!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t// 小于0不设置\r\n\t\tif(isOnGround >= 0)\r\n\t\t{\r\n\t\t\tentity.isOnGround = (isOnGround > 0);\r\n\t\t}\r\n\t\t\r\n\t\tvar changeDirection = false;\r\n\t\t\r\n\t\tif(roll != KBEngine.KBE_FLT_MAX)\r\n\t\t{\r\n\t\t\tchangeDirection = true;\r\n\t\t\tentity.direction.x = KBEngine.int82angle(roll, false);\r\n\t\t}\r\n\r\n\t\tif(pitch != KBEngine.KBE_FLT_MAX)\r\n\t\t{\r\n\t\t\tchangeDirection = true;\r\n\t\t\tentity.direction.y = KBEngine.int82angle(pitch, false);\r\n\t\t}\r\n\t\t\r\n\t\tif(yaw != KBEngine.KBE_FLT_MAX)\r\n\t\t{\r\n\t\t\tchangeDirection = true;\r\n\t\t\tentity.direction.z = KBEngine.int82angle(yaw, false);\r\n\t\t}\r\n\t\t\r\n\t\tvar done = false;\r\n\t\tif(changeDirection == true)\r\n\t\t{\r\n\t\t\tKBEngine.Event.fire(KBEngine.EventTypes.set_direction, entity);\t\t\r\n\t\t\tdone = true;\r\n\t\t}\r\n\t\t\r\n\t\tvar positionChanged = false;\r\n\t\tif(x != KBEngine.KBE_FLT_MAX || y != KBEngine.KBE_FLT_MAX || z != KBEngine.KBE_FLT_MAX)\r\n\t\t\tpositionChanged = true;\r\n\r\n\t\tif (x == KBEngine.KBE_FLT_MAX) x = 0.0;\r\n\t\tif (y == KBEngine.KBE_FLT_MAX) y = 0.0;\r\n\t\tif (z == KBEngine.KBE_FLT_MAX) z = 0.0;\r\n        \r\n\t\tif(positionChanged)\r\n\t\t{\r\n\t\t\tentity.position.x = x + KBEngine.app.entityServerPos.x;\r\n\t\t\tentity.position.y = y + KBEngine.app.entityServerPos.y;\r\n\t\t\tentity.position.z = z + KBEngine.app.entityServerPos.z;\r\n\t\t\t\r\n\t\t\tdone = true;\r\n\t\t\tKBEngine.Event.fire(KBEngine.EventTypes.updatePosition, entity);\r\n\t\t}\r\n\t\t\r\n\t\tif(done)\r\n\t\t\tentity.onUpdateVolatileData();\t\t\r\n\t}\r\n\t\r\n\tthis.Client_onStreamDataStarted = function(id, datasize, descr)\r\n\t{\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onStreamDataStarted, id, datasize, descr);\r\n\t}\r\n\t\r\n\tthis.Client_onStreamDataRecv = function(stream)\r\n\t{\r\n\t\tvar id = stream.readUint16();\r\n\t\tvar data = stream.readBlob();\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onStreamDataRecv, id, data);\r\n\t}\r\n\t\r\n\tthis.Client_onStreamDataCompleted = function(id)\r\n\t{\r\n\t\tKBEngine.Event.fire(KBEngine.EventTypes.onStreamDataCompleted, id);\r\n\t}\r\n\t\r\n\tthis.Client_onReqAccountResetPasswordCB = function(failedcode)\r\n\t{\r\n\t\tif(failedcode != 0)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onReqAccountResetPasswordCB: \" + KBEngine.app.username + \" is failed! code=\" + KBEngine.app.serverErrs[failedcode].name + \"!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onReqAccountResetPasswordCB: \" + KBEngine.app.username + \" is successfully!\");\r\n\t}\r\n\t\r\n\tthis.Client_onReqAccountBindEmailCB = function(failedcode)\r\n\t{\r\n\t\tif(failedcode != 0)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onReqAccountBindEmailCB: \" + KBEngine.app.username + \" is failed! code=\" + KBEngine.app.serverErrs[failedcode].name + \"!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onReqAccountBindEmailCB: \" + KBEngine.app.username + \" is successfully!\");\r\n\t}\r\n\t\r\n\tthis.Client_onReqAccountNewPasswordCB = function(failedcode)\r\n\t{\r\n\t\tif(failedcode != 0)\r\n\t\t{\r\n\t\t\tKBEngine.ERROR_MSG(\"KBEngineApp::Client_onReqAccountNewPasswordCB: \" + KBEngine.app.username + \" is failed! code=\" + KBEngine.app.serverErrs[failedcode].name + \"!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tKBEngine.INFO_MSG(\"KBEngineApp::Client_onReqAccountNewPasswordCB: \" + KBEngine.app.username + \" is successfully!\");\r\n\t}\r\n}\r\n\r\nKBEngine.create = function(kbengineArgs)\r\n{\r\n\tif(KBEngine.app != undefined)\r\n\t\treturn;\r\n\r\n\t// 一些平台如小程序上可能没有assert\r\n\tif(console.assert == undefined)\r\n\t{\r\n\t\tconsole.assert = function(bRet, s)\r\n\t\t{\r\n\t\t\tif(!(bRet)) {\r\n\t\t\t\tKBEngine.ERROR_MSG(s);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif(kbengineArgs.constructor != KBEngine.KBEngineArgs)\r\n\t{\r\n\t\tKBEngine.ERROR_MSG(\"KBEngine.create(): args(\" + kbengineArgs + \") error! not is KBEngine.KBEngineArgs\");\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tnew KBEngine.KBEngineApp(kbengineArgs);\r\n\t\r\n\tKBEngine.app.reset();\r\n\tKBEngine.app.installEvents();\r\n\tKBEngine.idInterval = setInterval(KBEngine.app.update, kbengineArgs.updateHZ);\r\n}\r\n\r\nKBEngine.destroy = function()\r\n{\r\n\tif(KBEngine.idInterval != undefined)\r\n\t\tclearInterval(KBEngine.idInterval);\r\n\t\r\n\tif(KBEngine.app == undefined)\r\n\t\treturn;\r\n\t\t\r\n\tKBEngine.app.uninstallEvents();\r\n\tKBEngine.app.reset();\r\n\tKBEngine.app = undefined;\r\n}\r\n\r\ntry\r\n{\r\n\tif(module != undefined)\r\n\t{\r\n\t\tmodule.exports = KBEngine;\r\n\t}\r\n}\r\ncatch(e)\r\n{\r\n\t\r\n}\r\n\r\n\r\n"]}