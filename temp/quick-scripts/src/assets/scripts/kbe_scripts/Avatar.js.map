{"version":3,"sources":["assets\\scripts\\kbe_scripts\\Avatar.js"],"names":["KBEngine","require","Avatar","Entity","extend","__init__","_super","isPlayer","cc","log","window","wx","undefined","sys","platform","WECHAT_GAME","decodeEncryptedData","Event","fire","onSetSpaceData","encryptedData","localStorage","getItem","iv","baseCall","reqChangeReadyState","cellCall","updateStaus","playerReadyStateChange","eid","state","quick_chat","idx","emoji","name","iptChat","strstr","onquick_chat","onjoinPrivateRoom","num","onemoji","oniptChat","onclientMSG","msg","joinRoom","INFO_MSG","id","createPrivateRoom","joinPrivateRoom","roomkey","game_begin_push","holds","onEnterWorld","onEnterWorld2","app","entity_id","onNewTurn","second","card1","card2","card3","card4","onsureact","strr","leaverequest","onsyncsureact","newTurn","onupdateGamestates","curID","time","onotherNetcut","avatarID","onDie","onGameOver","isWin","hitRate","totalTime","totalHarm","score","toString","updategamestuts","continueGame","onContinueGame"],"mappings":"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","sourceRoot":"/","sourcesContent":["/*-----------------------------------------------------------------------------------------\r\n\t\t\t\t\t\t\t\t\t\t\t\tentity\r\n-----------------------------------------------------------------------------------------*/\r\n\r\nvar KBEngine = require(\"kbengine\");\r\n\r\nKBEngine.Avatar = KBEngine.Entity.extend({\r\n        __init__ : function()\r\n        {\r\n            this._super();\r\n            if(this.isPlayer()) {\r\n                cc.log(\"window.wx != undefined || window.wc=\",window.wx != undefined)\r\n                if(cc.sys.platform == cc.sys.WECHAT_GAME){\r\n                    this.decodeEncryptedData();\r\n                }                   \r\n                cc.log(\"KBEngine.Avatar._init_\")\r\n                KBEngine.Event.fire(\"enterScene\");\r\n            }\r\n        },\r\n        onSetSpaceData:function(){\r\n            cc.log(\"initSpaceDatainitSpaceDatainitSpaceDatainitSpaceData\")\r\n            KBEngine.Event.fire(\"onSetSpaceData\");\r\n\r\n        },\r\n        decodeEncryptedData: function()\r\n        {\r\n            var encryptedData = cc.sys.localStorage.getItem(\"encryptedData\");\r\n            var iv = cc.sys.localStorage.getItem(\"iv\");\r\n            cc.log(\"encryptedData && iv\",encryptedData , iv)\r\n            if(encryptedData && iv) {\r\n                cc.log(\"decodeEncryptedData\")\r\n                this.baseCall(\"decodeEncryptedData\", encryptedData, iv);\r\n            }\r\n        },\r\n        reqChangeReadyState:function(){\r\n            this.cellCall(\"reqChangeReadyState\",1);\r\n        },\r\n        updateStaus:function(){\r\n            this.baseCall(\"updateStaus\");\r\n        },\r\n        playerReadyStateChange:function(eid,state){\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"playerReadyStateChange\", eid,state);\r\n            }\r\n\r\n        },\r\n        quick_chat:function(idx){\r\n            cc.log(\"quick_chat:cellCall\",idx)\r\n            this.cellCall(\"quick_chat\",idx);\r\n        },\r\n        emoji:function(name){\r\n            cc.log(\"emoji:cellCall\",name)\r\n            this.cellCall(\"emoji\",name);\r\n        },\r\n        iptChat:function(strstr){\r\n            cc.log(\"iptChat:cellCall\",strstr)\r\n            this.cellCall(\"iptChat\",strstr);\r\n        },\r\n        onquick_chat:function(eid,idx){\r\n            cc.log(\"quick_chat:receive\",eid,idx)\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"onquick_chat\", eid,idx);\r\n            }\r\n        },\r\n        onjoinPrivateRoom:function(num){\r\n            cc.log(\"onjoinPrivateRoom\", num)\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"onjoinPrivateRoom\", num);\r\n            }\r\n        },\r\n        onemoji:function(eid,name){\r\n            cc.log(\"emoji:receive\",eid,name)\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"onemoji\", eid,name);\r\n            }\r\n        },\r\n        oniptChat:function(eid,strstr){\r\n            cc.log(\"iptChat:receive\",eid,strstr)\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"oniptChat\", eid,strstr);\r\n            }\r\n        },\r\n        onclientMSG:function(msg){\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"onclientMSG\", msg);\r\n            }\r\n        },\r\n        joinRoom: function()\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + this.id + \" join room\");\r\n            this.baseCall(\"joinRoom\");\r\n        },\r\n        createPrivateRoom: function()\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + this.id + \" createPrivateRoom\");\r\n            this.baseCall(\"createPrivateRoom\");\r\n        },\r\n        joinPrivateRoom: function(roomkey)\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + this.id + \" joinPrivateRoom\"+ roomkey);\r\n            this.baseCall(\"joinPrivateRoom\",roomkey);\r\n        },\r\n        game_begin_push:function(holds)   {\r\n            cc.log(\"Avatar::game_begin_push\")\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"game_begin_push\",this);\r\n            }\r\n        },\r\n        onEnterWorld : function()\r\n        {\r\n            cc.log(\"avatar.onEnterWorld.......\")\r\n            this._super();\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"onAvatarEnterWorld\", this);\r\n            }\t\t\r\n        },\r\n        onEnterWorld2 : function(eid)\r\n        {\r\n            cc.log(\"avatar.onEnterWorld2.......\",this.id , KBEngine.app.entity_id)\r\n\r\n            //this._super();\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"onEnterWorld2\", eid);\r\n            }\t\t\r\n        },\r\n\r\n\r\n        onNewTurn : function(eid,second,card1,card2,card3,card4)\r\n\t    {\r\n            KBEngine.INFO_MSG(\"avatar \" + eid + \" on new turn\");\r\n\t\t    KBEngine.Event.fire(\"newTurn\", this,eid,second,card1,card2,card3,card4);\r\n        }, \r\n        onsureact:function(strr){\r\n            this.cellCall(\"onsureact\", strr);\r\n        },\r\n        leaverequest:function(){\r\n            KBEngine.INFO_MSG(\"avatar \" + this.id + \" leaverequest\");\r\n            this.cellCall(\"leaverequest\");\r\n\r\n        },\r\n        onsyncsureact:function(eid , strr){\r\n            cc.log(\"avatar::onsyncsureact== \", strr);\r\n            //KBEngine.Event.fire(\"onsyncsureact\", strr);\r\n            if(this.isPlayer()) {\r\n                KBEngine.Event.fire(\"oniptChat\", eid,strr);\r\n            }\r\n\r\n        },\r\n        newTurn : function()\r\n\t    {\r\n            this.cellCall(\"newTurn\");\r\n        }, \r\n\r\n        \r\n        onupdateGamestates:function(curID,time){\r\n            KBEngine.INFO_MSG(\"onupdateGamestates \" + curID + \"/\" + time);\r\n            KBEngine.Event.fire(\"onupdateGamestates\", curID,time);\r\n        },\r\n        onotherNetcut: function(avatarID)\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + avatarID + \" Netcut\");\r\n            KBEngine.Event.fire(\"onotherNetcut\", avatarID);\r\n        },\r\n        onDie: function(avatarID)\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + avatarID + \" die\");\r\n            KBEngine.Event.fire(\"onAvatarDie\", avatarID);\r\n        },\r\n\r\n        onGameOver: function(isWin, hitRate, totalTime, totalHarm, score)\r\n        {\r\n            KBEngine.INFO_MSG(\"Game is over: avatar \" + this.id + \"win= \" + isWin.toString());\r\n            KBEngine.Event.fire(\"onGameOver\", this.id, isWin, hitRate, totalTime, totalHarm, score);\r\n        },\r\n        updategamestuts:function(num){\r\n            KBEngine.Event.fire(\"updategamestuts\",num);\r\n        },\r\n\r\n        continueGame: function()\r\n        {\r\n            this.cellCall(\"continueGame\");\r\n            KBEngine.INFO_MSG(\"avatar \" + this.id + \" continue game\");\r\n        },\r\n\r\n        onContinueGame: function(avatarID)\r\n        {\r\n            KBEngine.INFO_MSG(\"avatar \" + avatarID + \"on continue game, local avatarID=\" + this.id);\r\n            //KBEngine.Event.fire(\"onAvatarEnterWorld\", KBEngine.app.entity_uuid, this.id, this);\r\n            KBEngine.Event.fire(\"onAvatarEnterWorld\",this);\r\n        },\r\n\r\n       \r\n    });\r\n    \r\n    \r\n    "]}